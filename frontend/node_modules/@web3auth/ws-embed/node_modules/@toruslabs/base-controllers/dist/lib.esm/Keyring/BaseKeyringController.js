import { BaseController } from '../BaseController.js';
import { hashMessage, signMessage } from '../utils/utils.js';

class BaseKeyringController extends BaseController {
  constructor({
    config = {},
    state
  }) {
    var _state$wallets;
    super({
      config,
      state
    });
    this.defaultState = {
      wallets: (_state$wallets = state.wallets) !== null && _state$wallets !== void 0 ? _state$wallets : []
    };
    this.initialize();
  }

  // for signing auth message
  async signAuthMessage(address, message) {
    const keyring = this.state.wallets.find(x => x.address === address);
    if (!keyring) {
      throw new Error("key does not exist");
    }
    const hashedMessage = hashMessage(message).toString("hex");
    const rawMessageSig = await signMessage(keyring.privateKey, hashedMessage);
    return rawMessageSig;
  }
}

export { BaseKeyringController };
