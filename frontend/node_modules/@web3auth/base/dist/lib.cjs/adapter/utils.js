'use strict';

var jwtDecode = require('jwt-decode');
var utils = require('../utils.js');

const checkIfTokenIsExpired = token => {
  const decoded = jwtDecode.jwtDecode(token);
  if (!decoded.exp) {
    return true;
  }
  if (decoded.exp < Math.floor(Date.now() / 1000)) {
    return true;
  }
  return false;
};
const getSavedToken = (userAddress, issuer) => {
  if (utils.storageAvailable("localStorage")) {
    return localStorage.getItem(`${userAddress.toLowerCase()}_${issuer}`);
  }
  return null;
};
const saveToken = (userAddress, issuer, token) => {
  if (utils.storageAvailable("localStorage")) {
    return localStorage.setItem(`${userAddress.toLowerCase()}_${issuer}`, token);
  }
  return null;
};
const clearToken = (userAddress, issuer) => {
  if (utils.storageAvailable("localStorage")) {
    return localStorage.removeItem(`${userAddress.toLowerCase()}_${issuer}`);
  }
  return null;
};

exports.checkIfTokenIsExpired = checkIfTokenIsExpired;
exports.clearToken = clearToken;
exports.getSavedToken = getSavedToken;
exports.saveToken = saveToken;
