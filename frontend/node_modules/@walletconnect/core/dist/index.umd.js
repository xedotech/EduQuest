(function(j,ct){typeof exports=="object"&&typeof module<"u"?ct(exports):typeof define=="function"&&define.amd?define(["exports"],ct):(j=typeof globalThis<"u"?globalThis:j||self,ct(j["@walletconnect/core"]={}))})(this,function(j){"use strict";var ct=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function sa(t){var e=t.default;if(typeof e=="function"){var r=function(){return e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(n){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}),r}var qe={exports:{}},gr=typeof Reflect=="object"?Reflect:null,oa=gr&&typeof gr.apply=="function"?gr.apply:function(e,r,n){return Function.prototype.apply.call(e,r,n)},Rn;gr&&typeof gr.ownKeys=="function"?Rn=gr.ownKeys:Object.getOwnPropertySymbols?Rn=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Rn=function(e){return Object.getOwnPropertyNames(e)};function hd(t){console&&console.warn&&console.warn(t)}var aa=Number.isNaN||function(e){return e!==e};function ee(){ee.init.call(this)}qe.exports=ee,qe.exports.once=yd,ee.EventEmitter=ee,ee.prototype._events=void 0,ee.prototype._eventsCount=0,ee.prototype._maxListeners=void 0;var ca=10;function Nn(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(ee,"defaultMaxListeners",{enumerable:!0,get:function(){return ca},set:function(t){if(typeof t!="number"||t<0||aa(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");ca=t}}),ee.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ee.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||aa(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function ua(t){return t._maxListeners===void 0?ee.defaultMaxListeners:t._maxListeners}ee.prototype.getMaxListeners=function(){return ua(this)},ee.prototype.emit=function(e){for(var r=[],n=1;n<arguments.length;n++)r.push(arguments[n]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(r.length>0&&(o=r[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(c===void 0)return!1;if(typeof c=="function")oa(c,this,r);else for(var u=c.length,l=ga(c,u),n=0;n<u;++n)oa(l[n],this,r);return!0};function la(t,e,r,n){var i,s,o;if(Nn(r),s=t._events,s===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,r.listener?r.listener:r),s=t._events),o=s[e]),o===void 0)o=s[e]=r,++t._eventsCount;else if(typeof o=="function"?o=s[e]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),i=ua(t),i>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=o.length,hd(a)}return t}ee.prototype.addListener=function(e,r){return la(this,e,r,!1)},ee.prototype.on=ee.prototype.addListener,ee.prototype.prependListener=function(e,r){return la(this,e,r,!0)};function dd(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function fa(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},i=dd.bind(n);return i.listener=r,n.wrapFn=i,i}ee.prototype.once=function(e,r){return Nn(r),this.on(e,fa(this,e,r)),this},ee.prototype.prependOnceListener=function(e,r){return Nn(r),this.prependListener(e,fa(this,e,r)),this},ee.prototype.removeListener=function(e,r){var n,i,s,o,a;if(Nn(r),i=this._events,i===void 0)return this;if(n=i[e],n===void 0)return this;if(n===r||n.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||r));else if(typeof n!="function"){for(s=-1,o=n.length-1;o>=0;o--)if(n[o]===r||n[o].listener===r){a=n[o].listener,s=o;break}if(s<0)return this;s===0?n.shift():gd(n,s),n.length===1&&(i[e]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||r)}return this},ee.prototype.off=ee.prototype.removeListener,ee.prototype.removeAllListeners=function(e){var r,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var s=Object.keys(n),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=n[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(i=r.length-1;i>=0;i--)this.removeListener(e,r[i]);return this};function ha(t,e,r){var n=t._events;if(n===void 0)return[];var i=n[e];return i===void 0?[]:typeof i=="function"?r?[i.listener||i]:[i]:r?pd(i):ga(i,i.length)}ee.prototype.listeners=function(e){return ha(this,e,!0)},ee.prototype.rawListeners=function(e){return ha(this,e,!1)},ee.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):da.call(t,e)},ee.prototype.listenerCount=da;function da(t){var e=this._events;if(e!==void 0){var r=e[t];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}ee.prototype.eventNames=function(){return this._eventsCount>0?Rn(this._events):[]};function ga(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}function gd(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function pd(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function yd(t,e){return new Promise(function(r,n){function i(o){t.removeListener(e,s),n(o)}function s(){typeof t.removeListener=="function"&&t.removeListener("error",i),r([].slice.call(arguments))}pa(t,e,s,{once:!0}),e!=="error"&&bd(t,i,{once:!0})})}function bd(t,e,r){typeof t.on=="function"&&pa(t,"error",e,r)}function pa(t,e,r,n){if(typeof t.on=="function")n.once?t.once(e,r):t.on(e,r);else if(typeof t.addEventListener=="function")t.addEventListener(e,function i(s){n.once&&t.removeEventListener(e,i),r(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var V={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var Ui=function(t,e){return Ui=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},Ui(t,e)};function wd(t,e){Ui(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Fi=function(){return Fi=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Fi.apply(this,arguments)};function md(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r}function Ed(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s}function vd(t,e){return function(r,n){e(r,n,t)}}function _d(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function xd(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(f){o(f)}}function c(l){try{u(n.throw(l))}catch(f){o(f)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(t,e||[])).next())})}function Dd(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){r.label=u[1];break}if(u[0]===6&&r.label<s[1]){r.label=s[1],s=u;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(u);break}s[2]&&r.ops.pop(),r.trys.pop();continue}u=e.call(t,r)}catch(l){u=[6,l],i=0}finally{n=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Id(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}function Sd(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function ji(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ya(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return s}function Od(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(ya(arguments[e]));return t}function Ad(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),i=0,e=0;e<r;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)n[i]=s[o];return n}function Fr(t){return this instanceof Fr?(this.v=t,this):new Fr(t)}function Td(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(h){n[h]&&(i[h]=function(g){return new Promise(function(d,p){s.push([h,g,d,p])>1||a(h,g)})})}function a(h,g){try{c(n[h](g))}catch(d){f(s[0][3],d)}}function c(h){h.value instanceof Fr?Promise.resolve(h.value.v).then(u,l):f(s[0][2],h)}function u(h){a("next",h)}function l(h){a("throw",h)}function f(h,g){h(g),s.shift(),s.length&&a(s[0][0],s[0][1])}}function Bd(t){var e,r;return e={},n("next"),n("throw",function(i){throw i}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(i,s){e[i]=t[i]?function(o){return(r=!r)?{value:Fr(t[i](o)),done:i==="return"}:s?s(o):o}:s}}function Cd(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof ji=="function"?ji(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(s){r[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function Rd(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function Nd(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function Pd(t){return t&&t.__esModule?t:{default:t}}function $d(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function Ld(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var Ud=Object.freeze({__proto__:null,__extends:wd,get __assign(){return Fi},__rest:md,__decorate:Ed,__param:vd,__metadata:_d,__awaiter:xd,__generator:Dd,__createBinding:Id,__exportStar:Sd,__values:ji,__read:ya,__spread:Od,__spreadArrays:Ad,__await:Fr,__asyncGenerator:Td,__asyncDelegator:Bd,__asyncValues:Cd,__makeTemplateObject:Rd,__importStar:Nd,__importDefault:Pd,__classPrivateFieldGet:$d,__classPrivateFieldSet:Ld}),Pn=sa(Ud),zi={},jr={},ba;function Fd(){if(ba)return jr;ba=1,Object.defineProperty(jr,"__esModule",{value:!0}),jr.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return jr.delay=t,jr}var Zt={},ki={},Xt={},wa;function jd(){return wa||(wa=1,Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.ONE_THOUSAND=Xt.ONE_HUNDRED=void 0,Xt.ONE_HUNDRED=100,Xt.ONE_THOUSAND=1e3),Xt}var Mi={},ma;function zd(){return ma||(ma=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(Mi)),Mi}var Ea;function va(){return Ea||(Ea=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Pn;e.__exportStar(jd(),t),e.__exportStar(zd(),t)}(ki)),ki}var _a;function kd(){if(_a)return Zt;_a=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.fromMiliseconds=Zt.toMiliseconds=void 0;const t=va();function e(n){return n*t.ONE_THOUSAND}Zt.toMiliseconds=e;function r(n){return Math.floor(n/t.ONE_THOUSAND)}return Zt.fromMiliseconds=r,Zt}var xa;function Md(){return xa||(xa=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Pn;e.__exportStar(Fd(),t),e.__exportStar(kd(),t)}(zi)),zi}var pr={},Da;function Hd(){if(Da)return pr;Da=1,Object.defineProperty(pr,"__esModule",{value:!0}),pr.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const n=this.get(r);if(typeof n.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const i=Date.now()-n.started;this.timestamps.set(r,{started:n.started,elapsed:i})}get(r){const n=this.timestamps.get(r);if(typeof n>"u")throw new Error(`No timestamp found for label: ${r}`);return n}elapsed(r){const n=this.get(r);return n.elapsed||Date.now()-n.started}}return pr.Watch=t,pr.default=t,pr}var Hi={},zr={},Ia;function Vd(){if(Ia)return zr;Ia=1,Object.defineProperty(zr,"__esModule",{value:!0}),zr.IWatch=void 0;class t{}return zr.IWatch=t,zr}var Sa;function Kd(){return Sa||(Sa=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Pn.__exportStar(Vd(),t)}(Hi)),Hi}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Pn;e.__exportStar(Md(),t),e.__exportStar(Hd(),t),e.__exportStar(Kd(),t),e.__exportStar(va(),t)})(V);class Jt{}class qd extends Jt{constructor(e){super()}}const Oa=V.FIVE_SECONDS,Qt={pulse:"heartbeat_pulse"};class Vi extends qd{constructor(e){super(e),this.events=new qe.exports.EventEmitter,this.interval=Oa,this.interval=e?.interval||Oa}static async init(e){const r=new Vi(e);return await r.init(),r}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),V.toMiliseconds(this.interval))}pulse(){this.events.emit(Qt.pulse)}}const Wd=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Gd=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,Yd=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function Zd(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){Xd(t);return}return e}function Xd(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function $n(t,e={}){if(typeof t!="string")return t;if(t[0]==='"'&&t[t.length-1]==='"'&&t.indexOf("\\")===-1)return t.slice(1,-1);const r=t.trim();if(r.length<=9)switch(r.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!Yd.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(Wd.test(t)||Gd.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,Zd)}return JSON.parse(t)}catch(n){if(e.strict)throw n;return t}}function Jd(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function ue(t,...e){try{return Jd(t(...e))}catch(r){return Promise.reject(r)}}function Qd(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function eg(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function Ln(t){if(Qd(t))return String(t);if(eg(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return Ln(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Ki="base64:";function tg(t){return typeof t=="string"?t:Ki+ig(t)}function rg(t){return typeof t!="string"||!t.startsWith(Ki)?t:ng(t.slice(Ki.length))}function ng(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function ig(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function Ae(t){return t&&t.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function sg(...t){return Ae(t.join(":"))}function Un(t){return t=Ae(t),t?t+":":""}function og(t,e){if(e===void 0)return!0;let r=0,n=t.indexOf(":");for(;n>-1;)r++,n=t.indexOf(":",n+1);return r<=e}function ag(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}function h8(t){return t}const cg="memory",ug=()=>{const t=new Map;return{name:cg,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,r){t.set(e,r)},setItemRaw(e,r){t.set(e,r)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function lg(t={}){const e={mounts:{"":t.driver||ug()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=u=>{for(const l of e.mountpoints)if(u.startsWith(l))return{base:l,relativeKey:u.slice(l.length),driver:e.mounts[l]};return{base:"",relativeKey:u,driver:e.mounts[""]}},n=(u,l)=>e.mountpoints.filter(f=>f.startsWith(u)||l&&u.startsWith(f)).map(f=>({relativeBase:u.length>f.length?u.slice(f.length):void 0,mountpoint:f,driver:e.mounts[f]})),i=(u,l)=>{if(e.watching){l=Ae(l);for(const f of e.watchListeners)f(u,l)}},s=async()=>{if(!e.watching){e.watching=!0;for(const u in e.mounts)e.unwatch[u]=await Aa(e.mounts[u],i,u)}},o=async()=>{if(e.watching){for(const u in e.unwatch)await e.unwatch[u]();e.unwatch={},e.watching=!1}},a=(u,l,f)=>{const h=new Map,g=d=>{let p=h.get(d.base);return p||(p={driver:d.driver,base:d.base,items:[]},h.set(d.base,p)),p};for(const d of u){const p=typeof d=="string",m=Ae(p?d:d.key),C=p?void 0:d.value,P=p||!d.options?l:{...l,...d.options},E=r(m);g(E).items.push({key:m,value:C,relativeKey:E.relativeKey,options:P})}return Promise.all([...h.values()].map(d=>f(d))).then(d=>d.flat())},c={hasItem(u,l={}){u=Ae(u);const{relativeKey:f,driver:h}=r(u);return ue(h.hasItem,f,l)},getItem(u,l={}){u=Ae(u);const{relativeKey:f,driver:h}=r(u);return ue(h.getItem,f,l).then(g=>$n(g))},getItems(u,l={}){return a(u,l,f=>f.driver.getItems?ue(f.driver.getItems,f.items.map(h=>({key:h.relativeKey,options:h.options})),l).then(h=>h.map(g=>({key:sg(f.base,g.key),value:$n(g.value)}))):Promise.all(f.items.map(h=>ue(f.driver.getItem,h.relativeKey,h.options).then(g=>({key:h.key,value:$n(g)})))))},getItemRaw(u,l={}){u=Ae(u);const{relativeKey:f,driver:h}=r(u);return h.getItemRaw?ue(h.getItemRaw,f,l):ue(h.getItem,f,l).then(g=>rg(g))},async setItem(u,l,f={}){if(l===void 0)return c.removeItem(u);u=Ae(u);const{relativeKey:h,driver:g}=r(u);g.setItem&&(await ue(g.setItem,h,Ln(l),f),g.watch||i("update",u))},async setItems(u,l){await a(u,l,async f=>{if(f.driver.setItems)return ue(f.driver.setItems,f.items.map(h=>({key:h.relativeKey,value:Ln(h.value),options:h.options})),l);f.driver.setItem&&await Promise.all(f.items.map(h=>ue(f.driver.setItem,h.relativeKey,Ln(h.value),h.options)))})},async setItemRaw(u,l,f={}){if(l===void 0)return c.removeItem(u,f);u=Ae(u);const{relativeKey:h,driver:g}=r(u);if(g.setItemRaw)await ue(g.setItemRaw,h,l,f);else if(g.setItem)await ue(g.setItem,h,tg(l),f);else return;g.watch||i("update",u)},async removeItem(u,l={}){typeof l=="boolean"&&(l={removeMeta:l}),u=Ae(u);const{relativeKey:f,driver:h}=r(u);h.removeItem&&(await ue(h.removeItem,f,l),(l.removeMeta||l.removeMata)&&await ue(h.removeItem,f+"$",l),h.watch||i("remove",u))},async getMeta(u,l={}){typeof l=="boolean"&&(l={nativeOnly:l}),u=Ae(u);const{relativeKey:f,driver:h}=r(u),g=Object.create(null);if(h.getMeta&&Object.assign(g,await ue(h.getMeta,f,l)),!l.nativeOnly){const d=await ue(h.getItem,f+"$",l).then(p=>$n(p));d&&typeof d=="object"&&(typeof d.atime=="string"&&(d.atime=new Date(d.atime)),typeof d.mtime=="string"&&(d.mtime=new Date(d.mtime)),Object.assign(g,d))}return g},setMeta(u,l,f={}){return this.setItem(u+"$",l,f)},removeMeta(u,l={}){return this.removeItem(u+"$",l)},async getKeys(u,l={}){u=Un(u);const f=n(u,!0);let h=[];const g=[];let d=!0;for(const m of f){m.driver.flags?.maxDepth||(d=!1);const C=await ue(m.driver.getKeys,m.relativeBase,l);for(const P of C){const E=m.mountpoint+Ae(P);h.some(_=>E.startsWith(_))||g.push(E)}h=[m.mountpoint,...h.filter(P=>!P.startsWith(m.mountpoint))]}const p=l.maxDepth!==void 0&&!d;return g.filter(m=>(!p||og(m,l.maxDepth))&&ag(m,u))},async clear(u,l={}){u=Un(u),await Promise.all(n(u,!1).map(async f=>{if(f.driver.clear)return ue(f.driver.clear,f.relativeBase,l);if(f.driver.removeItem){const h=await f.driver.getKeys(f.relativeBase||"",l);return Promise.all(h.map(g=>f.driver.removeItem(g,l)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(u=>Ta(u)))},async watch(u){return await s(),e.watchListeners.push(u),async()=>{e.watchListeners=e.watchListeners.filter(l=>l!==u),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(u,l){if(u=Un(u),u&&e.mounts[u])throw new Error(`already mounted at ${u}`);return u&&(e.mountpoints.push(u),e.mountpoints.sort((f,h)=>h.length-f.length)),e.mounts[u]=l,e.watching&&Promise.resolve(Aa(l,i,u)).then(f=>{e.unwatch[u]=f}).catch(console.error),c},async unmount(u,l=!0){u=Un(u),!(!u||!e.mounts[u])&&(e.watching&&u in e.unwatch&&(e.unwatch[u]?.(),delete e.unwatch[u]),l&&await Ta(e.mounts[u]),e.mountpoints=e.mountpoints.filter(f=>f!==u),delete e.mounts[u])},getMount(u=""){u=Ae(u)+":";const l=r(u);return{driver:l.driver,base:l.base}},getMounts(u="",l={}){return u=Ae(u),n(u,l.parents).map(h=>({driver:h.driver,base:h.mountpoint}))},keys:(u,l={})=>c.getKeys(u,l),get:(u,l={})=>c.getItem(u,l),set:(u,l,f={})=>c.setItem(u,l,f),has:(u,l={})=>c.hasItem(u,l),del:(u,l={})=>c.removeItem(u,l),remove:(u,l={})=>c.removeItem(u,l)};return c}function Aa(t,e,r){return t.watch?t.watch((n,i)=>e(n,r+i)):()=>{}}async function Ta(t){typeof t.dispose=="function"&&await ue(t.dispose)}function er(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function Ba(t,e){const r=indexedDB.open(t);r.onupgradeneeded=()=>r.result.createObjectStore(e);const n=er(r);return(i,s)=>n.then(o=>s(o.transaction(e,i).objectStore(e)))}let qi;function kr(){return qi||(qi=Ba("keyval-store","keyval")),qi}function Ca(t,e=kr()){return e("readonly",r=>er(r.get(t)))}function fg(t,e,r=kr()){return r("readwrite",n=>(n.put(e,t),er(n.transaction)))}function hg(t,e=kr()){return e("readwrite",r=>(r.delete(t),er(r.transaction)))}function dg(t=kr()){return t("readwrite",e=>(e.clear(),er(e.transaction)))}function gg(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},er(t.transaction)}function pg(t=kr()){return t("readonly",e=>{if(e.getAllKeys)return er(e.getAllKeys());const r=[];return gg(e,n=>r.push(n.key)).then(()=>r)})}const yg=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),bg=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(n,i)=>typeof i=="string"&&i.match(/^\d+n$/)?BigInt(i.substring(0,i.length-1)):i)};function yr(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return bg(t)}catch{return t}}function tr(t){return typeof t=="string"?t:yg(t)||""}const wg="idb-keyval";var mg=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",r=i=>e+i;let n;return t.dbName&&t.storeName&&(n=Ba(t.dbName,t.storeName)),{name:wg,options:t,async hasItem(i){return!(typeof await Ca(r(i),n)>"u")},async getItem(i){return await Ca(r(i),n)??null},setItem(i,s){return fg(r(i),s,n)},removeItem(i){return hg(r(i),n)},getKeys(){return pg(n)},clear(){return dg(n)}}};const Eg="WALLET_CONNECT_V2_INDEXED_DB",vg="keyvaluestorage";class _g{constructor(){this.indexedDb=lg({driver:mg({dbName:Eg,storeName:vg})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const r=await this.indexedDb.getItem(e);if(r!==null)return r}async setItem(e,r){await this.indexedDb.setItem(e,tr(r))}async removeItem(e){await this.indexedDb.removeItem(e)}}var Wi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Fn={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,n){this[r]=String(n)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(n){r[n]=void 0,delete r[n]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Wi<"u"&&Wi.localStorage?Fn.exports=Wi.localStorage:typeof window<"u"&&window.localStorage?Fn.exports=window.localStorage:Fn.exports=new e})();function xg(t){var e;return[t[0],yr((e=t[1])!=null?e:"")]}class Dg{constructor(){this.localStorage=Fn.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(xg)}async getItem(e){const r=this.localStorage.getItem(e);if(r!==null)return yr(r)}async setItem(e,r){this.localStorage.setItem(e,tr(r))}async removeItem(e){this.localStorage.removeItem(e)}}const Ig="wc_storage_version",Ra=1,Sg=async(t,e,r)=>{const n=Ig,i=await e.getItem(n);if(i&&i>=Ra){r(e);return}const s=await t.getKeys();if(!s.length){r(e);return}const o=[];for(;s.length;){const a=s.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const u=await t.getItem(a);await e.setItem(a,u),o.push(a)}}await e.setItem(n,Ra),r(e),Og(t,o)},Og=async(t,e)=>{e.length&&e.forEach(async r=>{await t.removeItem(r)})};class Ag{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const e=new Dg;this.storage=e;try{const r=new _g;Sg(e,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,r){return await this.initialize(),this.storage.setItem(e,r)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),e())},20)})}}function Tg(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var Bg=Cg;function Cg(t,e,r){var n=r&&r.stringify||Tg,i=1;if(typeof t=="object"&&t!==null){var s=e.length+i;if(s===1)return t;var o=new Array(s);o[0]=n(t);for(var a=1;a<s;a++)o[a]=n(e[a]);return o.join(" ")}if(typeof t!="string")return t;var c=e.length;if(c===0)return t;for(var u="",l=1-i,f=-1,h=t&&t.length||0,g=0;g<h;){if(t.charCodeAt(g)===37&&g+1<h){switch(f=f>-1?f:0,t.charCodeAt(g+1)){case 100:case 102:if(l>=c||e[l]==null)break;f<g&&(u+=t.slice(f,g)),u+=Number(e[l]),f=g+2,g++;break;case 105:if(l>=c||e[l]==null)break;f<g&&(u+=t.slice(f,g)),u+=Math.floor(Number(e[l])),f=g+2,g++;break;case 79:case 111:case 106:if(l>=c||e[l]===void 0)break;f<g&&(u+=t.slice(f,g));var d=typeof e[l];if(d==="string"){u+="'"+e[l]+"'",f=g+2,g++;break}if(d==="function"){u+=e[l].name||"<anonymous>",f=g+2,g++;break}u+=n(e[l]),f=g+2,g++;break;case 115:if(l>=c)break;f<g&&(u+=t.slice(f,g)),u+=String(e[l]),f=g+2,g++;break;case 37:f<g&&(u+=t.slice(f,g)),u+="%",f=g+2,g++,l--;break}++l}++g}return f===-1?t:(f<h&&(u+=t.slice(f)),u)}const Na=Bg;var Bt=ut;const Mr=kg().console||{},Rg={mapHttpRequest:zn,mapHttpResponse:zn,wrapRequestSerializer:Yi,wrapResponseSerializer:Yi,wrapErrorSerializer:Yi,req:zn,res:zn,err:Ug};function Ng(t,e){return Array.isArray(t)?t.filter(function(n){return n!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function ut(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const r=t.browser.write||Mr;t.browser.write&&(t.browser.asObject=!0);const n=t.serializers||{},i=Ng(t.browser.serialize,n);let s=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(s=!1);const o=["error","fatal","warn","info","debug","trace"];typeof r=="function"&&(r.error=r.fatal=r.warn=r.info=r.debug=r.trace=r),t.enabled===!1&&(t.level="silent");const a=t.level||"info",c=Object.create(r);c.log||(c.log=Hr),Object.defineProperty(c,"levelVal",{get:l}),Object.defineProperty(c,"level",{get:f,set:h});const u={transmit:e,serialize:i,asObject:t.browser.asObject,levels:o,timestamp:Fg(t)};c.levels=ut.levels,c.level=a,c.setMaxListeners=c.getMaxListeners=c.emit=c.addListener=c.on=c.prependListener=c.once=c.prependOnceListener=c.removeListener=c.removeAllListeners=c.listeners=c.listenerCount=c.eventNames=c.write=c.flush=Hr,c.serializers=n,c._serialize=i,c._stdErrSerialize=s,c.child=g,e&&(c._logEvent=Gi());function l(){return this.level==="silent"?1/0:this.levels.values[this.level]}function f(){return this._level}function h(d){if(d!=="silent"&&!this.levels.values[d])throw Error("unknown level "+d);this._level=d,br(u,c,"error","log"),br(u,c,"fatal","error"),br(u,c,"warn","error"),br(u,c,"info","log"),br(u,c,"debug","log"),br(u,c,"trace","log")}function g(d,p){if(!d)throw new Error("missing bindings for child Pino");p=p||{},i&&d.serializers&&(p.serializers=d.serializers);const m=p.serializers;if(i&&m){var C=Object.assign({},n,m),P=t.browser.serialize===!0?Object.keys(C):i;delete d.serializers,jn([d],P,C,this._stdErrSerialize)}function E(_){this._childLevel=(_._childLevel|0)+1,this.error=wr(_,d,"error"),this.fatal=wr(_,d,"fatal"),this.warn=wr(_,d,"warn"),this.info=wr(_,d,"info"),this.debug=wr(_,d,"debug"),this.trace=wr(_,d,"trace"),C&&(this.serializers=C,this._serialize=P),e&&(this._logEvent=Gi([].concat(_._logEvent.bindings,d)))}return E.prototype=this,new E(this)}return c}ut.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},ut.stdSerializers=Rg,ut.stdTimeFunctions=Object.assign({},{nullTime:Pa,epochTime:$a,unixTime:jg,isoTime:zg});function br(t,e,r,n){const i=Object.getPrototypeOf(e);e[r]=e.levelVal>e.levels.values[r]?Hr:i[r]?i[r]:Mr[r]||Mr[n]||Hr,Pg(t,e,r)}function Pg(t,e,r){!t.transmit&&e[r]===Hr||(e[r]=function(n){return function(){const s=t.timestamp(),o=new Array(arguments.length),a=Object.getPrototypeOf&&Object.getPrototypeOf(this)===Mr?Mr:this;for(var c=0;c<o.length;c++)o[c]=arguments[c];if(t.serialize&&!t.asObject&&jn(o,this._serialize,this.serializers,this._stdErrSerialize),t.asObject?n.call(a,$g(this,r,o,s)):n.apply(a,o),t.transmit){const u=t.transmit.level||e.level,l=ut.levels.values[u],f=ut.levels.values[r];if(f<l)return;Lg(this,{ts:s,methodLevel:r,methodValue:f,transmitLevel:u,transmitValue:ut.levels.values[t.transmit.level||e.level],send:t.transmit.send,val:e.levelVal},o)}}}(e[r]))}function $g(t,e,r,n){t._serialize&&jn(r,t._serialize,t.serializers,t._stdErrSerialize);const i=r.slice();let s=i[0];const o={};n&&(o.time=n),o.level=ut.levels.values[e];let a=(t._childLevel|0)+1;if(a<1&&(a=1),s!==null&&typeof s=="object"){for(;a--&&typeof i[0]=="object";)Object.assign(o,i.shift());s=i.length?Na(i.shift(),i):void 0}else typeof s=="string"&&(s=Na(i.shift(),i));return s!==void 0&&(o.msg=s),o}function jn(t,e,r,n){for(const i in t)if(n&&t[i]instanceof Error)t[i]=ut.stdSerializers.err(t[i]);else if(typeof t[i]=="object"&&!Array.isArray(t[i]))for(const s in t[i])e&&e.indexOf(s)>-1&&s in r&&(t[i][s]=r[s](t[i][s]))}function wr(t,e,r){return function(){const n=new Array(1+arguments.length);n[0]=e;for(var i=1;i<n.length;i++)n[i]=arguments[i-1];return t[r].apply(this,n)}}function Lg(t,e,r){const n=e.send,i=e.ts,s=e.methodLevel,o=e.methodValue,a=e.val,c=t._logEvent.bindings;jn(r,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=i,t._logEvent.messages=r.filter(function(u){return c.indexOf(u)===-1}),t._logEvent.level.label=s,t._logEvent.level.value=o,n(s,t._logEvent,a),t._logEvent=Gi(c)}function Gi(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function Ug(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const r in t)e[r]===void 0&&(e[r]=t[r]);return e}function Fg(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?Pa:$a}function zn(){return{}}function Yi(t){return t}function Hr(){}function Pa(){return!1}function $a(){return Date.now()}function jg(){return Math.round(Date.now()/1e3)}function zg(){return new Date(Date.now()).toISOString()}function kg(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}const Mg={level:"info"},Vr="custom_context",Zi=1e3*1024;class Hg{constructor(e){this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}}class La{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const r=new Hg(e);if(r.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${r.size}`);for(;this.size+r.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=r),this.tail=r):(this.head=r,this.tail=r),this.lengthInNodes++,this.sizeInBytes+=r.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let r=this.head;for(;r!==null;)e.push(r.value),r=r.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const r=e.value;return e=e.next,{done:!1,value:r}}}}}class Ua{constructor(e,r=Zi){this.level=e??"error",this.levelValue=Bt.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=r,this.logs=new La(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,r){r===Bt.levels.values.error?console.error(e):r===Bt.levels.values.warn?console.warn(e):r===Bt.levels.values.debug?console.debug(e):r===Bt.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(tr({timestamp:new Date().toISOString(),log:e}));const r=typeof e=="string"?JSON.parse(e).level:e.level;r>=this.levelValue&&this.forwardToConsole(e,r)}getLogs(){return this.logs}clearLogs(){this.logs=new La(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const r=this.getLogArray();return r.push(tr({extraMetadata:e})),new Blob(r,{type:"application/json"})}}class Vg{constructor(e,r=Zi){this.baseChunkLogger=new Ua(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const r=URL.createObjectURL(this.logsToBlob(e)),n=document.createElement("a");n.href=r,n.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}}class Kg{constructor(e,r=Zi){this.baseChunkLogger=new Ua(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}}var qg=Object.defineProperty,Wg=Object.defineProperties,Gg=Object.getOwnPropertyDescriptors,Fa=Object.getOwnPropertySymbols,Yg=Object.prototype.hasOwnProperty,Zg=Object.prototype.propertyIsEnumerable,ja=(t,e,r)=>e in t?qg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,kn=(t,e)=>{for(var r in e||(e={}))Yg.call(e,r)&&ja(t,r,e[r]);if(Fa)for(var r of Fa(e))Zg.call(e,r)&&ja(t,r,e[r]);return t},Mn=(t,e)=>Wg(t,Gg(e));function za(t){return Mn(kn({},t),{level:t?.level||Mg.level})}function Xg(t,e=Vr){return t[e]||""}function Jg(t,e,r=Vr){return t[r]=e,t}function je(t,e=Vr){let r="";return typeof t.bindings>"u"?r=Xg(t,e):r=t.bindings().context||"",r}function Qg(t,e,r=Vr){const n=je(t,r);return n.trim()?`${n}/${e}`:e}function Te(t,e,r=Vr){const n=Qg(t,e,r),i=t.child({context:n});return Jg(i,n,r)}function ep(t){var e,r;const n=new Vg((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:Bt(Mn(kn({},t.opts),{level:"trace",browser:Mn(kn({},(r=t.opts)==null?void 0:r.browser),{write:i=>n.write(i)})})),chunkLoggerController:n}}function tp(t){var e;const r=new Kg((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:Bt(Mn(kn({},t.opts),{level:"trace"})),chunkLoggerController:r}}function rp(t){return typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string"?{logger:t.loggerOverride,chunkLoggerController:null}:typeof window<"u"?ep(t):tp(t)}var np=Object.defineProperty,ip=(t,e,r)=>e in t?np(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ka=(t,e,r)=>ip(t,typeof e!="symbol"?e+"":e,r);class sp extends Jt{constructor(e){super(),this.opts=e,ka(this,"protocol","wc"),ka(this,"version",2)}}var op=Object.defineProperty,ap=(t,e,r)=>e in t?op(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,cp=(t,e,r)=>ap(t,typeof e!="symbol"?e+"":e,r);class up extends Jt{constructor(e,r){super(),this.core=e,this.logger=r,cp(this,"records",new Map)}}class lp{constructor(e,r){this.logger=e,this.core=r}}class fp extends Jt{constructor(e,r){super(),this.relayer=e,this.logger=r}}class hp extends Jt{constructor(e){super()}}class dp{constructor(e,r,n,i){this.core=e,this.logger=r,this.name=n}}class gp extends Jt{constructor(e,r){super(),this.relayer=e,this.logger=r}}class pp extends Jt{constructor(e,r){super(),this.core=e,this.logger=r}}class yp{constructor(e,r,n){this.core=e,this.logger=r,this.store=n}}class bp{constructor(e,r){this.projectId=e,this.logger=r}}class wp{constructor(e,r,n){this.core=e,this.logger=r,this.telemetryEnabled=n}}const Xi="wc",Ji=2,Kr="core",tt=`${Xi}@2:${Kr}:`,Ma={name:Kr,logger:"error"},Ha={database:":memory:"},Va="crypto",Qi="client_ed25519_seed",Ka=V.ONE_DAY,qa="keychain",Wa="0.3",Ga="messages",Ya="0.3",es=V.SIX_HOURS,Za="publisher",Xa="irn",Ja="error",ts="wss://relay.walletconnect.org",Qa="relayer",de={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},ec="_subscription",ze={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},tc=.1,mp={database:":memory:"},Hn="2.21.4",Ep=1e4,rr={link_mode:"link_mode",relay:"relay"},qr={inbound:"inbound",outbound:"outbound"},rc="0.3",nc="WALLETCONNECT_CLIENT_ID",rs="WALLETCONNECT_LINK_MODE_APPS",Be={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},vp=V.THIRTY_DAYS,ic="subscription",sc="0.3",_p=V.FIVE_SECONDS*1e3,oc="pairing",ac="0.3",xp=V.THIRTY_DAYS,mr={wc_pairingDelete:{req:{ttl:V.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:V.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:V.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:V.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:V.ONE_DAY,prompt:!1,tag:0},res:{ttl:V.ONE_DAY,prompt:!1,tag:0}}},Er={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},We={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},cc="history",uc="0.3",lc="expirer",Ge={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},fc="0.3",Dp=V.ONE_DAY,hc="verify-api",Ip="https://verify.walletconnect.com",dc="https://verify.walletconnect.org",Wr=dc,gc=`${Wr}/v3`,pc=[Ip,dc],yc="echo",bc="https://echo.walletconnect.com",Sp="event-client",lt={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},bt={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},Op={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},Ap={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},Tp={authenticated_session_approve_started:"authenticated_session_approve_started",authenticated_session_not_expired:"authenticated_session_not_expired",chains_caip2_compliant:"chains_caip2_compliant",chains_evm_compliant:"chains_evm_compliant",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve",authenticated_session_approve_publish_success:"authenticated_session_approve_publish_success"},Bp={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",missing_session_authenticate_request:"missing_session_authenticate_request",session_authenticate_request_expired:"session_authenticate_request_expired",chains_caip2_compliant_failure:"chains_caip2_compliant_failure",chains_evm_compliant_failure:"chains_evm_compliant_failure",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},wc=.1,mc="event-client",Ec=86400,vc="https://pulse.walletconnect.org/batch";function Cp(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function _c(t,...e){if(!Cp(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function xc(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Rp(t,e){_c(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const vr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ns=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function Np(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function Dc(t){return typeof t=="string"&&(t=Np(t)),_c(t),t}class Pp{clone(){return this._cloneInto()}}function $p(t){const e=n=>t().update(Dc(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Ic(t=32){if(vr&&typeof vr.getRandomValues=="function")return vr.getRandomValues(new Uint8Array(t));if(vr&&typeof vr.randomBytes=="function")return vr.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function Lp(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,u=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+u,a,n)}class Up extends Pp{constructor(e,r,n,i){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=ns(this.buffer)}update(e){xc(this);const{view:r,buffer:n,blockLen:i}=this;e=Dc(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=ns(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){xc(this),Rp(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(n,0),o=0);for(let f=o;f<i;f++)r[f]=0;Lp(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=ns(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<u;f++)a.setUint32(4*f,l[f],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%r&&e.buffer.set(n),e}}const Vn=BigInt(2**32-1),is=BigInt(32);function Sc(t,e=!1){return e?{h:Number(t&Vn),l:Number(t>>is&Vn)}:{h:Number(t>>is&Vn)|0,l:Number(t&Vn)|0}}function Fp(t,e=!1){let r=new Uint32Array(t.length),n=new Uint32Array(t.length);for(let i=0;i<t.length;i++){const{h:s,l:o}=Sc(t[i],e);[r[i],n[i]]=[s,o]}return[r,n]}const jp=(t,e)=>BigInt(t>>>0)<<is|BigInt(e>>>0),zp=(t,e,r)=>t>>>r,kp=(t,e,r)=>t<<32-r|e>>>r,Mp=(t,e,r)=>t>>>r|e<<32-r,Hp=(t,e,r)=>t<<32-r|e>>>r,Vp=(t,e,r)=>t<<64-r|e>>>r-32,Kp=(t,e,r)=>t>>>r-32|e<<64-r,qp=(t,e)=>e,Wp=(t,e)=>t,Gp=(t,e,r)=>t<<r|e>>>32-r,Yp=(t,e,r)=>e<<r|t>>>32-r,Zp=(t,e,r)=>e<<r-32|t>>>64-r,Xp=(t,e,r)=>t<<r-32|e>>>64-r;function Jp(t,e,r,n){const i=(e>>>0)+(n>>>0);return{h:t+r+(i/2**32|0)|0,l:i|0}}const Qp=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),e0=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,t0=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),r0=(t,e,r,n,i)=>e+r+n+i+(t/2**32|0)|0,n0=(t,e,r,n,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(i>>>0),i0=(t,e,r,n,i,s)=>e+r+n+i+s+(t/2**32|0)|0,q={fromBig:Sc,split:Fp,toBig:jp,shrSH:zp,shrSL:kp,rotrSH:Mp,rotrSL:Hp,rotrBH:Vp,rotrBL:Kp,rotr32H:qp,rotr32L:Wp,rotlSH:Gp,rotlSL:Yp,rotlBH:Zp,rotlBL:Xp,add:Jp,add3L:Qp,add3H:e0,add4L:t0,add4H:r0,add5H:i0,add5L:n0},[s0,o0]=q.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),Ct=new Uint32Array(80),Rt=new Uint32Array(80);class a0 extends Up{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:r,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:f,Fl:h,Gh:g,Gl:d,Hh:p,Hl:m}=this;return[e,r,n,i,s,o,a,c,u,l,f,h,g,d,p,m]}set(e,r,n,i,s,o,a,c,u,l,f,h,g,d,p,m){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=f|0,this.Fl=h|0,this.Gh=g|0,this.Gl=d|0,this.Hh=p|0,this.Hl=m|0}process(e,r){for(let E=0;E<16;E++,r+=4)Ct[E]=e.getUint32(r),Rt[E]=e.getUint32(r+=4);for(let E=16;E<80;E++){const _=Ct[E-15]|0,S=Rt[E-15]|0,U=q.rotrSH(_,S,1)^q.rotrSH(_,S,8)^q.shrSH(_,S,7),$=q.rotrSL(_,S,1)^q.rotrSL(_,S,8)^q.shrSL(_,S,7),R=Ct[E-2]|0,w=Rt[E-2]|0,T=q.rotrSH(R,w,19)^q.rotrBH(R,w,61)^q.shrSH(R,w,6),x=q.rotrSL(R,w,19)^q.rotrBL(R,w,61)^q.shrSL(R,w,6),D=q.add4L($,x,Rt[E-7],Rt[E-16]),A=q.add4H(D,U,T,Ct[E-7],Ct[E-16]);Ct[E]=A|0,Rt[E]=D|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:f,El:h,Fh:g,Fl:d,Gh:p,Gl:m,Hh:C,Hl:P}=this;for(let E=0;E<80;E++){const _=q.rotrSH(f,h,14)^q.rotrSH(f,h,18)^q.rotrBH(f,h,41),S=q.rotrSL(f,h,14)^q.rotrSL(f,h,18)^q.rotrBL(f,h,41),U=f&g^~f&p,$=h&d^~h&m,R=q.add5L(P,S,$,o0[E],Rt[E]),w=q.add5H(R,C,_,U,s0[E],Ct[E]),T=R|0,x=q.rotrSH(n,i,28)^q.rotrBH(n,i,34)^q.rotrBH(n,i,39),D=q.rotrSL(n,i,28)^q.rotrBL(n,i,34)^q.rotrBL(n,i,39),A=n&s^n&a^s&a,L=i&o^i&c^o&c;C=p|0,P=m|0,p=g|0,m=d|0,g=f|0,d=h|0,{h:f,l:h}=q.add(u|0,l|0,w|0,T|0),u=a|0,l=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const b=q.add3L(T,D,L);n=q.add3H(b,w,x,A),i=b|0}({h:n,l:i}=q.add(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=q.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=q.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=q.add(this.Dh|0,this.Dl|0,u|0,l|0),{h:f,l:h}=q.add(this.Eh|0,this.El|0,f|0,h|0),{h:g,l:d}=q.add(this.Fh|0,this.Fl|0,g|0,d|0),{h:p,l:m}=q.add(this.Gh|0,this.Gl|0,p|0,m|0),{h:C,l:P}=q.add(this.Hh|0,this.Hl|0,C|0,P|0),this.set(n,i,s,o,a,c,u,l,f,h,g,d,p,m,C,P)}roundClean(){Ct.fill(0),Rt.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const c0=$p(()=>new a0);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ss=BigInt(0),Oc=BigInt(1),u0=BigInt(2);function os(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function as(t){if(!os(t))throw new Error("Uint8Array expected")}function cs(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const l0=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function us(t){as(t);let e="";for(let r=0;r<t.length;r++)e+=l0[t[r]];return e}function Ac(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?ss:BigInt("0x"+t)}const wt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Tc(t){if(t>=wt._0&&t<=wt._9)return t-wt._0;if(t>=wt.A&&t<=wt.F)return t-(wt.A-10);if(t>=wt.a&&t<=wt.f)return t-(wt.a-10)}function Bc(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=Tc(t.charCodeAt(s)),a=Tc(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function f0(t){return Ac(us(t))}function Kn(t){return as(t),Ac(us(Uint8Array.from(t).reverse()))}function Cc(t,e){return Bc(t.toString(16).padStart(e*2,"0"))}function ls(t,e){return Cc(t,e).reverse()}function mt(t,e,r){let n;if(typeof e=="string")try{n=Bc(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(os(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}function Rc(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];as(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}const fs=t=>typeof t=="bigint"&&ss<=t;function h0(t,e,r){return fs(t)&&fs(e)&&fs(r)&&e<=t&&t<r}function Gr(t,e,r,n){if(!h0(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function d0(t){let e;for(e=0;t>ss;t>>=Oc,e+=1);return e}const g0=t=>(u0<<BigInt(t-1))-Oc,p0={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||os(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function hs(t,e,r={}){const n=(i,s,o)=>{const a=p0[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))n(i,s,!1);for(const[i,s]of Object.entries(r))n(i,s,!0);return t}function Nc(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}const le=BigInt(0),se=BigInt(1),nr=BigInt(2),y0=BigInt(3),ds=BigInt(4),Pc=BigInt(5),$c=BigInt(8);function ae(t,e){const r=t%e;return r>=le?r:e+r}function b0(t,e,r){if(e<le)throw new Error("invalid exponent, negatives unsupported");if(r<=le)throw new Error("invalid modulus");if(r===se)return le;let n=se;for(;e>le;)e&se&&(n=n*t%r),t=t*t%r,e>>=se;return n}function ft(t,e,r){let n=t;for(;e-- >le;)n*=n,n%=r;return n}function Lc(t,e){if(t===le)throw new Error("invert: expected non-zero number");if(e<=le)throw new Error("invert: expected positive modulus, got "+e);let r=ae(t,e),n=e,i=le,s=se;for(;r!==le;){const o=n/r,a=n%r,c=i-s*o;n=r,r=a,i=s,s=c}if(n!==se)throw new Error("invert: does not exist");return ae(i,e)}function w0(t){const e=(t-se)/nr;let r,n,i;for(r=t-se,n=0;r%nr===le;r/=nr,n++);for(i=nr;i<t&&b0(i,e,t)!==t-se;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const o=(t+se)/ds;return function(a,c){const u=a.pow(c,o);if(!a.eql(a.sqr(u),c))throw new Error("Cannot find square root");return u}}const s=(r+se)/nr;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=n,u=o.pow(o.mul(o.ONE,i),r),l=o.pow(a,s),f=o.pow(a,r);for(;!o.eql(f,o.ONE);){if(o.eql(f,o.ZERO))return o.ZERO;let h=1;for(let d=o.sqr(f);h<c&&!o.eql(d,o.ONE);h++)d=o.sqr(d);const g=o.pow(u,se<<BigInt(c-h-1));u=o.sqr(g),l=o.mul(l,g),f=o.mul(f,u),c=h}return l}}function m0(t){if(t%ds===y0){const e=(t+se)/ds;return function(r,n){const i=r.pow(n,e);if(!r.eql(r.sqr(i),n))throw new Error("Cannot find square root");return i}}if(t%$c===Pc){const e=(t-Pc)/$c;return function(r,n){const i=r.mul(n,nr),s=r.pow(i,e),o=r.mul(n,s),a=r.mul(r.mul(o,nr),s),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),n))throw new Error("Cannot find square root");return c}}return w0(t)}const E0=(t,e)=>(ae(t,e)&se)===se,v0=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function _0(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=v0.reduce((n,i)=>(n[i]="function",n),e);return hs(t,r)}function x0(t,e,r){if(r<le)throw new Error("invalid exponent, negatives unsupported");if(r===le)return t.ONE;if(r===se)return e;let n=t.ONE,i=e;for(;r>le;)r&se&&(n=t.mul(n,i)),i=t.sqr(i),r>>=se;return n}function D0(t,e){const r=new Array(e.length),n=e.reduce((s,o,a)=>t.is0(o)?s:(r[a]=s,t.mul(s,o)),t.ONE),i=t.inv(n);return e.reduceRight((s,o,a)=>t.is0(o)?s:(r[a]=t.mul(s,r[a]),t.mul(s,o)),i),r}function Uc(t,e){const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Fc(t,e,r=!1,n={}){if(t<=le)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=Uc(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:i,BYTES:s,MASK:g0(i),ZERO:le,ONE:se,create:c=>ae(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return le<=c&&c<t},is0:c=>c===le,isOdd:c=>(c&se)===se,neg:c=>ae(-c,t),eql:(c,u)=>c===u,sqr:c=>ae(c*c,t),add:(c,u)=>ae(c+u,t),sub:(c,u)=>ae(c-u,t),mul:(c,u)=>ae(c*u,t),pow:(c,u)=>x0(a,c,u),div:(c,u)=>ae(c*Lc(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Lc(c,t),sqrt:n.sqrt||(c=>(o||(o=m0(t)),o(a,c))),invertBatch:c=>D0(a,c),cmov:(c,u,l)=>l?u:c,toBytes:c=>r?ls(c,s):Cc(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?Kn(c):f0(c)}});return Object.freeze(a)}const jc=BigInt(0),qn=BigInt(1);function gs(t,e){const r=e.negate();return t?r:e}function zc(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function ps(t,e){zc(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1);return{windows:r,windowSize:n}}function I0(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function S0(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const ys=new WeakMap,kc=new WeakMap;function bs(t){return kc.get(t)||1}function O0(t,e){return{constTimeNegate:gs,hasPrecomputes(r){return bs(r)!==1},unsafeLadder(r,n,i=t.ZERO){let s=r;for(;n>jc;)n&qn&&(i=i.add(s)),s=s.double(),n>>=qn;return i},precomputeWindow(r,n){const{windows:i,windowSize:s}=ps(n,e),o=[];let a=r,c=a;for(let u=0;u<i;u++){c=a,o.push(c);for(let l=1;l<s;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,i){const{windows:s,windowSize:o}=ps(r,e);let a=t.ZERO,c=t.BASE;const u=BigInt(2**r-1),l=2**r,f=BigInt(r);for(let h=0;h<s;h++){const g=h*o;let d=Number(i&u);i>>=f,d>o&&(d-=l,i+=qn);const p=g,m=g+Math.abs(d)-1,C=h%2!==0,P=d<0;d===0?c=c.add(gs(C,n[p])):a=a.add(gs(P,n[m]))}return{p:a,f:c}},wNAFUnsafe(r,n,i,s=t.ZERO){const{windows:o,windowSize:a}=ps(r,e),c=BigInt(2**r-1),u=2**r,l=BigInt(r);for(let f=0;f<o;f++){const h=f*a;if(i===jc)break;let g=Number(i&c);if(i>>=l,g>a&&(g-=u,i+=qn),g===0)continue;let d=n[h+Math.abs(g)-1];g<0&&(d=d.negate()),s=s.add(d)}return s},getPrecomputes(r,n,i){let s=ys.get(n);return s||(s=this.precomputeWindow(n,r),r!==1&&ys.set(n,i(s))),s},wNAFCached(r,n,i){const s=bs(r);return this.wNAF(s,this.getPrecomputes(s,r,i),n)},wNAFCachedUnsafe(r,n,i,s){const o=bs(r);return o===1?this.unsafeLadder(r,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,i),n,s)},setWindowSize(r,n){zc(n,e),kc.set(r,n),ys.delete(r)}}}function A0(t,e,r,n){if(I0(r,t),S0(n,e),r.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const i=t.ZERO,s=d0(BigInt(r.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i),u=Math.floor((e.BITS-1)/o)*o;let l=i;for(let f=u;f>=0;f-=o){c.fill(i);for(let g=0;g<n.length;g++){const d=n[g],p=Number(d>>BigInt(f)&BigInt(a));c[p]=c[p].add(r[g])}let h=i;for(let g=c.length-1,d=i;g>0;g--)d=d.add(c[g]),h=h.add(d);if(l=l.add(h),f!==0)for(let g=0;g<o;g++)l=l.double()}return l}function T0(t){return _0(t.Fp),hs(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Uc(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const rt=BigInt(0),Ce=BigInt(1),Wn=BigInt(2),B0=BigInt(8),C0={zip215:!0};function R0(t){const e=T0(t);return hs(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function N0(t){const e=R0(t),{Fp:r,n,prehash:i,hash:s,randomBytes:o,nByteLength:a,h:c}=e,u=Wn<<BigInt(a*8)-Ce,l=r.create,f=Fc(e.n,e.nBitLength),h=e.uvRatio||((b,y)=>{try{return{isValid:!0,value:r.sqrt(b*r.inv(y))}}catch{return{isValid:!1,value:rt}}}),g=e.adjustScalarBytes||(b=>b),d=e.domain||((b,y,v)=>{if(cs("phflag",v),y.length||v)throw new Error("Contexts/pre-hash are not supported");return b});function p(b,y){Gr("coordinate "+b,y,rt,u)}function m(b){if(!(b instanceof E))throw new Error("ExtendedPoint expected")}const C=Nc((b,y)=>{const{ex:v,ey:O,ez:I}=b,B=b.is0();y==null&&(y=B?B0:r.inv(I));const N=l(v*y),F=l(O*y),k=l(I*y);if(B)return{x:rt,y:Ce};if(k!==Ce)throw new Error("invZ was invalid");return{x:N,y:F}}),P=Nc(b=>{const{a:y,d:v}=e;if(b.is0())throw new Error("bad point: ZERO");const{ex:O,ey:I,ez:B,et:N}=b,F=l(O*O),k=l(I*I),H=l(B*B),M=l(H*H),K=l(F*y),Y=l(H*l(K+k)),Q=l(M+l(v*l(F*k)));if(Y!==Q)throw new Error("bad point: equation left != right (1)");const W=l(O*I),ie=l(B*N);if(W!==ie)throw new Error("bad point: equation left != right (2)");return!0});class E{constructor(y,v,O,I){this.ex=y,this.ey=v,this.ez=O,this.et=I,p("x",y),p("y",v),p("z",O),p("t",I),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(y){if(y instanceof E)throw new Error("extended point not allowed");const{x:v,y:O}=y||{};return p("x",v),p("y",O),new E(v,O,Ce,l(v*O))}static normalizeZ(y){const v=r.invertBatch(y.map(O=>O.ez));return y.map((O,I)=>O.toAffine(v[I])).map(E.fromAffine)}static msm(y,v){return A0(E,f,y,v)}_setWindowSize(y){U.setWindowSize(this,y)}assertValidity(){P(this)}equals(y){m(y);const{ex:v,ey:O,ez:I}=this,{ex:B,ey:N,ez:F}=y,k=l(v*F),H=l(B*I),M=l(O*F),K=l(N*I);return k===H&&M===K}is0(){return this.equals(E.ZERO)}negate(){return new E(l(-this.ex),this.ey,this.ez,l(-this.et))}double(){const{a:y}=e,{ex:v,ey:O,ez:I}=this,B=l(v*v),N=l(O*O),F=l(Wn*l(I*I)),k=l(y*B),H=v+O,M=l(l(H*H)-B-N),K=k+N,Y=K-F,Q=k-N,W=l(M*Y),ie=l(K*Q),me=l(M*Q),pt=l(Y*K);return new E(W,ie,pt,me)}add(y){m(y);const{a:v,d:O}=e,{ex:I,ey:B,ez:N,et:F}=this,{ex:k,ey:H,ez:M,et:K}=y;if(v===BigInt(-1)){const sd=l((B-I)*(H+k)),od=l((B+I)*(H-k)),ia=l(od-sd);if(ia===rt)return this.double();const ad=l(N*Wn*K),cd=l(F*Wn*M),ud=cd+ad,ld=od+sd,fd=cd-ad,c8=l(ud*ia),u8=l(ld*fd),l8=l(ud*fd),f8=l(ia*ld);return new E(c8,u8,f8,l8)}const Y=l(I*k),Q=l(B*H),W=l(F*O*K),ie=l(N*M),me=l((I+B)*(k+H)-Y-Q),pt=ie-W,yt=ie+W,Gt=l(Q-v*Y),Yt=l(me*pt),Li=l(yt*Gt),o8=l(me*Gt),a8=l(pt*yt);return new E(Yt,Li,a8,o8)}subtract(y){return this.add(y.negate())}wNAF(y){return U.wNAFCached(this,y,E.normalizeZ)}multiply(y){const v=y;Gr("scalar",v,Ce,n);const{p:O,f:I}=this.wNAF(v);return E.normalizeZ([O,I])[0]}multiplyUnsafe(y,v=E.ZERO){const O=y;return Gr("scalar",O,rt,n),O===rt?S:this.is0()||O===Ce?this:U.wNAFCachedUnsafe(this,O,E.normalizeZ,v)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return U.unsafeLadder(this,n).is0()}toAffine(y){return C(this,y)}clearCofactor(){const{h:y}=e;return y===Ce?this:this.multiplyUnsafe(y)}static fromHex(y,v=!1){const{d:O,a:I}=e,B=r.BYTES;y=mt("pointHex",y,B),cs("zip215",v);const N=y.slice(),F=y[B-1];N[B-1]=F&-129;const k=Kn(N),H=v?u:r.ORDER;Gr("pointHex.y",k,rt,H);const M=l(k*k),K=l(M-Ce),Y=l(O*M-I);let{isValid:Q,value:W}=h(K,Y);if(!Q)throw new Error("Point.fromHex: invalid y coordinate");const ie=(W&Ce)===Ce,me=(F&128)!==0;if(!v&&W===rt&&me)throw new Error("Point.fromHex: x=0 and x_0=1");return me!==ie&&(W=l(-W)),E.fromAffine({x:W,y:k})}static fromPrivateKey(y){return w(y).point}toRawBytes(){const{x:y,y:v}=this.toAffine(),O=ls(v,r.BYTES);return O[O.length-1]|=y&Ce?128:0,O}toHex(){return us(this.toRawBytes())}}E.BASE=new E(e.Gx,e.Gy,Ce,l(e.Gx*e.Gy)),E.ZERO=new E(rt,Ce,Ce,rt);const{BASE:_,ZERO:S}=E,U=O0(E,a*8);function $(b){return ae(b,n)}function R(b){return $(Kn(b))}function w(b){const y=r.BYTES;b=mt("private key",b,y);const v=mt("hashed private key",s(b),2*y),O=g(v.slice(0,y)),I=v.slice(y,2*y),B=R(O),N=_.multiply(B),F=N.toRawBytes();return{head:O,prefix:I,scalar:B,point:N,pointBytes:F}}function T(b){return w(b).pointBytes}function x(b=new Uint8Array,...y){const v=Rc(...y);return R(s(d(v,mt("context",b),!!i)))}function D(b,y,v={}){b=mt("message",b),i&&(b=i(b));const{prefix:O,scalar:I,pointBytes:B}=w(y),N=x(v.context,O,b),F=_.multiply(N).toRawBytes(),k=x(v.context,F,B,b),H=$(N+k*I);Gr("signature.s",H,rt,n);const M=Rc(F,ls(H,r.BYTES));return mt("result",M,r.BYTES*2)}const A=C0;function L(b,y,v,O=A){const{context:I,zip215:B}=O,N=r.BYTES;b=mt("signature",b,2*N),y=mt("message",y),v=mt("publicKey",v,N),B!==void 0&&cs("zip215",B),i&&(y=i(y));const F=Kn(b.slice(N,2*N));let k,H,M;try{k=E.fromHex(v,B),H=E.fromHex(b.slice(0,N),B),M=_.multiplyUnsafe(F)}catch{return!1}if(!B&&k.isSmallOrder())return!1;const K=x(I,H.toRawBytes(),k.toRawBytes(),y);return H.add(k.multiplyUnsafe(K)).subtract(M).clearCofactor().equals(E.ZERO)}return _._setWindowSize(8),{CURVE:e,getPublicKey:T,sign:D,verify:L,ExtendedPoint:E,utils:{getExtendedPublicKey:w,randomPrivateKey:()=>o(r.BYTES),precompute(b=8,y=E.BASE){return y._setWindowSize(b),y.multiply(BigInt(3)),y}}}}BigInt(0),BigInt(1);const ws=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Mc=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const P0=BigInt(1),Hc=BigInt(2);BigInt(3);const $0=BigInt(5),L0=BigInt(8);function U0(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),i=BigInt(80),s=ws,o=t*t%s*t%s,a=ft(o,Hc,s)*o%s,c=ft(a,P0,s)*t%s,u=ft(c,$0,s)*c%s,l=ft(u,e,s)*u%s,f=ft(l,r,s)*l%s,h=ft(f,n,s)*f%s,g=ft(h,i,s)*h%s,d=ft(g,i,s)*h%s,p=ft(d,e,s)*u%s;return{pow_p_5_8:ft(p,Hc,s)*t%s,b2:o}}function F0(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function j0(t,e){const r=ws,n=ae(e*e*e,r),i=ae(n*n*e,r),s=U0(t*i).pow_p_5_8;let o=ae(t*n*s,r);const a=ae(e*o*o,r),c=o,u=ae(o*Mc,r),l=a===t,f=a===ae(-t,r),h=a===ae(-t*Mc,r);return l&&(o=c),(f||h)&&(o=u),E0(o,r)&&(o=ae(-o,r)),{isValid:l||f,value:o}}const z0=Fc(ws,void 0,!0),k0={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:z0,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:L0,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:c0,randomBytes:Ic,adjustScalarBytes:F0,uvRatio:j0},Vc=N0(k0),M0="EdDSA",H0="JWT",Gn=".",Yn="base64url",Kc="utf8",qc="utf8",V0=":",K0="did",q0="key",Wc="base58btc",W0="z",G0="K36",Y0=32;function ms(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Gc(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?ms(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Yc(t,e){e||(e=t.reduce((i,s)=>i+s.length,0));const r=Gc(e);let n=0;for(const i of t)r.set(i,n),n+=i.length;return ms(r)}function Z0(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=i}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function f(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,m=0,C=0,P=d.length;C!==P&&d[C]===0;)C++,p++;for(var E=(P-C)*l+1>>>0,_=new Uint8Array(E);C!==P;){for(var S=d[C],U=0,$=E-1;(S!==0||U<m)&&$!==-1;$--,U++)S+=256*_[$]>>>0,_[$]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");m=U,C++}for(var R=E-m;R!==E&&_[R]===0;)R++;for(var w=c.repeat(p);R<E;++R)w+=t.charAt(_[R]);return w}function h(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var m=0,C=0;d[p]===c;)m++,p++;for(var P=(d.length-p)*u+1>>>0,E=new Uint8Array(P);d[p];){var _=r[d.charCodeAt(p)];if(_===255)return;for(var S=0,U=P-1;(_!==0||S<C)&&U!==-1;U--,S++)_+=a*E[U]>>>0,E[U]=_%256>>>0,_=_/256>>>0;if(_!==0)throw new Error("Non-zero carry");C=S,p++}if(d[p]!==" "){for(var $=P-C;$!==P&&E[$]===0;)$++;for(var R=new Uint8Array(m+(P-$)),w=m;$!==P;)R[w++]=E[$++];return R}}}function g(d){var p=h(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:h,decode:g}}var X0=Z0,J0=X0;const Zc=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Q0=t=>new TextEncoder().encode(t),ey=t=>new TextDecoder().decode(t);class ty{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class ry{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Xc(this,e)}}class ny{constructor(e){this.decoders=e}or(e){return Xc(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Xc=(t,e)=>new ny({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class iy{constructor(e,r,n,i){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new ty(e,r,n),this.decoder=new ry(e,r,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Zn=({name:t,prefix:e,encode:r,decode:n})=>new iy(t,e,r,n),Yr=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:i}=J0(r,e);return Zn({prefix:t,name:e,encode:n,decode:s=>Zc(i(s))})},sy=(t,e,r,n)=>{const i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const f=i[t[l]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|f,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},oy=(t,e,r)=>{const n=e[e.length-1]==="=",i=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[i&a>>o];if(o&&(s+=e[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},ge=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>Zn({prefix:e,name:t,encode(i){return oy(i,n,r)},decode(i){return sy(i,n,r,t)}}),ay=Zn({prefix:"\0",name:"identity",encode:t=>ey(t),decode:t=>Q0(t)});var cy=Object.freeze({__proto__:null,identity:ay});const uy=ge({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var ly=Object.freeze({__proto__:null,base2:uy});const fy=ge({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var hy=Object.freeze({__proto__:null,base8:fy});const dy=Yr({prefix:"9",name:"base10",alphabet:"0123456789"});var gy=Object.freeze({__proto__:null,base10:dy});const py=ge({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),yy=ge({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var by=Object.freeze({__proto__:null,base16:py,base16upper:yy});const wy=ge({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),my=ge({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Ey=ge({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),vy=ge({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),_y=ge({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),xy=ge({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Dy=ge({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Iy=ge({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Sy=ge({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Oy=Object.freeze({__proto__:null,base32:wy,base32upper:my,base32pad:Ey,base32padupper:vy,base32hex:_y,base32hexupper:xy,base32hexpad:Dy,base32hexpadupper:Iy,base32z:Sy});const Ay=Yr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Ty=Yr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var By=Object.freeze({__proto__:null,base36:Ay,base36upper:Ty});const Cy=Yr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Ry=Yr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Ny=Object.freeze({__proto__:null,base58btc:Cy,base58flickr:Ry});const Py=ge({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),$y=ge({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ly=ge({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Uy=ge({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Fy=Object.freeze({__proto__:null,base64:Py,base64pad:$y,base64url:Ly,base64urlpad:Uy});const Jc=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),jy=Jc.reduce((t,e,r)=>(t[r]=e,t),[]),zy=Jc.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function ky(t){return t.reduce((e,r)=>(e+=jy[r],e),"")}function My(t){const e=[];for(const r of t){const n=zy[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const Hy=Zn({prefix:"\u{1F680}",name:"base256emoji",encode:ky,decode:My});var Vy=Object.freeze({__proto__:null,base256emoji:Hy}),Ky=eu,Qc=128,qy=127,Wy=~qy,Gy=Math.pow(2,31);function eu(t,e,r){e=e||[],r=r||0;for(var n=r;t>=Gy;)e[r++]=t&255|Qc,t/=128;for(;t&Wy;)e[r++]=t&255|Qc,t>>>=7;return e[r]=t|0,eu.bytes=r-n+1,e}var Yy=Es,Zy=128,tu=127;function Es(t,n){var r=0,n=n||0,i=0,s=n,o,a=t.length;do{if(s>=a)throw Es.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=i<28?(o&tu)<<i:(o&tu)*Math.pow(2,i),i+=7}while(o>=Zy);return Es.bytes=s-n,r}var Xy=Math.pow(2,7),Jy=Math.pow(2,14),Qy=Math.pow(2,21),eb=Math.pow(2,28),tb=Math.pow(2,35),rb=Math.pow(2,42),nb=Math.pow(2,49),ib=Math.pow(2,56),sb=Math.pow(2,63),ob=function(t){return t<Xy?1:t<Jy?2:t<Qy?3:t<eb?4:t<tb?5:t<rb?6:t<nb?7:t<ib?8:t<sb?9:10},ab={encode:Ky,decode:Yy,encodingLength:ob},ru=ab;const nu=(t,e,r=0)=>(ru.encode(t,e,r),e),iu=t=>ru.encodingLength(t),vs=(t,e)=>{const r=e.byteLength,n=iu(t),i=n+iu(r),s=new Uint8Array(i+r);return nu(t,s,0),nu(r,s,n),s.set(e,i),new cb(t,r,e,s)};class cb{constructor(e,r,n,i){this.code=e,this.size=r,this.digest=n,this.bytes=i}}const su=({name:t,code:e,encode:r})=>new ub(t,e,r);class ub{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?vs(this.code,r):r.then(n=>vs(this.code,n))}else throw Error("Unknown type, must be binary type")}}const ou=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),lb=su({name:"sha2-256",code:18,encode:ou("SHA-256")}),fb=su({name:"sha2-512",code:19,encode:ou("SHA-512")});var hb=Object.freeze({__proto__:null,sha256:lb,sha512:fb});const au=0,db="identity",cu=Zc;var gb=Object.freeze({__proto__:null,identity:{code:au,name:db,encode:cu,digest:t=>vs(au,cu(t))}});new TextEncoder,new TextDecoder;const uu={...cy,...ly,...hy,...gy,...by,...Oy,...By,...Ny,...Fy,...Vy};({...hb,...gb});function lu(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const fu=lu("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),_s=lu("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Gc(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),hu={utf8:fu,"utf-8":fu,hex:uu.base16,latin1:_s,ascii:_s,binary:_s,...uu};function Xn(t,e="utf8"){const r=hu[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function _r(t,e="utf8"){const r=hu[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?ms(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function du(t){return yr(Xn(_r(t,Yn),Kc))}function Jn(t){return Xn(_r(tr(t),Kc),Yn)}function gu(t){const e=_r(G0,Wc),r=W0+Xn(Yc([e,t]),Wc);return[K0,q0,r].join(V0)}function pb(t){return Xn(t,Yn)}function yb(t){return _r(t,Yn)}function bb(t){return _r([Jn(t.header),Jn(t.payload)].join(Gn),qc)}function wb(t){return[Jn(t.header),Jn(t.payload),pb(t.signature)].join(Gn)}function xs(t){const e=t.split(Gn),r=du(e[0]),n=du(e[1]),i=yb(e[2]),s=_r(e.slice(0,2).join(Gn),qc);return{header:r,payload:n,signature:i,data:s}}function pu(t=Ic(Y0)){const e=Vc.getPublicKey(t);return{secretKey:Yc([t,e]),publicKey:e}}async function mb(t,e,r,n,i=V.fromMiliseconds(Date.now())){const s={alg:M0,typ:H0},o=gu(n.publicKey),a=i+r,c={iss:o,sub:t,aud:e,iat:i,exp:a},u=bb({header:s,payload:c}),l=Vc.sign(u,n.secretKey.slice(0,32));return wb({header:s,payload:c,signature:l})}function Eb(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=i}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function f(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,m=0,C=0,P=d.length;C!==P&&d[C]===0;)C++,p++;for(var E=(P-C)*l+1>>>0,_=new Uint8Array(E);C!==P;){for(var S=d[C],U=0,$=E-1;(S!==0||U<m)&&$!==-1;$--,U++)S+=256*_[$]>>>0,_[$]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");m=U,C++}for(var R=E-m;R!==E&&_[R]===0;)R++;for(var w=c.repeat(p);R<E;++R)w+=t.charAt(_[R]);return w}function h(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var m=0,C=0;d[p]===c;)m++,p++;for(var P=(d.length-p)*u+1>>>0,E=new Uint8Array(P);d[p];){var _=r[d.charCodeAt(p)];if(_===255)return;for(var S=0,U=P-1;(_!==0||S<C)&&U!==-1;U--,S++)_+=a*E[U]>>>0,E[U]=_%256>>>0,_=_/256>>>0;if(_!==0)throw new Error("Non-zero carry");C=S,p++}if(d[p]!==" "){for(var $=P-C;$!==P&&E[$]===0;)$++;for(var R=new Uint8Array(m+(P-$)),w=m;$!==P;)R[w++]=E[$++];return R}}}function g(d){var p=h(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:h,decode:g}}var vb=Eb,_b=vb;const yu=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},xb=t=>new TextEncoder().encode(t),Db=t=>new TextDecoder().decode(t);class Ib{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Sb{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return bu(this,e)}}class Ob{constructor(e){this.decoders=e}or(e){return bu(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const bu=(t,e)=>new Ob({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class Ab{constructor(e,r,n,i){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new Ib(e,r,n),this.decoder=new Sb(e,r,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Qn=({name:t,prefix:e,encode:r,decode:n})=>new Ab(t,e,r,n),Zr=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:i}=_b(r,e);return Qn({prefix:t,name:e,encode:n,decode:s=>yu(i(s))})},Tb=(t,e,r,n)=>{const i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const f=i[t[l]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|f,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Bb=(t,e,r)=>{const n=e[e.length-1]==="=",i=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[i&a>>o];if(o&&(s+=e[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},pe=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>Qn({prefix:e,name:t,encode(i){return Bb(i,n,r)},decode(i){return Tb(i,n,r,t)}}),Cb=Qn({prefix:"\0",name:"identity",encode:t=>Db(t),decode:t=>xb(t)});var Rb=Object.freeze({__proto__:null,identity:Cb});const Nb=pe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Pb=Object.freeze({__proto__:null,base2:Nb});const $b=pe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Lb=Object.freeze({__proto__:null,base8:$b});const Ub=Zr({prefix:"9",name:"base10",alphabet:"0123456789"});var Fb=Object.freeze({__proto__:null,base10:Ub});const jb=pe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),zb=pe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var kb=Object.freeze({__proto__:null,base16:jb,base16upper:zb});const Mb=pe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Hb=pe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Vb=pe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Kb=pe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),qb=pe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Wb=pe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Gb=pe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Yb=pe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Zb=pe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Xb=Object.freeze({__proto__:null,base32:Mb,base32upper:Hb,base32pad:Vb,base32padupper:Kb,base32hex:qb,base32hexupper:Wb,base32hexpad:Gb,base32hexpadupper:Yb,base32z:Zb});const Jb=Zr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Qb=Zr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var ew=Object.freeze({__proto__:null,base36:Jb,base36upper:Qb});const tw=Zr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),rw=Zr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var nw=Object.freeze({__proto__:null,base58btc:tw,base58flickr:rw});const iw=pe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),sw=pe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ow=pe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),aw=pe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var cw=Object.freeze({__proto__:null,base64:iw,base64pad:sw,base64url:ow,base64urlpad:aw});const wu=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),uw=wu.reduce((t,e,r)=>(t[r]=e,t),[]),lw=wu.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function fw(t){return t.reduce((e,r)=>(e+=uw[r],e),"")}function hw(t){const e=[];for(const r of t){const n=lw[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const dw=Qn({prefix:"\u{1F680}",name:"base256emoji",encode:fw,decode:hw});var gw=Object.freeze({__proto__:null,base256emoji:dw}),pw=Eu,mu=128,yw=127,bw=~yw,ww=Math.pow(2,31);function Eu(t,e,r){e=e||[],r=r||0;for(var n=r;t>=ww;)e[r++]=t&255|mu,t/=128;for(;t&bw;)e[r++]=t&255|mu,t>>>=7;return e[r]=t|0,Eu.bytes=r-n+1,e}var mw=Ds,Ew=128,vu=127;function Ds(t,n){var r=0,n=n||0,i=0,s=n,o,a=t.length;do{if(s>=a)throw Ds.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=i<28?(o&vu)<<i:(o&vu)*Math.pow(2,i),i+=7}while(o>=Ew);return Ds.bytes=s-n,r}var vw=Math.pow(2,7),_w=Math.pow(2,14),xw=Math.pow(2,21),Dw=Math.pow(2,28),Iw=Math.pow(2,35),Sw=Math.pow(2,42),Ow=Math.pow(2,49),Aw=Math.pow(2,56),Tw=Math.pow(2,63),Bw=function(t){return t<vw?1:t<_w?2:t<xw?3:t<Dw?4:t<Iw?5:t<Sw?6:t<Ow?7:t<Aw?8:t<Tw?9:10},Cw={encode:pw,decode:mw,encodingLength:Bw},_u=Cw;const xu=(t,e,r=0)=>(_u.encode(t,e,r),e),Du=t=>_u.encodingLength(t),Is=(t,e)=>{const r=e.byteLength,n=Du(t),i=n+Du(r),s=new Uint8Array(i+r);return xu(t,s,0),xu(r,s,n),s.set(e,i),new Rw(t,r,e,s)};class Rw{constructor(e,r,n,i){this.code=e,this.size=r,this.digest=n,this.bytes=i}}const Iu=({name:t,code:e,encode:r})=>new Nw(t,e,r);class Nw{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Is(this.code,r):r.then(n=>Is(this.code,n))}else throw Error("Unknown type, must be binary type")}}const Su=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Pw=Iu({name:"sha2-256",code:18,encode:Su("SHA-256")}),$w=Iu({name:"sha2-512",code:19,encode:Su("SHA-512")});var Lw=Object.freeze({__proto__:null,sha256:Pw,sha512:$w});const Ou=0,Uw="identity",Au=yu;var Fw=Object.freeze({__proto__:null,identity:{code:Ou,name:Uw,encode:Au,digest:t=>Is(Ou,Au(t))}});new TextEncoder,new TextDecoder;const Tu={...Rb,...Pb,...Lb,...Fb,...kb,...Xb,...ew,...nw,...cw,...gw};({...Lw,...Fw});function Ss(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Bu(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Ss(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Cu(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const Ru=Cu("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Os=Cu("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Bu(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Nu={utf8:Ru,"utf-8":Ru,hex:Tu.base16,latin1:Os,ascii:Os,binary:Os,...Tu};function ke(t,e="utf8"){const r=Nu[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Ss(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}var Pu=function(t,e,r){if(r||arguments.length===2)for(var n=0,i=e.length,s;n<i;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return t.concat(s||Array.prototype.slice.call(e))},jw=function(){function t(e,r,n){this.name=e,this.version=r,this.os=n,this.type="browser"}return t}(),zw=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),kw=function(){function t(e,r,n,i){this.name=e,this.version=r,this.os=n,this.bot=i,this.type="bot-device"}return t}(),Mw=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),Hw=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),Vw=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Kw=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,$u=3,qw=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Vw]],Lu=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Ww(t){return t?Uu(t):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new Hw:typeof navigator<"u"?Uu(navigator.userAgent):Zw()}function Gw(t){return t!==""&&qw.reduce(function(e,r){var n=r[0],i=r[1];if(e)return e;var s=i.exec(t);return!!s&&[n,s]},!1)}function Uu(t){var e=Gw(t);if(!e)return null;var r=e[0],n=e[1];if(r==="searchbot")return new Mw;var i=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);i?i.length<$u&&(i=Pu(Pu([],i,!0),Xw($u-i.length),!0)):i=[];var s=i.join("."),o=Yw(t),a=Kw.exec(t);return a&&a[1]?new kw(r,s,o,a[1]):new jw(r,s,o)}function Yw(t){for(var e=0,r=Lu.length;e<r;e++){var n=Lu[e],i=n[0],s=n[1],o=s.exec(t);if(o)return i}return null}function Zw(){var t=typeof process<"u"&&process.version;return t?new zw(process.version.slice(1)):null}function Xw(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var re={};Object.defineProperty(re,"__esModule",{value:!0}),re.getLocalStorage=re.getLocalStorageOrThrow=re.getCrypto=re.getCryptoOrThrow=Fu=re.getLocation=re.getLocationOrThrow=As=re.getNavigator=re.getNavigatorOrThrow=Dr=re.getDocument=re.getDocumentOrThrow=re.getFromWindowOrThrow=re.getFromWindow=void 0;function ir(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}re.getFromWindow=ir;function xr(t){const e=ir(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}re.getFromWindowOrThrow=xr;function Jw(){return xr("document")}re.getDocumentOrThrow=Jw;function Qw(){return ir("document")}var Dr=re.getDocument=Qw;function e1(){return xr("navigator")}re.getNavigatorOrThrow=e1;function t1(){return ir("navigator")}var As=re.getNavigator=t1;function r1(){return xr("location")}re.getLocationOrThrow=r1;function n1(){return ir("location")}var Fu=re.getLocation=n1;function i1(){return xr("crypto")}re.getCryptoOrThrow=i1;function s1(){return ir("crypto")}re.getCrypto=s1;function o1(){return xr("localStorage")}re.getLocalStorageOrThrow=o1;function a1(){return ir("localStorage")}re.getLocalStorage=a1;var Ts={};Object.defineProperty(Ts,"__esModule",{value:!0});var ju=Ts.getWindowMetadata=void 0;const zu=re;function c1(){let t,e;try{t=zu.getDocumentOrThrow(),e=zu.getLocationOrThrow()}catch{return null}function r(){const f=t.getElementsByTagName("link"),h=[];for(let g=0;g<f.length;g++){const d=f[g],p=d.getAttribute("rel");if(p&&p.toLowerCase().indexOf("icon")>-1){const m=d.getAttribute("href");if(m)if(m.toLowerCase().indexOf("https:")===-1&&m.toLowerCase().indexOf("http:")===-1&&m.indexOf("//")!==0){let C=e.protocol+"//"+e.host;if(m.indexOf("/")===0)C+=m;else{const P=e.pathname.split("/");P.pop();const E=P.join("/");C+=E+"/"+m}h.push(C)}else if(m.indexOf("//")===0){const C=e.protocol+m;h.push(C)}else h.push(m)}}return h}function n(...f){const h=t.getElementsByTagName("meta");for(let g=0;g<h.length;g++){const d=h[g],p=["itemprop","property","name"].map(m=>d.getAttribute(m)).filter(m=>m?f.includes(m):!1);if(p.length&&p){const m=d.getAttribute("content");if(m)return m}}return""}function i(){let f=n("name","og:site_name","og:title","twitter:title");return f||(f=t.title),f}function s(){return n("description","og:description","twitter:description","keywords")}const o=i(),a=s(),c=e.origin,u=r();return{description:a,url:c,icons:u,name:o}}ju=Ts.getWindowMetadata=c1;const ku="2.31.0";let Bs={getDocsUrl:({docsBaseUrl:t,docsPath:e="",docsSlug:r})=>e?`${t??"https://viem.sh"}${e}${r?`#${r}`:""}`:void 0,version:`viem@${ku}`};class Xr extends Error{constructor(e,r={}){const n=r.cause instanceof Xr?r.cause.details:r.cause?.message?r.cause.message:r.details,i=r.cause instanceof Xr&&r.cause.docsPath||r.docsPath,s=Bs.getDocsUrl?.({...r,docsPath:i}),o=[e||"An error occurred.","",...r.metaMessages?[...r.metaMessages,""]:[],...s?[`Docs: ${s}`]:[],...n?[`Details: ${n}`]:[],...Bs.version?[`Version: ${Bs.version}`]:[]].join(`
`);super(o,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=n,this.docsPath=i,this.metaMessages=r.metaMessages,this.name=r.name??this.name,this.shortMessage=e,this.version=ku}walk(e){return Mu(this,e)}}function Mu(t,e){return e?.(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause!==void 0?Mu(t.cause,e):e?null:t}class Hu extends Xr{constructor({size:e,targetSize:r,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (${e}) exceeds padding size (${r}).`,{name:"SizeExceedsPaddingSizeError"})}}function u1(t,{dir:e,size:r=32}={}){return typeof t=="string"?l1(t,{dir:e,size:r}):f1(t,{dir:e,size:r})}function l1(t,{dir:e,size:r=32}={}){if(r===null)return t;const n=t.replace("0x","");if(n.length>r*2)throw new Hu({size:Math.ceil(n.length/2),targetSize:r,type:"hex"});return`0x${n[e==="right"?"padEnd":"padStart"](r*2,"0")}`}function f1(t,{dir:e,size:r=32}={}){if(r===null)return t;if(t.length>r)throw new Hu({size:t.length,targetSize:r,type:"bytes"});const n=new Uint8Array(r);for(let i=0;i<r;i++){const s=e==="right";n[s?i:r-i-1]=t[s?i:t.length-i-1]}return n}class h1 extends Xr{constructor({max:e,min:r,signed:n,size:i,value:s}){super(`Number "${s}" is not in safe ${i?`${i*8}-bit ${n?"signed":"unsigned"} `:""}integer range ${e?`(${r} to ${e})`:`(above ${r})`}`,{name:"IntegerOutOfRangeError"})}}function d1(t,e={}){const{signed:r,size:n}=e,i=BigInt(t);let s;n?r?s=(1n<<BigInt(n)*8n-1n)-1n:s=2n**(BigInt(n)*8n)-1n:typeof t=="number"&&(s=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof s=="bigint"&&r?-s-1n:0;if(s&&i>s||i<o){const c=typeof t=="bigint"?"n":"";throw new h1({max:s?`${s}${c}`:void 0,min:`${o}${c}`,signed:r,size:n,value:`${t}${c}`})}const a=`0x${(r&&i<0?(1n<<BigInt(n*8))+BigInt(i):i).toString(16)}`;return n?u1(a,{size:n}):a}const ei=BigInt(2**32-1),Vu=BigInt(32);function g1(t,e=!1){return e?{h:Number(t&ei),l:Number(t>>Vu&ei)}:{h:Number(t>>Vu&ei)|0,l:Number(t&ei)|0}}function p1(t,e=!1){const r=t.length;let n=new Uint32Array(r),i=new Uint32Array(r);for(let s=0;s<r;s++){const{h:o,l:a}=g1(t[s],e);[n[s],i[s]]=[o,a]}return[n,i]}const y1=(t,e,r)=>t<<r|e>>>32-r,b1=(t,e,r)=>e<<r|t>>>32-r,w1=(t,e,r)=>e<<r-32|t>>>64-r,m1=(t,e,r)=>t<<r-32|e>>>64-r,Ir=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function E1(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Jr(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function sr(t,...e){if(!E1(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function v1(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Jr(t.outputLen),Jr(t.blockLen)}function Sr(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Ku(t,e){sr(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function _1(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Or(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Cs(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function ht(t,e){return t<<32-e|t>>>e}const x1=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function D1(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function I1(t){for(let e=0;e<t.length;e++)t[e]=D1(t[e]);return t}const qu=x1?t=>t:I1;function S1(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function ti(t){return typeof t=="string"&&(t=S1(t)),sr(t),t}function O1(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];sr(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}class Rs{}function Wu(t){const e=n=>t().update(ti(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function A1(t=32){if(Ir&&typeof Ir.getRandomValues=="function")return Ir.getRandomValues(new Uint8Array(t));if(Ir&&typeof Ir.randomBytes=="function")return Uint8Array.from(Ir.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const T1=BigInt(0),Qr=BigInt(1),B1=BigInt(2),C1=BigInt(7),R1=BigInt(256),N1=BigInt(113),Gu=[],Yu=[],Zu=[];for(let t=0,e=Qr,r=1,n=0;t<24;t++){[r,n]=[n,(2*r+3*n)%5],Gu.push(2*(5*n+r)),Yu.push((t+1)*(t+2)/2%64);let i=T1;for(let s=0;s<7;s++)e=(e<<Qr^(e>>C1)*N1)%R1,e&B1&&(i^=Qr<<(Qr<<BigInt(s))-Qr);Zu.push(i)}const Xu=p1(Zu,!0),P1=Xu[0],$1=Xu[1],Ju=(t,e,r)=>r>32?w1(t,e,r):y1(t,e,r),Qu=(t,e,r)=>r>32?m1(t,e,r):b1(t,e,r);function L1(t,e=24){const r=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=r[c],l=r[c+1],f=Ju(u,l,1)^r[a],h=Qu(u,l,1)^r[a+1];for(let g=0;g<50;g+=10)t[o+g]^=f,t[o+g+1]^=h}let i=t[2],s=t[3];for(let o=0;o<24;o++){const a=Yu[o],c=Ju(i,s,a),u=Qu(i,s,a),l=Gu[o];i=t[l],s=t[l+1],t[l]=c,t[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=P1[n],t[1]^=$1[n]}Or(r)}class Ns extends Rs{constructor(e,r,n,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=n,this.enableXOF=i,this.rounds=s,Jr(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=_1(this.state)}clone(){return this._cloneInto()}keccak(){qu(this.state32),L1(this.state32,this.rounds),qu(this.state32),this.posOut=0,this.pos=0}update(e){Sr(this),e=ti(e),sr(e);const{blockLen:r,state:n}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);for(let a=0;a<o;a++)n[this.pos++]^=e[s++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:n,blockLen:i}=this;e[n]^=r,(r&128)!==0&&n===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){Sr(this,!1),sr(e),this.finish();const r=this.state,{blockLen:n}=this;for(let i=0,s=e.length;i<s;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,s-i);e.set(r.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Jr(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Ku(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Or(this.state)}_cloneInto(e){const{blockLen:r,suffix:n,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new Ns(r,n,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=n,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}}const U1=(t,e,r)=>Wu(()=>new Ns(e,t,r)),F1=U1(1,136,256/8);class j1 extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const n=this.keys().next().value;n&&this.delete(n)}return this}}function z1(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,u=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+u,a,n)}function k1(t,e,r){return t&e^~t&r}function M1(t,e,r){return t&e^t&r^e&r}class H1 extends Rs{constructor(e,r,n,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.buffer=new Uint8Array(e),this.view=Cs(this.buffer)}update(e){Sr(this),e=ti(e),sr(e);const{view:r,buffer:n,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Cs(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Sr(this),Ku(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,Or(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(n,0),o=0);for(let f=o;f<i;f++)r[f]=0;z1(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=Cs(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<u;f++)a.setUint32(4*f,l[f],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}}const Nt=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),V1=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Pt=new Uint32Array(64);class K1 extends H1{constructor(e=32){super(64,e,8,!1),this.A=Nt[0]|0,this.B=Nt[1]|0,this.C=Nt[2]|0,this.D=Nt[3]|0,this.E=Nt[4]|0,this.F=Nt[5]|0,this.G=Nt[6]|0,this.H=Nt[7]|0}get(){const{A:e,B:r,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,r,n,i,s,o,a,c]}set(e,r,n,i,s,o,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let f=0;f<16;f++,r+=4)Pt[f]=e.getUint32(r,!1);for(let f=16;f<64;f++){const h=Pt[f-15],g=Pt[f-2],d=ht(h,7)^ht(h,18)^h>>>3,p=ht(g,17)^ht(g,19)^g>>>10;Pt[f]=p+Pt[f-7]+d+Pt[f-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:u,H:l}=this;for(let f=0;f<64;f++){const h=ht(a,6)^ht(a,11)^ht(a,25),g=l+h+k1(a,c,u)+V1[f]+Pt[f]|0,p=(ht(n,2)^ht(n,13)^ht(n,22))+M1(n,i,s)|0;l=u,u=c,c=a,a=o+g|0,o=s,s=i,i=n,n=g+p|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,i,s,o,a,c,u,l)}roundClean(){Or(Pt)}destroy(){this.set(0,0,0,0,0,0,0,0),Or(this.buffer)}}const q1=Wu(()=>new K1),W1="0.1.1";function G1(){return W1}class De extends Error{constructor(e,r={}){const n=(()=>{if(r.cause instanceof De){if(r.cause.details)return r.cause.details;if(r.cause.shortMessage)return r.cause.shortMessage}return r.cause&&"details"in r.cause&&typeof r.cause.details=="string"?r.cause.details:r.cause?.message?r.cause.message:r.details})(),i=r.cause instanceof De&&r.cause.docsPath||r.docsPath,o=`https://oxlib.sh${i??""}`,a=[e||"An error occurred.",...r.metaMessages?["",...r.metaMessages]:[],...n||i?["",n?`Details: ${n}`:void 0,i?`See: ${o}`:void 0]:[]].filter(c=>typeof c=="string").join(`
`);super(a,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${G1()}`}),this.cause=r.cause,this.details=n,this.docs=o,this.docsPath=i,this.shortMessage=e}walk(e){return el(this,e)}}function el(t,e){return e?.(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause?el(t.cause,e):e?null:t}function Y1(t,e){if(nl(t)>e)throw new nm({givenSize:nl(t),maxSize:e})}const Et={zero:48,nine:57,A:65,F:70,a:97,f:102};function tl(t){if(t>=Et.zero&&t<=Et.nine)return t-Et.zero;if(t>=Et.A&&t<=Et.F)return t-(Et.A-10);if(t>=Et.a&&t<=Et.f)return t-(Et.a-10)}function Z1(t,e={}){const{dir:r,size:n=32}=e;if(n===0)return t;if(t.length>n)throw new im({size:t.length,targetSize:n,type:"Bytes"});const i=new Uint8Array(n);for(let s=0;s<n;s++){const o=r==="right";i[o?s:n-s-1]=t[o?s:t.length-s-1]}return i}function Ps(t,e){if(Ls(t)>e)throw new fm({givenSize:Ls(t),maxSize:e})}function rl(t,e={}){const{dir:r,size:n=32}=e;if(n===0)return t;const i=t.replace("0x","");if(i.length>n*2)throw new hm({size:Math.ceil(i.length/2),targetSize:n,type:"Hex"});return`0x${i[r==="right"?"padEnd":"padStart"](n*2,"0")}`}const X1=new TextEncoder;function J1(t){return t instanceof Uint8Array?t:typeof t=="string"?em(t):Q1(t)}function Q1(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function em(t,e={}){const{size:r}=e;let n=t;r&&(Ps(t,r),n=$s(t,r));let i=n.slice(2);i.length%2&&(i=`0${i}`);const s=i.length/2,o=new Uint8Array(s);for(let a=0,c=0;a<s;a++){const u=tl(i.charCodeAt(c++)),l=tl(i.charCodeAt(c++));if(u===void 0||l===void 0)throw new De(`Invalid byte sequence ("${i[c-2]}${i[c-1]}" in "${i}").`);o[a]=u*16+l}return o}function tm(t,e={}){const{size:r}=e,n=X1.encode(t);return typeof r=="number"?(Y1(n,r),rm(n,r)):n}function rm(t,e){return Z1(t,{dir:"right",size:e})}function nl(t){return t.length}class nm extends De{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class im extends De{constructor({size:e,targetSize:r,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}const sm=new TextEncoder,om=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function il(...t){return`0x${t.reduce((e,r)=>e+r.replace("0x",""),"")}`}function am(t,e={}){const r=`0x${Number(t)}`;return typeof e.size=="number"?(Ps(r,e.size),ri(r,e.size)):r}function sl(t,e={}){let r="";for(let i=0;i<t.length;i++)r+=om[t[i]];const n=`0x${r}`;return typeof e.size=="number"?(Ps(n,e.size),$s(n,e.size)):n}function cm(t,e={}){const{signed:r,size:n}=e,i=BigInt(t);let s;n?r?s=(1n<<BigInt(n)*8n-1n)-1n:s=2n**(BigInt(n)*8n)-1n:typeof t=="number"&&(s=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof s=="bigint"&&r?-s-1n:0;if(s&&i>s||i<o){const u=typeof t=="bigint"?"n":"";throw new lm({max:s?`${s}${u}`:void 0,min:`${o}${u}`,signed:r,size:n,value:`${t}${u}`})}const c=`0x${(r&&i<0?(1n<<BigInt(n*8))+BigInt(i):i).toString(16)}`;return n?ri(c,n):c}function um(t,e={}){return sl(sm.encode(t),e)}function ri(t,e){return rl(t,{dir:"left",size:e})}function $s(t,e){return rl(t,{dir:"right",size:e})}function Ls(t){return Math.ceil((t.length-2)/2)}class lm extends De{constructor({max:e,min:r,signed:n,size:i,value:s}){super(`Number \`${s}\` is not in safe${i?` ${i*8}-bit`:""}${n?" signed":" unsigned"} integer range ${e?`(\`${r}\` to \`${e}\`)`:`(above \`${r}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class fm extends De{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}}class hm extends De{constructor({size:e,targetSize:r,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}}new j1(128),d1(0,{size:32});function dm(t,e={}){const{as:r=typeof t=="string"?"Hex":"Bytes"}=e,n=F1(J1(t));return r==="Bytes"?n:sl(n)}class gm extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const n=this.keys().next().value;n&&this.delete(n)}return this}}const Us={checksum:new gm(8192)}.checksum,pm=/^0x[a-fA-F0-9]{40}$/;function ol(t,e={}){const{strict:r=!0}=e;if(!pm.test(t))throw new al({address:t,cause:new bm});if(r){if(t.toLowerCase()===t)return;if(ym(t)!==t)throw new al({address:t,cause:new wm})}}function ym(t){if(Us.has(t))return Us.get(t);ol(t,{strict:!1});const e=t.substring(2).toLowerCase(),r=dm(tm(e),{as:"Bytes"}),n=e.split("");for(let s=0;s<40;s+=2)r[s>>1]>>4>=8&&n[s]&&(n[s]=n[s].toUpperCase()),(r[s>>1]&15)>=8&&n[s+1]&&(n[s+1]=n[s+1].toUpperCase());const i=`0x${n.join("")}`;return Us.set(t,i),i}class al extends De{constructor({address:e,cause:r}){super(`Address "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class bm extends De{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class wm extends De{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}const mm=/^(.*)\[([0-9]*)\]$/,Em=/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/,vm=/^(u?int)(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/;function Fs(t,e){if(t.length!==e.length)throw new xm({expectedLength:t.length,givenLength:e.length});const r=[];for(let n=0;n<t.length;n++){const i=t[n],s=e[n];r.push(Fs.encode(i,s))}return il(...r)}(function(t){function e(r,n,i=!1){if(r==="address"){const c=n;return ol(c),ri(c.toLowerCase(),i?32:0)}if(r==="string")return um(n);if(r==="bytes")return n;if(r==="bool")return ri(am(n),i?32:1);const s=r.match(vm);if(s){const[c,u,l="256"]=s,f=Number.parseInt(l)/8;return cm(n,{size:i?32:f,signed:u==="int"})}const o=r.match(Em);if(o){const[c,u]=o;if(Number.parseInt(u)!==(n.length-2)/2)throw new _m({expectedSize:Number.parseInt(u),value:n});return $s(n,i?32:0)}const a=r.match(mm);if(a&&Array.isArray(n)){const[c,u]=a,l=[];for(let f=0;f<n.length;f++)l.push(e(u,n[f],!0));return l.length===0?"0x":il(...l)}throw new Dm(r)}t.encode=e})(Fs||(Fs={}));class _m extends De{constructor({expectedSize:e,value:r}){super(`Size of bytes "${r}" (bytes${Ls(r)}) does not match expected size (bytes${e}).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.BytesSizeMismatchError"})}}class xm extends De{constructor({expectedLength:e,givenLength:r}){super(["ABI encoding parameters/values length mismatch.",`Expected length (parameters): ${e}`,`Given length (values): ${r}`].join(`
`)),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.LengthMismatchError"})}}class Dm extends De{constructor(e){super(`Type \`${e}\` is not a valid ABI Type.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.InvalidTypeError"})}}class cl extends Rs{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,v1(e);const n=ti(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),Or(s)}update(e){return Sr(this),this.iHash.update(e),this}digestInto(e){Sr(this),sr(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const ul=(t,e,r)=>new cl(t,e).update(r).digest();ul.create=(t,e)=>new cl(t,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const js=BigInt(0),zs=BigInt(1);function en(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ks(t){if(!en(t))throw new Error("Uint8Array expected")}function tn(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function ni(t){const e=t.toString(16);return e.length&1?"0"+e:e}function ll(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?js:BigInt("0x"+t)}const fl=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Im=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function rn(t){if(ks(t),fl)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=Im[t[r]];return e}const vt={_0:48,_9:57,A:65,F:70,a:97,f:102};function hl(t){if(t>=vt._0&&t<=vt._9)return t-vt._0;if(t>=vt.A&&t<=vt.F)return t-(vt.A-10);if(t>=vt.a&&t<=vt.f)return t-(vt.a-10)}function ii(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(fl)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=hl(t.charCodeAt(s)),a=hl(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function or(t){return ll(rn(t))}function dl(t){return ks(t),ll(rn(Uint8Array.from(t).reverse()))}function nn(t,e){return ii(t.toString(16).padStart(e*2,"0"))}function gl(t,e){return nn(t,e).reverse()}function Ye(t,e,r){let n;if(typeof e=="string")try{n=ii(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(en(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}function si(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];ks(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}const Ms=t=>typeof t=="bigint"&&js<=t;function Hs(t,e,r){return Ms(t)&&Ms(e)&&Ms(r)&&e<=t&&t<r}function Ar(t,e,r,n){if(!Hs(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function Sm(t){let e;for(e=0;t>js;t>>=zs,e+=1);return e}const oi=t=>(zs<<BigInt(t))-zs,Vs=t=>new Uint8Array(t),pl=t=>Uint8Array.from(t);function Om(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let n=Vs(t),i=Vs(t),s=0;const o=()=>{n.fill(1),i.fill(0),s=0},a=(...f)=>r(i,n,...f),c=(f=Vs(0))=>{i=a(pl([0]),f),n=a(),f.length!==0&&(i=a(pl([1]),f),n=a())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const h=[];for(;f<e;){n=a();const g=n.slice();h.push(g),f+=n.length}return si(...h)};return(f,h)=>{o(),c(f);let g;for(;!(g=h(u()));)c();return o(),g}}const Am={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||en(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function ai(t,e,r={}){const n=(i,s,o)=>{const a=Am[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))n(i,s,!1);for(const[i,s]of Object.entries(r))n(i,s,!0);return t}function yl(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}const Re=BigInt(0),Ie=BigInt(1),ar=BigInt(2),Tm=BigInt(3),bl=BigInt(4),wl=BigInt(5),ml=BigInt(8);function Ne(t,e){const r=t%e;return r>=Re?r:e+r}function Ze(t,e,r){let n=t;for(;e-- >Re;)n*=n,n%=r;return n}function Ks(t,e){if(t===Re)throw new Error("invert: expected non-zero number");if(e<=Re)throw new Error("invert: expected positive modulus, got "+e);let r=Ne(t,e),n=e,i=Re,s=Ie;for(;r!==Re;){const a=n/r,c=n%r,u=i-s*a;n=r,r=c,i=s,s=u}if(n!==Ie)throw new Error("invert: does not exist");return Ne(i,e)}function El(t,e){const r=(t.ORDER+Ie)/bl,n=t.pow(e,r);if(!t.eql(t.sqr(n),e))throw new Error("Cannot find square root");return n}function Bm(t,e){const r=(t.ORDER-wl)/ml,n=t.mul(e,ar),i=t.pow(n,r),s=t.mul(e,i),o=t.mul(t.mul(s,ar),i),a=t.mul(s,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function Cm(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-Ie,r=0;for(;e%ar===Re;)e/=ar,r++;let n=ar;const i=qs(t);for(;_l(i,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return El;let s=i.pow(n,e);const o=(e+Ie)/ar;return function(c,u){if(c.is0(u))return u;if(_l(c,u)!==1)throw new Error("Cannot find square root");let l=r,f=c.mul(c.ONE,s),h=c.pow(u,e),g=c.pow(u,o);for(;!c.eql(h,c.ONE);){if(c.is0(h))return c.ZERO;let d=1,p=c.sqr(h);for(;!c.eql(p,c.ONE);)if(d++,p=c.sqr(p),d===l)throw new Error("Cannot find square root");const m=Ie<<BigInt(l-d-1),C=c.pow(f,m);l=d,f=c.sqr(C),h=c.mul(h,f),g=c.mul(g,C)}return g}}function Rm(t){return t%bl===Tm?El:t%ml===wl?Bm:Cm(t)}const Nm=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Pm(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=Nm.reduce((n,i)=>(n[i]="function",n),e);return ai(t,r)}function $m(t,e,r){if(r<Re)throw new Error("invalid exponent, negatives unsupported");if(r===Re)return t.ONE;if(r===Ie)return e;let n=t.ONE,i=e;for(;r>Re;)r&Ie&&(n=t.mul(n,i)),i=t.sqr(i),r>>=Ie;return n}function vl(t,e,r=!1){const n=new Array(e.length).fill(r?t.ZERO:void 0),i=e.reduce((o,a,c)=>t.is0(a)?o:(n[c]=o,t.mul(o,a)),t.ONE),s=t.inv(i);return e.reduceRight((o,a,c)=>t.is0(a)?o:(n[c]=t.mul(o,n[c]),t.mul(o,a)),s),n}function _l(t,e){const r=(t.ORDER-Ie)/ar,n=t.pow(e,r),i=t.eql(n,t.ONE),s=t.eql(n,t.ZERO),o=t.eql(n,t.neg(t.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function xl(t,e){e!==void 0&&Jr(e);const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function qs(t,e,r=!1,n={}){if(t<=Re)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=xl(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:i,BYTES:s,MASK:oi(i),ZERO:Re,ONE:Ie,create:c=>Ne(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Re<=c&&c<t},is0:c=>c===Re,isOdd:c=>(c&Ie)===Ie,neg:c=>Ne(-c,t),eql:(c,u)=>c===u,sqr:c=>Ne(c*c,t),add:(c,u)=>Ne(c+u,t),sub:(c,u)=>Ne(c-u,t),mul:(c,u)=>Ne(c*u,t),pow:(c,u)=>$m(a,c,u),div:(c,u)=>Ne(c*Ks(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Ks(c,t),sqrt:n.sqrt||(c=>(o||(o=Rm(t)),o(a,c))),toBytes:c=>r?gl(c,s):nn(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?dl(c):or(c)},invertBatch:c=>vl(a,c),cmov:(c,u,l)=>l?u:c});return Object.freeze(a)}function Dl(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Il(t){const e=Dl(t);return e+Math.ceil(e/2)}function Lm(t,e,r=!1){const n=t.length,i=Dl(e),s=Il(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const o=r?dl(t):or(t),a=Ne(o,e-Ie)+Ie;return r?gl(a,i):nn(a,i)}const Sl=BigInt(0),Ws=BigInt(1);function Gs(t,e){const r=e.negate();return t?r:e}function Ol(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Ys(t,e){Ol(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1),i=2**t,s=oi(t),o=BigInt(t);return{windows:r,windowSize:n,mask:s,maxNumber:i,shiftBy:o}}function Al(t,e,r){const{windowSize:n,mask:i,maxNumber:s,shiftBy:o}=r;let a=Number(t&i),c=t>>o;a>n&&(a-=s,c+=Ws);const u=e*n,l=u+Math.abs(a)-1,f=a===0,h=a<0,g=e%2!==0;return{nextN:c,offset:l,isZero:f,isNeg:h,isNegF:g,offsetF:u}}function Um(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function Fm(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const Zs=new WeakMap,Tl=new WeakMap;function Xs(t){return Tl.get(t)||1}function jm(t,e){return{constTimeNegate:Gs,hasPrecomputes(r){return Xs(r)!==1},unsafeLadder(r,n,i=t.ZERO){let s=r;for(;n>Sl;)n&Ws&&(i=i.add(s)),s=s.double(),n>>=Ws;return i},precomputeWindow(r,n){const{windows:i,windowSize:s}=Ys(n,e),o=[];let a=r,c=a;for(let u=0;u<i;u++){c=a,o.push(c);for(let l=1;l<s;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,i){let s=t.ZERO,o=t.BASE;const a=Ys(r,e);for(let c=0;c<a.windows;c++){const{nextN:u,offset:l,isZero:f,isNeg:h,isNegF:g,offsetF:d}=Al(i,c,a);i=u,f?o=o.add(Gs(g,n[d])):s=s.add(Gs(h,n[l]))}return{p:s,f:o}},wNAFUnsafe(r,n,i,s=t.ZERO){const o=Ys(r,e);for(let a=0;a<o.windows&&i!==Sl;a++){const{nextN:c,offset:u,isZero:l,isNeg:f}=Al(i,a,o);if(i=c,!l){const h=n[u];s=s.add(f?h.negate():h)}}return s},getPrecomputes(r,n,i){let s=Zs.get(n);return s||(s=this.precomputeWindow(n,r),r!==1&&Zs.set(n,i(s))),s},wNAFCached(r,n,i){const s=Xs(r);return this.wNAF(s,this.getPrecomputes(s,r,i),n)},wNAFCachedUnsafe(r,n,i,s){const o=Xs(r);return o===1?this.unsafeLadder(r,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,i),n,s)},setWindowSize(r,n){Ol(n,e),Tl.set(r,n),Zs.delete(r)}}}function zm(t,e,r,n){Um(r,t),Fm(n,e);const i=r.length,s=n.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=Sm(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const u=oi(c),l=new Array(Number(u)+1).fill(o),f=Math.floor((e.BITS-1)/c)*c;let h=o;for(let g=f;g>=0;g-=c){l.fill(o);for(let p=0;p<s;p++){const m=n[p],C=Number(m>>BigInt(g)&u);l[C]=l[C].add(r[p])}let d=o;for(let p=l.length-1,m=o;p>0;p--)m=m.add(l[p]),d=d.add(m);if(h=h.add(d),g!==0)for(let p=0;p<c;p++)h=h.double()}return h}function Bl(t){return Pm(t.Fp),ai(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...xl(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}function Cl(t){t.lowS!==void 0&&tn("lowS",t.lowS),t.prehash!==void 0&&tn("prehash",t.prehash)}function km(t){const e=Bl(t);ai(e,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:r,Fp:n,a:i}=e;if(r){if(!n.eql(i,n.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...e})}class Mm extends Error{constructor(e=""){super(e)}}const _t={Err:Mm,_tlv:{encode:(t,e)=>{const{Err:r}=_t;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,i=ni(n);if(i.length/2&128)throw new r("tlv.encode: long form length too big");const s=n>127?ni(i.length/2|128):"";return ni(t)+s+i+e},decode(t,e){const{Err:r}=_t;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const i=e[n++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const u=e.subarray(n,n+c);if(u.length!==c)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const l of u)o=o<<8|l;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=_t;if(t<xt)throw new e("integer: negative integers are not allowed");let r=ni(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=_t;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return or(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=_t,i=Ye("signature",t),{v:s,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,s),{v:u,l}=n.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(t){const{_tlv:e,_int:r}=_t,n=e.encode(2,r.encode(t.r)),i=e.encode(2,r.encode(t.s)),s=n+i;return e.encode(48,s)}};function Js(t,e){return rn(nn(t,e))}const xt=BigInt(0),fe=BigInt(1);BigInt(2);const Qs=BigInt(3),Hm=BigInt(4);function Vm(t){const e=km(t),{Fp:r}=e,n=qs(e.n,e.nBitLength),i=e.toBytes||((E,_,S)=>{const U=_.toAffine();return si(Uint8Array.from([4]),r.toBytes(U.x),r.toBytes(U.y))}),s=e.fromBytes||(E=>{const _=E.subarray(1),S=r.fromBytes(_.subarray(0,r.BYTES)),U=r.fromBytes(_.subarray(r.BYTES,2*r.BYTES));return{x:S,y:U}});function o(E){const{a:_,b:S}=e,U=r.sqr(E),$=r.mul(U,E);return r.add(r.add($,r.mul(E,_)),S)}function a(E,_){const S=r.sqr(_),U=o(E);return r.eql(S,U)}if(!a(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const c=r.mul(r.pow(e.a,Qs),Hm),u=r.mul(r.sqr(e.b),BigInt(27));if(r.is0(r.add(c,u)))throw new Error("bad curve params: a or b");function l(E){return Hs(E,fe,e.n)}function f(E){const{allowedPrivateKeyLengths:_,nByteLength:S,wrapPrivateKey:U,n:$}=e;if(_&&typeof E!="bigint"){if(en(E)&&(E=rn(E)),typeof E!="string"||!_.includes(E.length))throw new Error("invalid private key");E=E.padStart(S*2,"0")}let R;try{R=typeof E=="bigint"?E:or(Ye("private key",E,S))}catch{throw new Error("invalid private key, expected hex or "+S+" bytes, got "+typeof E)}return U&&(R=Ne(R,$)),Ar("private key",R,fe,$),R}function h(E){if(!(E instanceof p))throw new Error("ProjectivePoint expected")}const g=yl((E,_)=>{const{px:S,py:U,pz:$}=E;if(r.eql($,r.ONE))return{x:S,y:U};const R=E.is0();_==null&&(_=R?r.ONE:r.inv($));const w=r.mul(S,_),T=r.mul(U,_),x=r.mul($,_);if(R)return{x:r.ZERO,y:r.ZERO};if(!r.eql(x,r.ONE))throw new Error("invZ was invalid");return{x:w,y:T}}),d=yl(E=>{if(E.is0()){if(e.allowInfinityPoint&&!r.is0(E.py))return;throw new Error("bad point: ZERO")}const{x:_,y:S}=E.toAffine();if(!r.isValid(_)||!r.isValid(S))throw new Error("bad point: x or y not FE");if(!a(_,S))throw new Error("bad point: equation left != right");if(!E.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class p{constructor(_,S,U){if(_==null||!r.isValid(_))throw new Error("x required");if(S==null||!r.isValid(S)||r.is0(S))throw new Error("y required");if(U==null||!r.isValid(U))throw new Error("z required");this.px=_,this.py=S,this.pz=U,Object.freeze(this)}static fromAffine(_){const{x:S,y:U}=_||{};if(!_||!r.isValid(S)||!r.isValid(U))throw new Error("invalid affine point");if(_ instanceof p)throw new Error("projective point not allowed");const $=R=>r.eql(R,r.ZERO);return $(S)&&$(U)?p.ZERO:new p(S,U,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(_){const S=vl(r,_.map(U=>U.pz));return _.map((U,$)=>U.toAffine(S[$])).map(p.fromAffine)}static fromHex(_){const S=p.fromAffine(s(Ye("pointHex",_)));return S.assertValidity(),S}static fromPrivateKey(_){return p.BASE.multiply(f(_))}static msm(_,S){return zm(p,n,_,S)}_setWindowSize(_){P.setWindowSize(this,_)}assertValidity(){d(this)}hasEvenY(){const{y:_}=this.toAffine();if(r.isOdd)return!r.isOdd(_);throw new Error("Field doesn't support isOdd")}equals(_){h(_);const{px:S,py:U,pz:$}=this,{px:R,py:w,pz:T}=_,x=r.eql(r.mul(S,T),r.mul(R,$)),D=r.eql(r.mul(U,T),r.mul(w,$));return x&&D}negate(){return new p(this.px,r.neg(this.py),this.pz)}double(){const{a:_,b:S}=e,U=r.mul(S,Qs),{px:$,py:R,pz:w}=this;let T=r.ZERO,x=r.ZERO,D=r.ZERO,A=r.mul($,$),L=r.mul(R,R),b=r.mul(w,w),y=r.mul($,R);return y=r.add(y,y),D=r.mul($,w),D=r.add(D,D),T=r.mul(_,D),x=r.mul(U,b),x=r.add(T,x),T=r.sub(L,x),x=r.add(L,x),x=r.mul(T,x),T=r.mul(y,T),D=r.mul(U,D),b=r.mul(_,b),y=r.sub(A,b),y=r.mul(_,y),y=r.add(y,D),D=r.add(A,A),A=r.add(D,A),A=r.add(A,b),A=r.mul(A,y),x=r.add(x,A),b=r.mul(R,w),b=r.add(b,b),A=r.mul(b,y),T=r.sub(T,A),D=r.mul(b,L),D=r.add(D,D),D=r.add(D,D),new p(T,x,D)}add(_){h(_);const{px:S,py:U,pz:$}=this,{px:R,py:w,pz:T}=_;let x=r.ZERO,D=r.ZERO,A=r.ZERO;const L=e.a,b=r.mul(e.b,Qs);let y=r.mul(S,R),v=r.mul(U,w),O=r.mul($,T),I=r.add(S,U),B=r.add(R,w);I=r.mul(I,B),B=r.add(y,v),I=r.sub(I,B),B=r.add(S,$);let N=r.add(R,T);return B=r.mul(B,N),N=r.add(y,O),B=r.sub(B,N),N=r.add(U,$),x=r.add(w,T),N=r.mul(N,x),x=r.add(v,O),N=r.sub(N,x),A=r.mul(L,B),x=r.mul(b,O),A=r.add(x,A),x=r.sub(v,A),A=r.add(v,A),D=r.mul(x,A),v=r.add(y,y),v=r.add(v,y),O=r.mul(L,O),B=r.mul(b,B),v=r.add(v,O),O=r.sub(y,O),O=r.mul(L,O),B=r.add(B,O),y=r.mul(v,B),D=r.add(D,y),y=r.mul(N,B),x=r.mul(I,x),x=r.sub(x,y),y=r.mul(I,v),A=r.mul(N,A),A=r.add(A,y),new p(x,D,A)}subtract(_){return this.add(_.negate())}is0(){return this.equals(p.ZERO)}wNAF(_){return P.wNAFCached(this,_,p.normalizeZ)}multiplyUnsafe(_){const{endo:S,n:U}=e;Ar("scalar",_,xt,U);const $=p.ZERO;if(_===xt)return $;if(this.is0()||_===fe)return this;if(!S||P.hasPrecomputes(this))return P.wNAFCachedUnsafe(this,_,p.normalizeZ);let{k1neg:R,k1:w,k2neg:T,k2:x}=S.splitScalar(_),D=$,A=$,L=this;for(;w>xt||x>xt;)w&fe&&(D=D.add(L)),x&fe&&(A=A.add(L)),L=L.double(),w>>=fe,x>>=fe;return R&&(D=D.negate()),T&&(A=A.negate()),A=new p(r.mul(A.px,S.beta),A.py,A.pz),D.add(A)}multiply(_){const{endo:S,n:U}=e;Ar("scalar",_,fe,U);let $,R;if(S){const{k1neg:w,k1:T,k2neg:x,k2:D}=S.splitScalar(_);let{p:A,f:L}=this.wNAF(T),{p:b,f:y}=this.wNAF(D);A=P.constTimeNegate(w,A),b=P.constTimeNegate(x,b),b=new p(r.mul(b.px,S.beta),b.py,b.pz),$=A.add(b),R=L.add(y)}else{const{p:w,f:T}=this.wNAF(_);$=w,R=T}return p.normalizeZ([$,R])[0]}multiplyAndAddUnsafe(_,S,U){const $=p.BASE,R=(T,x)=>x===xt||x===fe||!T.equals($)?T.multiplyUnsafe(x):T.multiply(x),w=R(this,S).add(R(_,U));return w.is0()?void 0:w}toAffine(_){return g(this,_)}isTorsionFree(){const{h:_,isTorsionFree:S}=e;if(_===fe)return!0;if(S)return S(p,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:_,clearCofactor:S}=e;return _===fe?this:S?S(p,this):this.multiplyUnsafe(e.h)}toRawBytes(_=!0){return tn("isCompressed",_),this.assertValidity(),i(p,this,_)}toHex(_=!0){return tn("isCompressed",_),rn(this.toRawBytes(_))}}p.BASE=new p(e.Gx,e.Gy,r.ONE),p.ZERO=new p(r.ZERO,r.ONE,r.ZERO);const{endo:m,nBitLength:C}=e,P=jm(p,m?Math.ceil(C/2):C);return{CURVE:e,ProjectivePoint:p,normPrivateKeyToScalar:f,weierstrassEquation:o,isWithinCurveOrder:l}}function Km(t){const e=Bl(t);return ai(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function qm(t){const e=Km(t),{Fp:r,n,nByteLength:i,nBitLength:s}=e,o=r.BYTES+1,a=2*r.BYTES+1;function c(b){return Ne(b,n)}function u(b){return Ks(b,n)}const{ProjectivePoint:l,normPrivateKeyToScalar:f,weierstrassEquation:h,isWithinCurveOrder:g}=Vm({...e,toBytes(b,y,v){const O=y.toAffine(),I=r.toBytes(O.x),B=si;return tn("isCompressed",v),v?B(Uint8Array.from([y.hasEvenY()?2:3]),I):B(Uint8Array.from([4]),I,r.toBytes(O.y))},fromBytes(b){const y=b.length,v=b[0],O=b.subarray(1);if(y===o&&(v===2||v===3)){const I=or(O);if(!Hs(I,fe,r.ORDER))throw new Error("Point is not on curve");const B=h(I);let N;try{N=r.sqrt(B)}catch(H){const M=H instanceof Error?": "+H.message:"";throw new Error("Point is not on curve"+M)}const F=(N&fe)===fe;return(v&1)===1!==F&&(N=r.neg(N)),{x:I,y:N}}else if(y===a&&v===4){const I=r.fromBytes(O.subarray(0,r.BYTES)),B=r.fromBytes(O.subarray(r.BYTES,2*r.BYTES));return{x:I,y:B}}else{const I=o,B=a;throw new Error("invalid Point, expected length of "+I+", or uncompressed "+B+", got "+y)}}});function d(b){const y=n>>fe;return b>y}function p(b){return d(b)?c(-b):b}const m=(b,y,v)=>or(b.slice(y,v));class C{constructor(y,v,O){Ar("r",y,fe,n),Ar("s",v,fe,n),this.r=y,this.s=v,O!=null&&(this.recovery=O),Object.freeze(this)}static fromCompact(y){const v=i;return y=Ye("compactSignature",y,v*2),new C(m(y,0,v),m(y,v,2*v))}static fromDER(y){const{r:v,s:O}=_t.toSig(Ye("DER",y));return new C(v,O)}assertValidity(){}addRecoveryBit(y){return new C(this.r,this.s,y)}recoverPublicKey(y){const{r:v,s:O,recovery:I}=this,B=$(Ye("msgHash",y));if(I==null||![0,1,2,3].includes(I))throw new Error("recovery id invalid");const N=I===2||I===3?v+e.n:v;if(N>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const F=(I&1)===0?"02":"03",k=l.fromHex(F+Js(N,r.BYTES)),H=u(N),M=c(-B*H),K=c(O*H),Y=l.BASE.multiplyAndAddUnsafe(k,M,K);if(!Y)throw new Error("point at infinify");return Y.assertValidity(),Y}hasHighS(){return d(this.s)}normalizeS(){return this.hasHighS()?new C(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return ii(this.toDERHex())}toDERHex(){return _t.hexFromSig(this)}toCompactRawBytes(){return ii(this.toCompactHex())}toCompactHex(){const y=i;return Js(this.r,y)+Js(this.s,y)}}const P={isValidPrivateKey(b){try{return f(b),!0}catch{return!1}},normPrivateKeyToScalar:f,randomPrivateKey:()=>{const b=Il(e.n);return Lm(e.randomBytes(b),e.n)},precompute(b=8,y=l.BASE){return y._setWindowSize(b),y.multiply(BigInt(3)),y}};function E(b,y=!0){return l.fromPrivateKey(b).toRawBytes(y)}function _(b){if(typeof b=="bigint")return!1;if(b instanceof l)return!0;const v=Ye("key",b).length,O=r.BYTES,I=O+1,B=2*O+1;if(!(e.allowedPrivateKeyLengths||i===I))return v===I||v===B}function S(b,y,v=!0){if(_(b)===!0)throw new Error("first arg must be private key");if(_(y)===!1)throw new Error("second arg must be public key");return l.fromHex(y).multiply(f(b)).toRawBytes(v)}const U=e.bits2int||function(b){if(b.length>8192)throw new Error("input is too large");const y=or(b),v=b.length*8-s;return v>0?y>>BigInt(v):y},$=e.bits2int_modN||function(b){return c(U(b))},R=oi(s);function w(b){return Ar("num < 2^"+s,b,xt,R),nn(b,i)}function T(b,y,v=x){if(["recovered","canonical"].some(W=>W in v))throw new Error("sign() legacy options not supported");const{hash:O,randomBytes:I}=e;let{lowS:B,prehash:N,extraEntropy:F}=v;B==null&&(B=!0),b=Ye("msgHash",b),Cl(v),N&&(b=Ye("prehashed msgHash",O(b)));const k=$(b),H=f(y),M=[w(H),w(k)];if(F!=null&&F!==!1){const W=F===!0?I(r.BYTES):F;M.push(Ye("extraEntropy",W))}const K=si(...M),Y=k;function Q(W){const ie=U(W);if(!g(ie))return;const me=u(ie),pt=l.BASE.multiply(ie).toAffine(),yt=c(pt.x);if(yt===xt)return;const Gt=c(me*c(Y+yt*H));if(Gt===xt)return;let Yt=(pt.x===yt?0:2)|Number(pt.y&fe),Li=Gt;return B&&d(Gt)&&(Li=p(Gt),Yt^=1),new C(yt,Li,Yt)}return{seed:K,k2sig:Q}}const x={lowS:e.lowS,prehash:!1},D={lowS:e.lowS,prehash:!1};function A(b,y,v=x){const{seed:O,k2sig:I}=T(b,y,v),B=e;return Om(B.hash.outputLen,B.nByteLength,B.hmac)(O,I)}l.BASE._setWindowSize(8);function L(b,y,v,O=D){const I=b;y=Ye("msgHash",y),v=Ye("publicKey",v);const{lowS:B,prehash:N,format:F}=O;if(Cl(O),"strict"in O)throw new Error("options.strict was renamed to lowS");if(F!==void 0&&F!=="compact"&&F!=="der")throw new Error("format must be compact or der");const k=typeof I=="string"||en(I),H=!k&&!F&&typeof I=="object"&&I!==null&&typeof I.r=="bigint"&&typeof I.s=="bigint";if(!k&&!H)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let M,K;try{if(H&&(M=new C(I.r,I.s)),k){try{F!=="compact"&&(M=C.fromDER(I))}catch(Yt){if(!(Yt instanceof _t.Err))throw Yt}!M&&F!=="der"&&(M=C.fromCompact(I))}K=l.fromHex(v)}catch{return!1}if(!M||B&&M.hasHighS())return!1;N&&(y=e.hash(y));const{r:Y,s:Q}=M,W=$(y),ie=u(Q),me=c(W*ie),pt=c(Y*ie),yt=l.BASE.multiplyAndAddUnsafe(K,me,pt)?.toAffine();return yt?c(yt.x)===Y:!1}return{CURVE:e,getPublicKey:E,getSharedSecret:S,sign:A,verify:L,ProjectivePoint:l,Signature:C,utils:P}}function Wm(t){return{hash:t,hmac:(e,...r)=>ul(t,e,O1(...r)),randomBytes:A1}}function Gm(t,e){const r=n=>qm({...t,...Wm(n)});return{...r(e),create:r}}const Rl=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Nl=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Ym=BigInt(0),Zm=BigInt(1),eo=BigInt(2),Pl=(t,e)=>(t+e/eo)/e;function Xm(t){const e=Rl,r=BigInt(3),n=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),u=t*t*t%e,l=u*u*t%e,f=Ze(l,r,e)*l%e,h=Ze(f,r,e)*l%e,g=Ze(h,eo,e)*u%e,d=Ze(g,i,e)*g%e,p=Ze(d,s,e)*d%e,m=Ze(p,a,e)*p%e,C=Ze(m,c,e)*m%e,P=Ze(C,a,e)*p%e,E=Ze(P,r,e)*l%e,_=Ze(E,o,e)*d%e,S=Ze(_,n,e)*u%e,U=Ze(S,eo,e);if(!to.eql(to.sqr(U),t))throw new Error("Cannot find square root");return U}const to=qs(Rl,void 0,void 0,{sqrt:Xm});Gm({a:Ym,b:BigInt(7),Fp:to,n:Nl,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=Nl,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-Zm*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,o=BigInt("0x100000000000000000000000000000000"),a=Pl(s*t,e),c=Pl(-n*t,e);let u=Ne(t-a*r-c*i,e),l=Ne(-a*n-c*s,e);const f=u>o,h=l>o;if(f&&(u=e-u),h&&(l=e-l),u>o||l>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:f,k1:u,k2neg:h,k2:l}}}},q1);function Jm(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let u=0;u<e.length;u++)e[u]=255;for(let u=0;u<t.length;u++){const l=t.charAt(u),f=l.charCodeAt(0);if(e[f]!==255)throw new TypeError(l+" is ambiguous");e[f]=u}const r=t.length,n=t.charAt(0),i=Math.log(r)/Math.log(256),s=Math.log(256)/Math.log(r);function o(u){if(u instanceof Uint8Array||(ArrayBuffer.isView(u)?u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):Array.isArray(u)&&(u=Uint8Array.from(u))),!(u instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(u.length===0)return"";let l=0,f=0,h=0;const g=u.length;for(;h!==g&&u[h]===0;)h++,l++;const d=(g-h)*s+1>>>0,p=new Uint8Array(d);for(;h!==g;){let P=u[h],E=0;for(let _=d-1;(P!==0||E<f)&&_!==-1;_--,E++)P+=256*p[_]>>>0,p[_]=P%r>>>0,P=P/r>>>0;if(P!==0)throw new Error("Non-zero carry");f=E,h++}let m=d-f;for(;m!==d&&p[m]===0;)m++;let C=n.repeat(l);for(;m<d;++m)C+=t.charAt(p[m]);return C}function a(u){if(typeof u!="string")throw new TypeError("Expected String");if(u.length===0)return new Uint8Array;let l=0,f=0,h=0;for(;u[l]===n;)f++,l++;const g=(u.length-l)*i+1>>>0,d=new Uint8Array(g);for(;l<u.length;){const P=u.charCodeAt(l);if(P>255)return;let E=e[P];if(E===255)return;let _=0;for(let S=g-1;(E!==0||_<h)&&S!==-1;S--,_++)E+=r*d[S]>>>0,d[S]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");h=_,l++}let p=g-h;for(;p!==g&&d[p]===0;)p++;const m=new Uint8Array(f+(g-p));let C=f;for(;p!==g;)m[C++]=d[p++];return m}function c(u){const l=a(u);if(l)return l;throw new Error("Non-base"+r+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var Qm="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";Jm(Qm);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function ci(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ro(t,...e){if(!ci(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function $l(t,e){return Array.isArray(e)?e.length===0?!0:t?e.every(r=>typeof r=="string"):e.every(r=>Number.isSafeInteger(r)):!1}function Ll(t){if(typeof t!="function")throw new Error("function expected");return!0}function $t(t,e){if(typeof e!="string")throw new Error(`${t}: string expected`);return!0}function sn(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function ui(t){if(!Array.isArray(t))throw new Error("array expected")}function li(t,e){if(!$l(!0,e))throw new Error(`${t}: array of strings expected`)}function no(t,e){if(!$l(!1,e))throw new Error(`${t}: array of numbers expected`)}function Me(...t){const e=s=>s,r=(s,o)=>a=>s(o(a)),n=t.map(s=>s.encode).reduceRight(r,e),i=t.map(s=>s.decode).reduce(r,e);return{encode:n,decode:i}}function He(t){const e=typeof t=="string"?t.split(""):t,r=e.length;li("alphabet",e);const n=new Map(e.map((i,s)=>[i,s]));return{encode:i=>(ui(i),i.map(s=>{if(!Number.isSafeInteger(s)||s<0||s>=r)throw new Error(`alphabet.encode: digit index outside alphabet "${s}". Allowed: ${t}`);return e[s]})),decode:i=>(ui(i),i.map(s=>{$t("alphabet.decode",s);const o=n.get(s);if(o===void 0)throw new Error(`Unknown letter: "${s}". Allowed: ${t}`);return o}))}}function Ve(t=""){return $t("join",t),{encode:e=>(li("join.decode",e),e.join(t)),decode:e=>($t("join.decode",e),e.split(t))}}function fi(t,e="="){return sn(t),$t("padding",e),{encode(r){for(li("padding.encode",r);r.length*t%8;)r.push(e);return r},decode(r){li("padding.decode",r);let n=r.length;if(n*t%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;n>0&&r[n-1]===e;n--)if((n-1)*t%8===0)throw new Error("padding: invalid, string has too much padding");return r.slice(0,n)}}}function Ul(t){return Ll(t),{encode:e=>e,decode:e=>t(e)}}function Fl(t,e,r){if(e<2)throw new Error(`convertRadix: invalid from=${e}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: invalid to=${r}, base cannot be less than 2`);if(ui(t),!t.length)return[];let n=0;const i=[],s=Array.from(t,a=>{if(sn(a),a<0||a>=e)throw new Error(`invalid integer: ${a}`);return a}),o=s.length;for(;;){let a=0,c=!0;for(let u=n;u<o;u++){const l=s[u],f=e*a,h=f+l;if(!Number.isSafeInteger(h)||f/e!==a||h-l!==f)throw new Error("convertRadix: carry overflow");const g=h/r;a=h%r;const d=Math.floor(g);if(s[u]=d,!Number.isSafeInteger(d)||d*r+a!==h)throw new Error("convertRadix: carry overflow");if(c)d?c=!1:n=u;else continue}if(i.push(a),c)break}for(let a=0;a<t.length-1&&t[a]===0;a++)i.push(0);return i.reverse()}const jl=(t,e)=>e===0?t:jl(e,t%e),hi=(t,e)=>t+(e-jl(t,e)),di=(()=>{let t=[];for(let e=0;e<40;e++)t.push(2**e);return t})();function io(t,e,r,n){if(ui(t),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(hi(e,r)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${r} carryBits=${hi(e,r)}`);let i=0,s=0;const o=di[e],a=di[r]-1,c=[];for(const u of t){if(sn(u),u>=o)throw new Error(`convertRadix2: invalid data word=${u} from=${e}`);if(i=i<<e|u,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=r;s-=r)c.push((i>>s-r&a)>>>0);const l=di[s];if(l===void 0)throw new Error("invalid carry");i&=l-1}if(i=i<<r-s&a,!n&&s>=e)throw new Error("Excess padding");if(!n&&i>0)throw new Error(`Non-zero padding: ${i}`);return n&&s>0&&c.push(i>>>0),c}function eE(t){sn(t);const e=2**8;return{encode:r=>{if(!ci(r))throw new Error("radix.encode input should be Uint8Array");return Fl(Array.from(r),e,t)},decode:r=>(no("radix.decode",r),Uint8Array.from(Fl(r,t,e)))}}function Xe(t,e=!1){if(sn(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(hi(8,t)>32||hi(t,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!ci(r))throw new Error("radix2.encode input should be Uint8Array");return io(Array.from(r),8,t,!e)},decode:r=>(no("radix2.decode",r),Uint8Array.from(io(r,t,8,e)))}}function zl(t){return Ll(t),function(...e){try{return t.apply(null,e)}catch{}}}const kl=typeof Uint8Array.from([]).toBase64=="function"&&typeof Uint8Array.fromBase64=="function",Ml=(t,e)=>{$t("base64",t);const r=e?/^[A-Za-z0-9=_-]+$/:/^[A-Za-z0-9=+/]+$/,n=e?"base64url":"base64";if(t.length>0&&!r.test(t))throw new Error("invalid base64");return Uint8Array.fromBase64(t,{alphabet:n,lastChunkHandling:"strict"})},so=t=>Me(eE(58),He(t),Ve("")),oo=Me(He("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),Ve("")),Hl=[996825010,642813549,513874426,1027748829,705979059];function on(t){const e=t>>25;let r=(t&33554431)<<5;for(let n=0;n<Hl.length;n++)(e>>n&1)===1&&(r^=Hl[n]);return r}function Vl(t,e,r=1){const n=t.length;let i=1;for(let s=0;s<n;s++){const o=t.charCodeAt(s);if(o<33||o>126)throw new Error(`Invalid prefix (${t})`);i=on(i)^o>>5}i=on(i);for(let s=0;s<n;s++)i=on(i)^t.charCodeAt(s)&31;for(let s of e)i=on(i)^s;for(let s=0;s<6;s++)i=on(i);return i^=r,oo.encode(io([i%di[30]],30,5,!1))}function Kl(t){const e=t==="bech32"?1:734539939,r=Xe(5),n=r.decode,i=r.encode,s=zl(n);function o(f,h,g=90){$t("bech32.encode prefix",f),ci(h)&&(h=Array.from(h)),no("bech32.encode",h);const d=f.length;if(d===0)throw new TypeError(`Invalid prefix length ${d}`);const p=d+7+h.length;if(g!==!1&&p>g)throw new TypeError(`Length ${p} exceeds limit ${g}`);const m=f.toLowerCase(),C=Vl(m,h,e);return`${m}1${oo.encode(h)}${C}`}function a(f,h=90){$t("bech32.decode input",f);const g=f.length;if(g<8||h!==!1&&g>h)throw new TypeError(`invalid string length: ${g} (${f}). Expected (8..${h})`);const d=f.toLowerCase();if(f!==d&&f!==f.toUpperCase())throw new Error("String must be lowercase or uppercase");const p=d.lastIndexOf("1");if(p===0||p===-1)throw new Error('Letter "1" must be present between prefix and data only');const m=d.slice(0,p),C=d.slice(p+1);if(C.length<6)throw new Error("Data must be at least 6 characters long");const P=oo.decode(C).slice(0,-6),E=Vl(m,P,e);if(!C.endsWith(E))throw new Error(`Invalid checksum in ${f}: expected "${E}"`);return{prefix:m,words:P}}const c=zl(a);function u(f){const{prefix:h,words:g}=a(f,!1);return{prefix:h,words:g,bytes:n(g)}}function l(f,h){return o(f,i(h))}return{encode:o,decode:a,encodeFromBytes:l,decodeToBytes:u,decodeUnsafe:c,fromWords:n,fromWordsUnsafe:s,toWords:i}}const tE=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",rE={encode(t){return ro(t),t.toHex()},decode(t){return $t("hex",t),Uint8Array.fromHex(t)}};function an(t,e){e||(e=t.reduce((i,s)=>i+s.length,0));const r=Bu(e);let n=0;for(const i of t)r.set(i,n),n+=i.length;return Ss(r)}function Pe(t,e="utf8"){const r=Nu[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}const nE={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var iE=Object.defineProperty,sE=Object.defineProperties,oE=Object.getOwnPropertyDescriptors,ql=Object.getOwnPropertySymbols,aE=Object.prototype.hasOwnProperty,cE=Object.prototype.propertyIsEnumerable,Wl=(t,e,r)=>e in t?iE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Tr=(t,e)=>{for(var r in e||(e={}))aE.call(e,r)&&Wl(t,r,e[r]);if(ql)for(var r of ql(e))cE.call(e,r)&&Wl(t,r,e[r]);return t},cn=(t,e)=>sE(t,oE(e));const uE="ReactNative",nt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},lE="js";function gi(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function cr(){return!Dr()&&!!As()&&navigator.product===uE}function fE(){return cr()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function hE(){return cr()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function un(){return!gi()&&!!As()&&!!Dr()}function pi(){return cr()?nt.reactNative:gi()?nt.node:un()?nt.browser:nt.unknown}function Gl(){var t;try{return cr()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function dE(t,e){const r=new URLSearchParams(t);for(const n of Object.keys(e).sort())if(e.hasOwnProperty(n)){const i=e[n];i!==void 0&&r.set(n,i)}return r.toString()}function gE(){return ju()||{name:"",description:"",url:"",icons:[""]}}function pE(){if(pi()===nt.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:n}=global.Platform;return[r,n].join("-")}const t=Ww();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function yE(){var t;const e=pi();return e===nt.browser?[e,((t=Fu())==null?void 0:t.host)||"unknown"].join(":"):e}function Yl(t,e,r){const n=pE(),i=yE();return[[t,e].join("-"),[lE,r].join("-"),n,i].join("/")}function bE({protocol:t,version:e,relayUrl:r,sdkVersion:n,auth:i,projectId:s,useOnCloseEvent:o,bundleId:a,packageName:c}){const u=r.split("?"),l=Yl(t,e,n),f={auth:i,ua:l,projectId:s,useOnCloseEvent:o||void 0,packageName:c||void 0,bundleId:a||void 0},h=dE(u[1]||"",f);return u[0]+"?"+h}function ao(t){return Object.fromEntries(t.entries())}function co(t){return new Map(Object.entries(t))}function wE(t=V.FIVE_MINUTES,e){const r=V.toMiliseconds(t||V.FIVE_MINUTES);let n,i,s,o;return{resolve:a=>{s&&n&&(clearTimeout(s),n(a),o=Promise.resolve(a))},reject:a=>{s&&i&&(clearTimeout(s),i(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);s=setTimeout(()=>{const u=new Error(e);o=Promise.reject(u),c(u)},r),n=a,i=c})}}function Lt(t,e,r){return new Promise(async(n,i)=>{const s=setTimeout(()=>i(new Error(r)),e);try{const o=await t;n(o)}catch(o){i(o)}clearTimeout(s)})}function Zl(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function mE(t){return Zl("topic",t)}function EE(t){return Zl("id",t)}function vE(t){const[e,r]=t.split(":"),n={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")n.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))n.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return n}function ln(t,e){return V.fromMiliseconds((e||Date.now())+V.toMiliseconds(t))}function Xl(t){return Date.now()>=V.toMiliseconds(t)}function uo(t,e){return`${t}${e?`:${e}`:""}`}function Jl(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function Ql(){return typeof process<"u"&&process.env.IS_VITEST==="true"}function ef(t){return Buffer.from(t,"base64").toString("utf-8")}function _E(t){return new Promise(e=>setTimeout(e,t))}const yi=BigInt(2**32-1),tf=BigInt(32);function rf(t,e=!1){return e?{h:Number(t&yi),l:Number(t>>tf&yi)}:{h:Number(t>>tf&yi)|0,l:Number(t&yi)|0}}function nf(t,e=!1){const r=t.length;let n=new Uint32Array(r),i=new Uint32Array(r);for(let s=0;s<r;s++){const{h:o,l:a}=rf(t[s],e);[n[s],i[s]]=[o,a]}return[n,i]}const sf=(t,e,r)=>t>>>r,of=(t,e,r)=>t<<32-r|e>>>r,Ut=(t,e,r)=>t>>>r|e<<32-r,Ft=(t,e,r)=>t<<32-r|e>>>r,fn=(t,e,r)=>t<<64-r|e>>>r-32,hn=(t,e,r)=>t>>>r-32|e<<64-r,xE=(t,e)=>e,DE=(t,e)=>t,IE=(t,e,r)=>t<<r|e>>>32-r,SE=(t,e,r)=>e<<r|t>>>32-r,OE=(t,e,r)=>e<<r-32|t>>>64-r,AE=(t,e,r)=>t<<r-32|e>>>64-r;function it(t,e,r,n){const i=(e>>>0)+(n>>>0);return{h:t+r+(i/2**32|0)|0,l:i|0}}const lo=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),fo=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,TE=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),BE=(t,e,r,n,i)=>e+r+n+i+(t/2**32|0)|0,CE=(t,e,r,n,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(i>>>0),RE=(t,e,r,n,i,s)=>e+r+n+i+s+(t/2**32|0)|0,Br=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function ho(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Dt(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Je(t,...e){if(!ho(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function go(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Dt(t.outputLen),Dt(t.blockLen)}function jt(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function po(t,e){Je(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function dn(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Qe(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function yo(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function dt(t,e){return t<<32-e|t>>>e}const af=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function cf(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const It=af?t=>t:t=>cf(t);function NE(t){for(let e=0;e<t.length;e++)t[e]=cf(t[e]);return t}const zt=af?t=>t:NE,uf=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",PE=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function gn(t){if(Je(t),uf)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=PE[t[r]];return e}const St={_0:48,_9:57,A:65,F:70,a:97,f:102};function lf(t){if(t>=St._0&&t<=St._9)return t-St._0;if(t>=St.A&&t<=St.F)return t-(St.A-10);if(t>=St.a&&t<=St.f)return t-(St.a-10)}function bo(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(uf)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=lf(t.charCodeAt(s)),a=lf(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function $E(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function st(t){return typeof t=="string"&&(t=$E(t)),Je(t),t}function ur(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];Je(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}class bi{}function pn(t){const e=n=>t().update(st(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function LE(t){const e=(n,i)=>t(i).update(st(n)).digest(),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}function Cr(t=32){if(Br&&typeof Br.getRandomValues=="function")return Br.getRandomValues(new Uint8Array(t));if(Br&&typeof Br.randomBytes=="function")return Uint8Array.from(Br.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const UE=BigInt(0),yn=BigInt(1),FE=BigInt(2),jE=BigInt(7),zE=BigInt(256),kE=BigInt(113),ff=[],hf=[],df=[];for(let t=0,e=yn,r=1,n=0;t<24;t++){[r,n]=[n,(2*r+3*n)%5],ff.push(2*(5*n+r)),hf.push((t+1)*(t+2)/2%64);let i=UE;for(let s=0;s<7;s++)e=(e<<yn^(e>>jE)*kE)%zE,e&FE&&(i^=yn<<(yn<<BigInt(s))-yn);df.push(i)}const gf=nf(df,!0),ME=gf[0],HE=gf[1],pf=(t,e,r)=>r>32?OE(t,e,r):IE(t,e,r),yf=(t,e,r)=>r>32?AE(t,e,r):SE(t,e,r);function VE(t,e=24){const r=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=r[c],l=r[c+1],f=pf(u,l,1)^r[a],h=yf(u,l,1)^r[a+1];for(let g=0;g<50;g+=10)t[o+g]^=f,t[o+g+1]^=h}let i=t[2],s=t[3];for(let o=0;o<24;o++){const a=hf[o],c=pf(i,s,a),u=yf(i,s,a),l=ff[o];i=t[l],s=t[l+1],t[l]=c,t[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=ME[n],t[1]^=HE[n]}Qe(r)}class wo extends bi{constructor(e,r,n,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=n,this.enableXOF=i,this.rounds=s,Dt(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=dn(this.state)}clone(){return this._cloneInto()}keccak(){zt(this.state32),VE(this.state32,this.rounds),zt(this.state32),this.posOut=0,this.pos=0}update(e){jt(this),e=st(e),Je(e);const{blockLen:r,state:n}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);for(let a=0;a<o;a++)n[this.pos++]^=e[s++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:n,blockLen:i}=this;e[n]^=r,(r&128)!==0&&n===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){jt(this,!1),Je(e),this.finish();const r=this.state,{blockLen:n}=this;for(let i=0,s=e.length;i<s;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,s-i);e.set(r.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Dt(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(po(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Qe(this.state)}_cloneInto(e){const{blockLen:r,suffix:n,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new wo(r,n,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=n,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}}((t,e,r)=>pn(()=>new wo(e,t,r)))(1,136,256/8);function KE(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,u=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+u,a,n)}function qE(t,e,r){return t&e^~t&r}function WE(t,e,r){return t&e^t&r^e&r}class bf extends bi{constructor(e,r,n,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.buffer=new Uint8Array(e),this.view=yo(this.buffer)}update(e){jt(this),e=st(e),Je(e);const{view:r,buffer:n,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=yo(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){jt(this),po(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,Qe(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(n,0),o=0);for(let f=o;f<i;f++)r[f]=0;KE(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=yo(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<u;f++)a.setUint32(4*f,l[f],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}}const kt=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ee=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),ve=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),GE=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Mt=new Uint32Array(64);class YE extends bf{constructor(e=32){super(64,e,8,!1),this.A=kt[0]|0,this.B=kt[1]|0,this.C=kt[2]|0,this.D=kt[3]|0,this.E=kt[4]|0,this.F=kt[5]|0,this.G=kt[6]|0,this.H=kt[7]|0}get(){const{A:e,B:r,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,r,n,i,s,o,a,c]}set(e,r,n,i,s,o,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let f=0;f<16;f++,r+=4)Mt[f]=e.getUint32(r,!1);for(let f=16;f<64;f++){const h=Mt[f-15],g=Mt[f-2],d=dt(h,7)^dt(h,18)^h>>>3,p=dt(g,17)^dt(g,19)^g>>>10;Mt[f]=p+Mt[f-7]+d+Mt[f-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:u,H:l}=this;for(let f=0;f<64;f++){const h=dt(a,6)^dt(a,11)^dt(a,25),g=l+h+qE(a,c,u)+GE[f]+Mt[f]|0,d=(dt(n,2)^dt(n,13)^dt(n,22))+WE(n,i,s)|0;l=u,u=c,c=a,a=o+g|0,o=s,s=i,i=n,n=g+d|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,i,s,o,a,c,u,l)}roundClean(){Qe(Mt)}destroy(){this.set(0,0,0,0,0,0,0,0),Qe(this.buffer)}}const wf=nf(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),ZE=wf[0],XE=wf[1],Ht=new Uint32Array(80),Vt=new Uint32Array(80);class mo extends bf{constructor(e=64){super(128,e,16,!1),this.Ah=ve[0]|0,this.Al=ve[1]|0,this.Bh=ve[2]|0,this.Bl=ve[3]|0,this.Ch=ve[4]|0,this.Cl=ve[5]|0,this.Dh=ve[6]|0,this.Dl=ve[7]|0,this.Eh=ve[8]|0,this.El=ve[9]|0,this.Fh=ve[10]|0,this.Fl=ve[11]|0,this.Gh=ve[12]|0,this.Gl=ve[13]|0,this.Hh=ve[14]|0,this.Hl=ve[15]|0}get(){const{Ah:e,Al:r,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:f,Fl:h,Gh:g,Gl:d,Hh:p,Hl:m}=this;return[e,r,n,i,s,o,a,c,u,l,f,h,g,d,p,m]}set(e,r,n,i,s,o,a,c,u,l,f,h,g,d,p,m){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=f|0,this.Fl=h|0,this.Gh=g|0,this.Gl=d|0,this.Hh=p|0,this.Hl=m|0}process(e,r){for(let E=0;E<16;E++,r+=4)Ht[E]=e.getUint32(r),Vt[E]=e.getUint32(r+=4);for(let E=16;E<80;E++){const _=Ht[E-15]|0,S=Vt[E-15]|0,U=Ut(_,S,1)^Ut(_,S,8)^sf(_,S,7),$=Ft(_,S,1)^Ft(_,S,8)^of(_,S,7),R=Ht[E-2]|0,w=Vt[E-2]|0,T=Ut(R,w,19)^fn(R,w,61)^sf(R,w,6),x=Ft(R,w,19)^hn(R,w,61)^of(R,w,6),D=TE($,x,Vt[E-7],Vt[E-16]),A=BE(D,U,T,Ht[E-7],Ht[E-16]);Ht[E]=A|0,Vt[E]=D|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:f,El:h,Fh:g,Fl:d,Gh:p,Gl:m,Hh:C,Hl:P}=this;for(let E=0;E<80;E++){const _=Ut(f,h,14)^Ut(f,h,18)^fn(f,h,41),S=Ft(f,h,14)^Ft(f,h,18)^hn(f,h,41),U=f&g^~f&p,$=h&d^~h&m,R=CE(P,S,$,XE[E],Vt[E]),w=RE(R,C,_,U,ZE[E],Ht[E]),T=R|0,x=Ut(n,i,28)^fn(n,i,34)^fn(n,i,39),D=Ft(n,i,28)^hn(n,i,34)^hn(n,i,39),A=n&s^n&a^s&a,L=i&o^i&c^o&c;C=p|0,P=m|0,p=g|0,m=d|0,g=f|0,d=h|0,{h:f,l:h}=it(u|0,l|0,w|0,T|0),u=a|0,l=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const b=lo(T,D,L);n=fo(b,w,x,A),i=b|0}({h:n,l:i}=it(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=it(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=it(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=it(this.Dh|0,this.Dl|0,u|0,l|0),{h:f,l:h}=it(this.Eh|0,this.El|0,f|0,h|0),{h:g,l:d}=it(this.Fh|0,this.Fl|0,g|0,d|0),{h:p,l:m}=it(this.Gh|0,this.Gl|0,p|0,m|0),{h:C,l:P}=it(this.Hh|0,this.Hl|0,C|0,P|0),this.set(n,i,s,o,a,c,u,l,f,h,g,d,p,m,C,P)}roundClean(){Qe(Ht,Vt)}destroy(){Qe(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class JE extends mo{constructor(){super(48),this.Ah=Ee[0]|0,this.Al=Ee[1]|0,this.Bh=Ee[2]|0,this.Bl=Ee[3]|0,this.Ch=Ee[4]|0,this.Cl=Ee[5]|0,this.Dh=Ee[6]|0,this.Dl=Ee[7]|0,this.Eh=Ee[8]|0,this.El=Ee[9]|0,this.Fh=Ee[10]|0,this.Fl=Ee[11]|0,this.Gh=Ee[12]|0,this.Gl=Ee[13]|0,this.Hh=Ee[14]|0,this.Hl=Ee[15]|0}}const _e=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class QE extends mo{constructor(){super(32),this.Ah=_e[0]|0,this.Al=_e[1]|0,this.Bh=_e[2]|0,this.Bl=_e[3]|0,this.Ch=_e[4]|0,this.Cl=_e[5]|0,this.Dh=_e[6]|0,this.Dl=_e[7]|0,this.Eh=_e[8]|0,this.El=_e[9]|0,this.Fh=_e[10]|0,this.Fl=_e[11]|0,this.Gh=_e[12]|0,this.Gl=_e[13]|0,this.Hh=_e[14]|0,this.Hl=_e[15]|0}}const mf=pn(()=>new YE),ev=pn(()=>new mo),tv=pn(()=>new JE);pn(()=>new QE);const rv=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),ce=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),z=new Uint32Array(32);function Kt(t,e,r,n,i,s){const o=i[s],a=i[s+1];let c=z[2*t],u=z[2*t+1],l=z[2*e],f=z[2*e+1],h=z[2*r],g=z[2*r+1],d=z[2*n],p=z[2*n+1],m=lo(c,l,o);u=fo(m,u,f,a),c=m|0,{Dh:p,Dl:d}={Dh:p^u,Dl:d^c},{Dh:p,Dl:d}={Dh:xE(p,d),Dl:DE(p)},{h:g,l:h}=it(g,h,p,d),{Bh:f,Bl:l}={Bh:f^g,Bl:l^h},{Bh:f,Bl:l}={Bh:Ut(f,l,24),Bl:Ft(f,l,24)},z[2*t]=c,z[2*t+1]=u,z[2*e]=l,z[2*e+1]=f,z[2*r]=h,z[2*r+1]=g,z[2*n]=d,z[2*n+1]=p}function qt(t,e,r,n,i,s){const o=i[s],a=i[s+1];let c=z[2*t],u=z[2*t+1],l=z[2*e],f=z[2*e+1],h=z[2*r],g=z[2*r+1],d=z[2*n],p=z[2*n+1],m=lo(c,l,o);u=fo(m,u,f,a),c=m|0,{Dh:p,Dl:d}={Dh:p^u,Dl:d^c},{Dh:p,Dl:d}={Dh:Ut(p,d,16),Dl:Ft(p,d,16)},{h:g,l:h}=it(g,h,p,d),{Bh:f,Bl:l}={Bh:f^g,Bl:l^h},{Bh:f,Bl:l}={Bh:fn(f,l,63),Bl:hn(f,l,63)},z[2*t]=c,z[2*t+1]=u,z[2*e]=l,z[2*e+1]=f,z[2*r]=h,z[2*r+1]=g,z[2*n]=d,z[2*n+1]=p}function nv(t,e={},r,n,i){if(Dt(r),t<0||t>r)throw new Error("outputLen bigger than keyLen");const{key:s,salt:o,personalization:a}=e;if(s!==void 0&&(s.length<1||s.length>r))throw new Error("key length must be undefined or 1.."+r);if(o!==void 0&&o.length!==n)throw new Error("salt must be undefined or "+n);if(a!==void 0&&a.length!==i)throw new Error("personalization must be undefined or "+i)}class iv extends bi{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,Dt(e),Dt(r),this.blockLen=e,this.outputLen=r,this.buffer=new Uint8Array(e),this.buffer32=dn(this.buffer)}update(e){jt(this),e=st(e),Je(e);const{blockLen:r,buffer:n,buffer32:i}=this,s=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<s;){this.pos===r&&(zt(i),this.compress(i,0,!1),zt(i),this.pos=0);const u=Math.min(r-this.pos,s-c),l=o+c;if(u===r&&!(l%4)&&c+u<s){const f=new Uint32Array(a,l,Math.floor((s-c)/4));zt(f);for(let h=0;c+r<s;h+=i.length,c+=r)this.length+=r,this.compress(f,h,!1);zt(f);continue}n.set(e.subarray(c,c+u),this.pos),this.pos+=u,this.length+=u,c+=u}return this}digestInto(e){jt(this),po(e,this);const{pos:r,buffer32:n}=this;this.finished=!0,Qe(this.buffer.subarray(r)),zt(n),this.compress(n,0,!0),zt(n);const i=dn(e);this.get().forEach((s,o)=>i[o]=It(s))}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){const{buffer:r,length:n,finished:i,destroyed:s,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(r),e.destroyed=s,e.finished=i,e.length=n,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}}class sv extends iv{constructor(e={}){const r=e.dkLen===void 0?64:e.dkLen;super(128,r),this.v0l=ce[0]|0,this.v0h=ce[1]|0,this.v1l=ce[2]|0,this.v1h=ce[3]|0,this.v2l=ce[4]|0,this.v2h=ce[5]|0,this.v3l=ce[6]|0,this.v3h=ce[7]|0,this.v4l=ce[8]|0,this.v4h=ce[9]|0,this.v5l=ce[10]|0,this.v5h=ce[11]|0,this.v6l=ce[12]|0,this.v6h=ce[13]|0,this.v7l=ce[14]|0,this.v7h=ce[15]|0,nv(r,e,64,16,16);let{key:n,personalization:i,salt:s}=e,o=0;if(n!==void 0&&(n=st(n),o=n.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,s!==void 0){s=st(s);const a=dn(s);this.v4l^=It(a[0]),this.v4h^=It(a[1]),this.v5l^=It(a[2]),this.v5h^=It(a[3])}if(i!==void 0){i=st(i);const a=dn(i);this.v6l^=It(a[0]),this.v6h^=It(a[1]),this.v7l^=It(a[2]),this.v7h^=It(a[3])}if(n!==void 0){const a=new Uint8Array(this.blockLen);a.set(n),this.update(a)}}get(){let{v0l:e,v0h:r,v1l:n,v1h:i,v2l:s,v2h:o,v3l:a,v3h:c,v4l:u,v4h:l,v5l:f,v5h:h,v6l:g,v6h:d,v7l:p,v7h:m}=this;return[e,r,n,i,s,o,a,c,u,l,f,h,g,d,p,m]}set(e,r,n,i,s,o,a,c,u,l,f,h,g,d,p,m){this.v0l=e|0,this.v0h=r|0,this.v1l=n|0,this.v1h=i|0,this.v2l=s|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=u|0,this.v4h=l|0,this.v5l=f|0,this.v5h=h|0,this.v6l=g|0,this.v6h=d|0,this.v7l=p|0,this.v7h=m|0}compress(e,r,n){this.get().forEach((c,u)=>z[u]=c),z.set(ce,16);let{h:i,l:s}=rf(BigInt(this.length));z[24]=ce[8]^s,z[25]=ce[9]^i,n&&(z[28]=~z[28],z[29]=~z[29]);let o=0;const a=rv;for(let c=0;c<12;c++)Kt(0,4,8,12,e,r+2*a[o++]),qt(0,4,8,12,e,r+2*a[o++]),Kt(1,5,9,13,e,r+2*a[o++]),qt(1,5,9,13,e,r+2*a[o++]),Kt(2,6,10,14,e,r+2*a[o++]),qt(2,6,10,14,e,r+2*a[o++]),Kt(3,7,11,15,e,r+2*a[o++]),qt(3,7,11,15,e,r+2*a[o++]),Kt(0,5,10,15,e,r+2*a[o++]),qt(0,5,10,15,e,r+2*a[o++]),Kt(1,6,11,12,e,r+2*a[o++]),qt(1,6,11,12,e,r+2*a[o++]),Kt(2,7,8,13,e,r+2*a[o++]),qt(2,7,8,13,e,r+2*a[o++]),Kt(3,4,9,14,e,r+2*a[o++]),qt(3,4,9,14,e,r+2*a[o++]);this.v0l^=z[0]^z[16],this.v0h^=z[1]^z[17],this.v1l^=z[2]^z[18],this.v1h^=z[3]^z[19],this.v2l^=z[4]^z[20],this.v2h^=z[5]^z[21],this.v3l^=z[6]^z[22],this.v3h^=z[7]^z[23],this.v4l^=z[8]^z[24],this.v4h^=z[9]^z[25],this.v5l^=z[10]^z[26],this.v5h^=z[11]^z[27],this.v6l^=z[12]^z[28],this.v6h^=z[13]^z[29],this.v7l^=z[14]^z[30],this.v7h^=z[15]^z[31],Qe(z)}destroy(){this.destroyed=!0,Qe(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}LE(t=>new sv(t));/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function Ef(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Eo(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function vo(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function $e(t,...e){if(!Ef(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function vf(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function ov(t,e){$e(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Wt(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Rr(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function av(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const cv=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function uv(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function _o(t){if(typeof t=="string")t=uv(t);else if(Ef(t))t=xo(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function lv(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function fv(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return r===0}const hv=(t,e)=>{function r(n,...i){if($e(n),!cv)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const u=i[0];if(!u)throw new Error("nonce / iv required");t.varSizeNonce?$e(u):$e(u,t.nonceLength)}const s=t.tagLength;s&&i[1]!==void 0&&$e(i[1]);const o=e(n,...i),a=(u,l)=>{if(l!==void 0){if(u!==2)throw new Error("cipher output not supported");$e(l)}};let c=!1;return{encrypt(u,l){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,$e(u),a(o.encrypt.length,l),o.encrypt(u,l)},decrypt(u,l){if($e(u),s&&u.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,l),o.decrypt(u,l)}}}return Object.assign(r,t),r};function _f(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!gv(e))throw new Error("invalid output, must be aligned");return e}function xf(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,u=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+u,a,n)}function dv(t,e,r){Eo(r);const n=new Uint8Array(16),i=av(n);return xf(i,0,BigInt(e),r),xf(i,8,BigInt(t),r),n}function gv(t){return t.byteOffset%4===0}function xo(t){return Uint8Array.from(t)}const Df=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),pv=Df("expand 16-byte k"),yv=Df("expand 32-byte k"),bv=Wt(pv),wv=Wt(yv);function Z(t,e){return t<<e|t>>>32-e}function Do(t){return t.byteOffset%4===0}const wi=64,mv=16,If=2**32-1,Sf=new Uint32Array;function Ev(t,e,r,n,i,s,o,a){const c=i.length,u=new Uint8Array(wi),l=Wt(u),f=Do(i)&&Do(s),h=f?Wt(i):Sf,g=f?Wt(s):Sf;for(let d=0;d<c;o++){if(t(e,r,n,l,o,a),o>=If)throw new Error("arx: counter overflow");const p=Math.min(wi,c-d);if(f&&p===wi){const m=d/4;if(d%4!==0)throw new Error("arx: invalid block position");for(let C=0,P;C<mv;C++)P=m+C,g[P]=h[P]^l[C];d+=wi;continue}for(let m=0,C;m<p;m++)C=d+m,s[C]=i[C]^u[m];d+=p}}function vv(t,e){const{allowShortKeys:r,extendNonceFn:n,counterLength:i,counterRight:s,rounds:o}=lv({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return vo(i),vo(o),Eo(s),Eo(r),(a,c,u,l,f=0)=>{$e(a),$e(c),$e(u);const h=u.length;if(l===void 0&&(l=new Uint8Array(h)),$e(l),vo(f),f<0||f>=If)throw new Error("arx: counter overflow");if(l.length<h)throw new Error(`arx: output (${l.length}) is shorter than data (${h})`);const g=[];let d=a.length,p,m;if(d===32)g.push(p=xo(a)),m=wv;else if(d===16&&r)p=new Uint8Array(32),p.set(a),p.set(a,16),m=bv,g.push(p);else throw new Error(`arx: invalid 32-byte key, got length=${d}`);Do(c)||g.push(c=xo(c));const C=Wt(p);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(m,C,Wt(c.subarray(0,16)),C),c=c.subarray(16)}const P=16-i;if(P!==c.length)throw new Error(`arx: nonce must be ${P} or 16 bytes`);if(P!==12){const _=new Uint8Array(12);_.set(c,s?0:12-c.length),c=_,g.push(c)}const E=Wt(c);return Ev(t,m,C,E,u,l,f,o),Rr(...g),l}}const ye=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class _v{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=_o(e),$e(e,32);const r=ye(e,0),n=ye(e,2),i=ye(e,4),s=ye(e,6),o=ye(e,8),a=ye(e,10),c=ye(e,12),u=ye(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|n<<3)&8191,this.r[2]=(n>>>10|i<<6)&7939,this.r[3]=(i>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|u<<8)&8191,this.r[9]=u>>>5&127;for(let l=0;l<8;l++)this.pad[l]=ye(e,16+2*l)}process(e,r,n=!1){const i=n?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],u=o[2],l=o[3],f=o[4],h=o[5],g=o[6],d=o[7],p=o[8],m=o[9],C=ye(e,r+0),P=ye(e,r+2),E=ye(e,r+4),_=ye(e,r+6),S=ye(e,r+8),U=ye(e,r+10),$=ye(e,r+12),R=ye(e,r+14);let w=s[0]+(C&8191),T=s[1]+((C>>>13|P<<3)&8191),x=s[2]+((P>>>10|E<<6)&8191),D=s[3]+((E>>>7|_<<9)&8191),A=s[4]+((_>>>4|S<<12)&8191),L=s[5]+(S>>>1&8191),b=s[6]+((S>>>14|U<<2)&8191),y=s[7]+((U>>>11|$<<5)&8191),v=s[8]+(($>>>8|R<<8)&8191),O=s[9]+(R>>>5|i),I=0,B=I+w*a+T*(5*m)+x*(5*p)+D*(5*d)+A*(5*g);I=B>>>13,B&=8191,B+=L*(5*h)+b*(5*f)+y*(5*l)+v*(5*u)+O*(5*c),I+=B>>>13,B&=8191;let N=I+w*c+T*a+x*(5*m)+D*(5*p)+A*(5*d);I=N>>>13,N&=8191,N+=L*(5*g)+b*(5*h)+y*(5*f)+v*(5*l)+O*(5*u),I+=N>>>13,N&=8191;let F=I+w*u+T*c+x*a+D*(5*m)+A*(5*p);I=F>>>13,F&=8191,F+=L*(5*d)+b*(5*g)+y*(5*h)+v*(5*f)+O*(5*l),I+=F>>>13,F&=8191;let k=I+w*l+T*u+x*c+D*a+A*(5*m);I=k>>>13,k&=8191,k+=L*(5*p)+b*(5*d)+y*(5*g)+v*(5*h)+O*(5*f),I+=k>>>13,k&=8191;let H=I+w*f+T*l+x*u+D*c+A*a;I=H>>>13,H&=8191,H+=L*(5*m)+b*(5*p)+y*(5*d)+v*(5*g)+O*(5*h),I+=H>>>13,H&=8191;let M=I+w*h+T*f+x*l+D*u+A*c;I=M>>>13,M&=8191,M+=L*a+b*(5*m)+y*(5*p)+v*(5*d)+O*(5*g),I+=M>>>13,M&=8191;let K=I+w*g+T*h+x*f+D*l+A*u;I=K>>>13,K&=8191,K+=L*c+b*a+y*(5*m)+v*(5*p)+O*(5*d),I+=K>>>13,K&=8191;let Y=I+w*d+T*g+x*h+D*f+A*l;I=Y>>>13,Y&=8191,Y+=L*u+b*c+y*a+v*(5*m)+O*(5*p),I+=Y>>>13,Y&=8191;let Q=I+w*p+T*d+x*g+D*h+A*f;I=Q>>>13,Q&=8191,Q+=L*l+b*u+y*c+v*a+O*(5*m),I+=Q>>>13,Q&=8191;let W=I+w*m+T*p+x*d+D*g+A*h;I=W>>>13,W&=8191,W+=L*f+b*l+y*u+v*c+O*a,I+=W>>>13,W&=8191,I=(I<<2)+I|0,I=I+B|0,B=I&8191,I=I>>>13,N+=I,s[0]=B,s[1]=N,s[2]=F,s[3]=k,s[4]=H,s[5]=M,s[6]=K,s[7]=Y,s[8]=Q,s[9]=W}finalize(){const{h:e,pad:r}=this,n=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,n[0]=e[0]+5,i=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+i,i=n[a]>>>13,n[a]&=8191;n[9]-=8192;let s=(i^1)-1;for(let a=0;a<10;a++)n[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;Rr(n)}update(e){vf(this),e=_o(e),$e(e);const{buffer:r,blockLen:n}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);if(o===n){for(;n<=i-s;s+=n)this.process(e,s);continue}r.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===n&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){Rr(this.h,this.r,this.buffer,this.pad)}digestInto(e){vf(this),ov(e,this),this.finished=!0;const{buffer:r,h:n}=this;let{pos:i}=this;if(i){for(r[i++]=1;i<16;i++)r[i]=0;this.process(r,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=n[o]>>>0,e[s++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}}function xv(t){const e=(n,i)=>t(i).update(_o(n)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}const Dv=xv(t=>new _v(t));function Iv(t,e,r,n,i,s=20){let o=t[0],a=t[1],c=t[2],u=t[3],l=e[0],f=e[1],h=e[2],g=e[3],d=e[4],p=e[5],m=e[6],C=e[7],P=i,E=r[0],_=r[1],S=r[2],U=o,$=a,R=c,w=u,T=l,x=f,D=h,A=g,L=d,b=p,y=m,v=C,O=P,I=E,B=_,N=S;for(let k=0;k<s;k+=2)U=U+T|0,O=Z(O^U,16),L=L+O|0,T=Z(T^L,12),U=U+T|0,O=Z(O^U,8),L=L+O|0,T=Z(T^L,7),$=$+x|0,I=Z(I^$,16),b=b+I|0,x=Z(x^b,12),$=$+x|0,I=Z(I^$,8),b=b+I|0,x=Z(x^b,7),R=R+D|0,B=Z(B^R,16),y=y+B|0,D=Z(D^y,12),R=R+D|0,B=Z(B^R,8),y=y+B|0,D=Z(D^y,7),w=w+A|0,N=Z(N^w,16),v=v+N|0,A=Z(A^v,12),w=w+A|0,N=Z(N^w,8),v=v+N|0,A=Z(A^v,7),U=U+x|0,N=Z(N^U,16),y=y+N|0,x=Z(x^y,12),U=U+x|0,N=Z(N^U,8),y=y+N|0,x=Z(x^y,7),$=$+D|0,O=Z(O^$,16),v=v+O|0,D=Z(D^v,12),$=$+D|0,O=Z(O^$,8),v=v+O|0,D=Z(D^v,7),R=R+A|0,I=Z(I^R,16),L=L+I|0,A=Z(A^L,12),R=R+A|0,I=Z(I^R,8),L=L+I|0,A=Z(A^L,7),w=w+T|0,B=Z(B^w,16),b=b+B|0,T=Z(T^b,12),w=w+T|0,B=Z(B^w,8),b=b+B|0,T=Z(T^b,7);let F=0;n[F++]=o+U|0,n[F++]=a+$|0,n[F++]=c+R|0,n[F++]=u+w|0,n[F++]=l+T|0,n[F++]=f+x|0,n[F++]=h+D|0,n[F++]=g+A|0,n[F++]=d+L|0,n[F++]=p+b|0,n[F++]=m+y|0,n[F++]=C+v|0,n[F++]=P+O|0,n[F++]=E+I|0,n[F++]=_+B|0,n[F++]=S+N|0}const Sv=vv(Iv,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Ov=new Uint8Array(16),Of=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(Ov.subarray(r))},Av=new Uint8Array(32);function Af(t,e,r,n,i){const s=t(e,r,Av),o=Dv.create(s);i&&Of(o,i),Of(o,n);const a=dv(n.length,i?i.length:0,!0);o.update(a);const c=o.digest();return Rr(s,a),c}const Tv=t=>(e,r,n)=>({encrypt(i,s){const o=i.length;s=_f(o+16,s,!1),s.set(i);const a=s.subarray(0,-16);t(e,r,a,a,1);const c=Af(t,e,r,a,n);return s.set(c,o),Rr(c),s},decrypt(i,s){s=_f(i.length-16,s,!1);const o=i.subarray(0,-16),a=i.subarray(-16),c=Af(t,e,r,o,n);if(!fv(a,c))throw new Error("invalid tag");return s.set(i.subarray(0,-16)),t(e,r,s,s,1),Rr(c),s}}),Tf=hv({blockSize:64,nonceLength:12,tagLength:16},Tv(Sv));class Bf extends bi{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,go(e);const n=st(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),Qe(s)}update(e){return jt(this),this.iHash.update(e),this}digestInto(e){jt(this),Je(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const mi=(t,e,r)=>new Bf(t,e).update(r).digest();mi.create=(t,e)=>new Bf(t,e);function Bv(t,e,r){return go(t),r===void 0&&(r=new Uint8Array(t.outputLen)),mi(t,st(r),st(e))}const Io=Uint8Array.from([0]),Cf=Uint8Array.of();function Cv(t,e,r,n=32){go(t),Dt(n);const i=t.outputLen;if(n>255*i)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(n/i);r===void 0&&(r=Cf);const o=new Uint8Array(s*i),a=mi.create(t,e),c=a._cloneInto(),u=new Uint8Array(a.outputLen);for(let l=0;l<s;l++)Io[0]=l+1,c.update(l===0?Cf:u).update(r).update(Io).digestInto(u),o.set(u,i*l),a._cloneInto(c);return a.destroy(),c.destroy(),Qe(u,Io),o.slice(0,n)}const Rv=(t,e,r,n,i)=>Cv(t,Bv(t,e,r),n,i),Ei=mf,So=BigInt(0),Oo=BigInt(1);function vi(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function _i(t){const e=t.toString(16);return e.length&1?"0"+e:e}function Rf(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?So:BigInt("0x"+t)}function xi(t){return Rf(gn(t))}function Di(t){return Je(t),Rf(gn(Uint8Array.from(t).reverse()))}function Ao(t,e){return bo(t.toString(16).padStart(e*2,"0"))}function To(t,e){return Ao(t,e).reverse()}function Le(t,e,r){let n;if(typeof e=="string")try{n=bo(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(ho(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}const Bo=t=>typeof t=="bigint"&&So<=t;function Nv(t,e,r){return Bo(t)&&Bo(e)&&Bo(r)&&e<=t&&t<r}function Co(t,e,r,n){if(!Nv(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function Pv(t){let e;for(e=0;t>So;t>>=Oo,e+=1);return e}const Ii=t=>(Oo<<BigInt(t))-Oo;function $v(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");const n=h=>new Uint8Array(h),i=h=>Uint8Array.of(h);let s=n(t),o=n(t),a=0;const c=()=>{s.fill(1),o.fill(0),a=0},u=(...h)=>r(o,s,...h),l=(h=n(0))=>{o=u(i(0),h),s=u(),h.length!==0&&(o=u(i(1),h),s=u())},f=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const g=[];for(;h<e;){s=u();const d=s.slice();g.push(d),h+=s.length}return ur(...g)};return(h,g)=>{c(),l(h);let d;for(;!(d=g(f()));)l();return c(),d}}function Si(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function n(i,s,o){const a=t[i];if(o&&a===void 0)return;const c=typeof a;if(c!==s||a===null)throw new Error(`param "${i}" is invalid: expected ${s}, got ${c}`)}Object.entries(e).forEach(([i,s])=>n(i,s,!1)),Object.entries(r).forEach(([i,s])=>n(i,s,!0))}function Nf(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}const Ue=BigInt(0),Se=BigInt(1),lr=BigInt(2),Lv=BigInt(3),Pf=BigInt(4),$f=BigInt(5),Lf=BigInt(8);function et(t,e){const r=t%e;return r>=Ue?r:e+r}function ot(t,e,r){let n=t;for(;e-- >Ue;)n*=n,n%=r;return n}function Uf(t,e){if(t===Ue)throw new Error("invert: expected non-zero number");if(e<=Ue)throw new Error("invert: expected positive modulus, got "+e);let r=et(t,e),n=e,i=Ue,s=Se;for(;r!==Ue;){const o=n/r,a=n%r,c=i-s*o;n=r,r=a,i=s,s=c}if(n!==Se)throw new Error("invert: does not exist");return et(i,e)}function Ff(t,e){const r=(t.ORDER+Se)/Pf,n=t.pow(e,r);if(!t.eql(t.sqr(n),e))throw new Error("Cannot find square root");return n}function Uv(t,e){const r=(t.ORDER-$f)/Lf,n=t.mul(e,lr),i=t.pow(n,r),s=t.mul(e,i),o=t.mul(t.mul(s,lr),i),a=t.mul(s,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function Fv(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-Se,r=0;for(;e%lr===Ue;)e/=lr,r++;let n=lr;const i=Nr(t);for(;zf(i,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Ff;let s=i.pow(n,e);const o=(e+Se)/lr;return function(a,c){if(a.is0(c))return c;if(zf(a,c)!==1)throw new Error("Cannot find square root");let u=r,l=a.mul(a.ONE,s),f=a.pow(c,e),h=a.pow(c,o);for(;!a.eql(f,a.ONE);){if(a.is0(f))return a.ZERO;let g=1,d=a.sqr(f);for(;!a.eql(d,a.ONE);)if(g++,d=a.sqr(d),g===u)throw new Error("Cannot find square root");const p=Se<<BigInt(u-g-1),m=a.pow(l,p);u=g,l=a.sqr(m),f=a.mul(f,l),h=a.mul(h,m)}return h}}function jv(t){return t%Pf===Lv?Ff:t%Lf===$f?Uv:Fv(t)}const zv=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function kv(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=zv.reduce((n,i)=>(n[i]="function",n),e);return Si(t,r),t}function Mv(t,e,r){if(r<Ue)throw new Error("invalid exponent, negatives unsupported");if(r===Ue)return t.ONE;if(r===Se)return e;let n=t.ONE,i=e;for(;r>Ue;)r&Se&&(n=t.mul(n,i)),i=t.sqr(i),r>>=Se;return n}function jf(t,e,r=!1){const n=new Array(e.length).fill(r?t.ZERO:void 0),i=e.reduce((o,a,c)=>t.is0(a)?o:(n[c]=o,t.mul(o,a)),t.ONE),s=t.inv(i);return e.reduceRight((o,a,c)=>t.is0(a)?o:(n[c]=t.mul(o,n[c]),t.mul(o,a)),s),n}function zf(t,e){const r=(t.ORDER-Se)/lr,n=t.pow(e,r),i=t.eql(n,t.ONE),s=t.eql(n,t.ZERO),o=t.eql(n,t.neg(t.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function Hv(t,e){e!==void 0&&Dt(e);const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Nr(t,e,r=!1,n={}){if(t<=Ue)throw new Error("invalid field: expected ORDER > 0, got "+t);let i,s;if(typeof e=="object"&&e!=null){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");const l=e;l.BITS&&(i=l.BITS),l.sqrt&&(s=l.sqrt),typeof l.isLE=="boolean"&&(r=l.isLE)}else typeof e=="number"&&(i=e),n.sqrt&&(s=n.sqrt);const{nBitLength:o,nByteLength:a}=Hv(t,i);if(a>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let c;const u=Object.freeze({ORDER:t,isLE:r,BITS:o,BYTES:a,MASK:Ii(o),ZERO:Ue,ONE:Se,create:l=>et(l,t),isValid:l=>{if(typeof l!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof l);return Ue<=l&&l<t},is0:l=>l===Ue,isValidNot0:l=>!u.is0(l)&&u.isValid(l),isOdd:l=>(l&Se)===Se,neg:l=>et(-l,t),eql:(l,f)=>l===f,sqr:l=>et(l*l,t),add:(l,f)=>et(l+f,t),sub:(l,f)=>et(l-f,t),mul:(l,f)=>et(l*f,t),pow:(l,f)=>Mv(u,l,f),div:(l,f)=>et(l*Uf(f,t),t),sqrN:l=>l*l,addN:(l,f)=>l+f,subN:(l,f)=>l-f,mulN:(l,f)=>l*f,inv:l=>Uf(l,t),sqrt:s||(l=>(c||(c=jv(t)),c(u,l))),toBytes:l=>r?To(l,a):Ao(l,a),fromBytes:l=>{if(l.length!==a)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+l.length);return r?Di(l):xi(l)},invertBatch:l=>jf(u,l),cmov:(l,f,h)=>h?f:l});return Object.freeze(u)}function kf(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Mf(t){const e=kf(t);return e+Math.ceil(e/2)}function Vv(t,e,r=!1){const n=t.length,i=kf(e),s=Mf(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const o=r?Di(t):xi(t),a=et(o,e-Se)+Se;return r?To(a,i):Ao(a,i)}const Pr=BigInt(0),fr=BigInt(1);function bn(t,e){const r=e.negate();return t?r:e}function Kv(t,e,r){const n=e==="pz"?s=>s.pz:s=>s.ez,i=jf(t.Fp,r.map(n));return r.map((s,o)=>s.toAffine(i[o])).map(t.fromAffine)}function Hf(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Ro(t,e){Hf(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1),i=2**t,s=Ii(t),o=BigInt(t);return{windows:r,windowSize:n,mask:s,maxNumber:i,shiftBy:o}}function Vf(t,e,r){const{windowSize:n,mask:i,maxNumber:s,shiftBy:o}=r;let a=Number(t&i),c=t>>o;a>n&&(a-=s,c+=fr);const u=e*n,l=u+Math.abs(a)-1,f=a===0,h=a<0,g=e%2!==0;return{nextN:c,offset:l,isZero:f,isNeg:h,isNegF:g,offsetF:u}}function qv(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function Wv(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const No=new WeakMap,Kf=new WeakMap;function Po(t){return Kf.get(t)||1}function qf(t){if(t!==Pr)throw new Error("invalid wNAF")}function Gv(t,e){return{constTimeNegate:bn,hasPrecomputes(r){return Po(r)!==1},unsafeLadder(r,n,i=t.ZERO){let s=r;for(;n>Pr;)n&fr&&(i=i.add(s)),s=s.double(),n>>=fr;return i},precomputeWindow(r,n){const{windows:i,windowSize:s}=Ro(n,e),o=[];let a=r,c=a;for(let u=0;u<i;u++){c=a,o.push(c);for(let l=1;l<s;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,i){let s=t.ZERO,o=t.BASE;const a=Ro(r,e);for(let c=0;c<a.windows;c++){const{nextN:u,offset:l,isZero:f,isNeg:h,isNegF:g,offsetF:d}=Vf(i,c,a);i=u,f?o=o.add(bn(g,n[d])):s=s.add(bn(h,n[l]))}return qf(i),{p:s,f:o}},wNAFUnsafe(r,n,i,s=t.ZERO){const o=Ro(r,e);for(let a=0;a<o.windows&&i!==Pr;a++){const{nextN:c,offset:u,isZero:l,isNeg:f}=Vf(i,a,o);if(i=c,!l){const h=n[u];s=s.add(f?h.negate():h)}}return qf(i),s},getPrecomputes(r,n,i){let s=No.get(n);return s||(s=this.precomputeWindow(n,r),r!==1&&(typeof i=="function"&&(s=i(s)),No.set(n,s))),s},wNAFCached(r,n,i){const s=Po(r);return this.wNAF(s,this.getPrecomputes(s,r,i),n)},wNAFCachedUnsafe(r,n,i,s){const o=Po(r);return o===1?this.unsafeLadder(r,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,i),n,s)},setWindowSize(r,n){Hf(n,e),Kf.set(r,n),No.delete(r)}}}function Yv(t,e,r,n){let i=e,s=t.ZERO,o=t.ZERO;for(;r>Pr||n>Pr;)r&fr&&(s=s.add(i)),n&fr&&(o=o.add(i)),i=i.double(),r>>=fr,n>>=fr;return{p1:s,p2:o}}function Zv(t,e,r,n){qv(r,t),Wv(n,e);const i=r.length,s=n.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=Pv(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const u=Ii(c),l=new Array(Number(u)+1).fill(o),f=Math.floor((e.BITS-1)/c)*c;let h=o;for(let g=f;g>=0;g-=c){l.fill(o);for(let p=0;p<s;p++){const m=n[p],C=Number(m>>BigInt(g)&u);l[C]=l[C].add(r[p])}let d=o;for(let p=l.length-1,m=o;p>0;p--)m=m.add(l[p]),d=d.add(m);if(h=h.add(d),g!==0)for(let p=0;p<c;p++)h=h.double()}return h}function Wf(t,e){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return kv(e),e}else return Nr(t)}function Xv(t,e,r={}){if(!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const o of["p","n","h"]){const a=e[o];if(!(typeof a=="bigint"&&a>Pr))throw new Error(`CURVE.${o} must be positive bigint`)}const n=Wf(e.p,r.Fp),i=Wf(e.n,r.Fn),s=["Gx","Gy","a",t==="weierstrass"?"b":"d"];for(const o of s)if(!n.isValid(e[o]))throw new Error(`CURVE.${o} must be valid field element of CURVE.Fp`);return{Fp:n,Fn:i}}BigInt(0),BigInt(1),BigInt(2),BigInt(8);const wn=BigInt(0),$r=BigInt(1),Oi=BigInt(2);function Jv(t){return Si(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze(Tr({},t))}function Qv(t){const e=Jv(t),{P:r,type:n,adjustScalarBytes:i,powPminus2:s,randomBytes:o}=e,a=n==="x25519";if(!a&&n!=="x448")throw new Error("invalid type");const c=o||Cr,u=a?255:448,l=a?32:56,f=BigInt(a?9:5),h=BigInt(a?121665:39081),g=a?Oi**BigInt(254):Oi**BigInt(447),d=a?BigInt(8)*Oi**BigInt(251)-$r:BigInt(4)*Oi**BigInt(445)-$r,p=g+d+$r,m=w=>et(w,r),C=P(f);function P(w){return To(m(w),l)}function E(w){const T=Le("u coordinate",w,l);return a&&(T[31]&=127),m(Di(T))}function _(w){return Di(i(Le("scalar",w,l)))}function S(w,T){const x=R(E(T),_(w));if(x===wn)throw new Error("invalid private or public key received");return P(x)}function U(w){return S(w,C)}function $(w,T,x){const D=m(w*(T-x));return T=m(T-D),x=m(x+D),{x_2:T,x_3:x}}function R(w,T){Co("u",w,wn,r),Co("scalar",T,g,p);const x=T,D=w;let A=$r,L=wn,b=w,y=$r,v=wn;for(let I=BigInt(u-1);I>=wn;I--){const B=x>>I&$r;v^=B,{x_2:A,x_3:b}=$(v,A,b),{x_2:L,x_3:y}=$(v,L,y),v=B;const N=A+L,F=m(N*N),k=A-L,H=m(k*k),M=F-H,K=b+y,Y=b-y,Q=m(Y*N),W=m(K*k),ie=Q+W,me=Q-W;b=m(ie*ie),y=m(D*m(me*me)),A=m(F*H),L=m(M*(F+m(h*M)))}({x_2:A,x_3:b}=$(v,A,b)),{x_2:L,x_3:y}=$(v,L,y);const O=s(L);return m(A*O)}return{scalarMult:S,scalarMultBase:U,getSharedSecret:(w,T)=>S(w,T),getPublicKey:w=>U(w),utils:{randomPrivateKey:()=>c(l)},GuBytes:C.slice()}}BigInt(0);const e2=BigInt(1),Gf=BigInt(2),t2=BigInt(3),r2=BigInt(5),n2=BigInt(8),Yf={p:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:n2,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function i2(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),i=BigInt(80),s=Yf.p,o=t*t%s*t%s,a=ot(o,Gf,s)*o%s,c=ot(a,e2,s)*t%s,u=ot(c,r2,s)*c%s,l=ot(u,e,s)*u%s,f=ot(l,r,s)*l%s,h=ot(f,n,s)*f%s,g=ot(h,i,s)*h%s,d=ot(g,i,s)*h%s,p=ot(d,e,s)*u%s;return{pow_p_5_8:ot(p,Gf,s)*t%s,b2:o}}function s2(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const $o=(()=>{const t=Yf.p;return Qv({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:r,b2:n}=i2(e);return et(ot(r,t2,t)*n,t)},adjustScalarBytes:s2})})();function Zf(t){t.lowS!==void 0&&vi("lowS",t.lowS),t.prehash!==void 0&&vi("prehash",t.prehash)}class o2 extends Error{constructor(e=""){super(e)}}const Ot={Err:o2,_tlv:{encode:(t,e)=>{const{Err:r}=Ot;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,i=_i(n);if(i.length/2&128)throw new r("tlv.encode: long form length too big");const s=n>127?_i(i.length/2|128):"";return _i(t)+s+i+e},decode(t,e){const{Err:r}=Ot;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const i=e[n++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const u=e.subarray(n,n+c);if(u.length!==c)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const l of u)o=o<<8|l;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=Ot;if(t<mn)throw new e("integer: negative integers are not allowed");let r=_i(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=Ot;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return xi(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=Ot,i=Le("signature",t),{v:s,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,s),{v:u,l}=n.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(t){const{_tlv:e,_int:r}=Ot,n=e.encode(2,r.encode(t.r)),i=e.encode(2,r.encode(t.s)),s=n+i;return e.encode(48,s)}},mn=BigInt(0),En=BigInt(1),a2=BigInt(2),Ai=BigInt(3),c2=BigInt(4);function u2(t,e,r){function n(i){const s=t.sqr(i),o=t.mul(s,i);return t.add(t.add(o,t.mul(i,e)),r)}return n}function Xf(t,e,r){const{BYTES:n}=t;function i(s){let o;if(typeof s=="bigint")o=s;else{let a=Le("private key",s);if(e){if(!e.includes(a.length*2))throw new Error("invalid private key");const c=new Uint8Array(n);c.set(a,c.length-a.length),a=c}try{o=t.fromBytes(a)}catch{throw new Error(`invalid private key: expected ui8a of size ${n}, got ${typeof s}`)}}if(r&&(o=t.create(o)),!t.isValidNot0(o))throw new Error("invalid private key: out of range [1..N-1]");return o}return i}function l2(t,e={}){const{Fp:r,Fn:n}=Xv("weierstrass",t,e),{h:i,n:s}=t;Si(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:o}=e;if(o&&(!r.is0(t.a)||typeof o.beta!="bigint"||typeof o.splitScalar!="function"))throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function');function a(){if(!r.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function c(R,w,T){const{x,y:D}=w.toAffine(),A=r.toBytes(x);if(vi("isCompressed",T),T){a();const L=!r.isOdd(D);return ur(Jf(L),A)}else return ur(Uint8Array.of(4),A,r.toBytes(D))}function u(R){Je(R);const w=r.BYTES,T=w+1,x=2*w+1,D=R.length,A=R[0],L=R.subarray(1);if(D===T&&(A===2||A===3)){const b=r.fromBytes(L);if(!r.isValid(b))throw new Error("bad point: is not on curve, wrong x");const y=h(b);let v;try{v=r.sqrt(y)}catch(I){const B=I instanceof Error?": "+I.message:"";throw new Error("bad point: is not on curve, sqrt error"+B)}a();const O=r.isOdd(v);return(A&1)===1!==O&&(v=r.neg(v)),{x:b,y:v}}else if(D===x&&A===4){const b=r.fromBytes(L.subarray(w*0,w*1)),y=r.fromBytes(L.subarray(w*1,w*2));if(!g(b,y))throw new Error("bad point: is not on curve");return{x:b,y}}else throw new Error(`bad point: got length ${D}, expected compressed=${T} or uncompressed=${x}`)}const l=e.toBytes||c,f=e.fromBytes||u,h=u2(r,t.a,t.b);function g(R,w){const T=r.sqr(w),x=h(R);return r.eql(T,x)}if(!g(t.Gx,t.Gy))throw new Error("bad curve params: generator point");const d=r.mul(r.pow(t.a,Ai),c2),p=r.mul(r.sqr(t.b),BigInt(27));if(r.is0(r.add(d,p)))throw new Error("bad curve params: a or b");function m(R,w,T=!1){if(!r.isValid(w)||T&&r.is0(w))throw new Error(`bad point coordinate ${R}`);return w}function C(R){if(!(R instanceof S))throw new Error("ProjectivePoint expected")}const P=Nf((R,w)=>{const{px:T,py:x,pz:D}=R;if(r.eql(D,r.ONE))return{x:T,y:x};const A=R.is0();w==null&&(w=A?r.ONE:r.inv(D));const L=r.mul(T,w),b=r.mul(x,w),y=r.mul(D,w);if(A)return{x:r.ZERO,y:r.ZERO};if(!r.eql(y,r.ONE))throw new Error("invZ was invalid");return{x:L,y:b}}),E=Nf(R=>{if(R.is0()){if(e.allowInfinityPoint&&!r.is0(R.py))return;throw new Error("bad point: ZERO")}const{x:w,y:T}=R.toAffine();if(!r.isValid(w)||!r.isValid(T))throw new Error("bad point: x or y not field elements");if(!g(w,T))throw new Error("bad point: equation left != right");if(!R.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function _(R,w,T,x,D){return T=new S(r.mul(T.px,R),T.py,T.pz),w=bn(x,w),T=bn(D,T),w.add(T)}class S{constructor(w,T,x){this.px=m("x",w),this.py=m("y",T,!0),this.pz=m("z",x),Object.freeze(this)}static fromAffine(w){const{x:T,y:x}=w||{};if(!w||!r.isValid(T)||!r.isValid(x))throw new Error("invalid affine point");if(w instanceof S)throw new Error("projective point not allowed");return r.is0(T)&&r.is0(x)?S.ZERO:new S(T,x,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(w){return Kv(S,"pz",w)}static fromBytes(w){return Je(w),S.fromHex(w)}static fromHex(w){const T=S.fromAffine(f(Le("pointHex",w)));return T.assertValidity(),T}static fromPrivateKey(w){const T=Xf(n,e.allowedPrivateKeyLengths,e.wrapPrivateKey);return S.BASE.multiply(T(w))}static msm(w,T){return Zv(S,n,w,T)}precompute(w=8,T=!0){return $.setWindowSize(this,w),T||this.multiply(Ai),this}_setWindowSize(w){this.precompute(w)}assertValidity(){E(this)}hasEvenY(){const{y:w}=this.toAffine();if(!r.isOdd)throw new Error("Field doesn't support isOdd");return!r.isOdd(w)}equals(w){C(w);const{px:T,py:x,pz:D}=this,{px:A,py:L,pz:b}=w,y=r.eql(r.mul(T,b),r.mul(A,D)),v=r.eql(r.mul(x,b),r.mul(L,D));return y&&v}negate(){return new S(this.px,r.neg(this.py),this.pz)}double(){const{a:w,b:T}=t,x=r.mul(T,Ai),{px:D,py:A,pz:L}=this;let b=r.ZERO,y=r.ZERO,v=r.ZERO,O=r.mul(D,D),I=r.mul(A,A),B=r.mul(L,L),N=r.mul(D,A);return N=r.add(N,N),v=r.mul(D,L),v=r.add(v,v),b=r.mul(w,v),y=r.mul(x,B),y=r.add(b,y),b=r.sub(I,y),y=r.add(I,y),y=r.mul(b,y),b=r.mul(N,b),v=r.mul(x,v),B=r.mul(w,B),N=r.sub(O,B),N=r.mul(w,N),N=r.add(N,v),v=r.add(O,O),O=r.add(v,O),O=r.add(O,B),O=r.mul(O,N),y=r.add(y,O),B=r.mul(A,L),B=r.add(B,B),O=r.mul(B,N),b=r.sub(b,O),v=r.mul(B,I),v=r.add(v,v),v=r.add(v,v),new S(b,y,v)}add(w){C(w);const{px:T,py:x,pz:D}=this,{px:A,py:L,pz:b}=w;let y=r.ZERO,v=r.ZERO,O=r.ZERO;const I=t.a,B=r.mul(t.b,Ai);let N=r.mul(T,A),F=r.mul(x,L),k=r.mul(D,b),H=r.add(T,x),M=r.add(A,L);H=r.mul(H,M),M=r.add(N,F),H=r.sub(H,M),M=r.add(T,D);let K=r.add(A,b);return M=r.mul(M,K),K=r.add(N,k),M=r.sub(M,K),K=r.add(x,D),y=r.add(L,b),K=r.mul(K,y),y=r.add(F,k),K=r.sub(K,y),O=r.mul(I,M),y=r.mul(B,k),O=r.add(y,O),y=r.sub(F,O),O=r.add(F,O),v=r.mul(y,O),F=r.add(N,N),F=r.add(F,N),k=r.mul(I,k),M=r.mul(B,M),F=r.add(F,k),k=r.sub(N,k),k=r.mul(I,k),M=r.add(M,k),N=r.mul(F,M),v=r.add(v,N),N=r.mul(K,M),y=r.mul(H,y),y=r.sub(y,N),N=r.mul(H,F),O=r.mul(K,O),O=r.add(O,N),new S(y,v,O)}subtract(w){return this.add(w.negate())}is0(){return this.equals(S.ZERO)}multiply(w){const{endo:T}=e;if(!n.isValidNot0(w))throw new Error("invalid scalar: out of range");let x,D;const A=L=>$.wNAFCached(this,L,S.normalizeZ);if(T){const{k1neg:L,k1:b,k2neg:y,k2:v}=T.splitScalar(w),{p:O,f:I}=A(b),{p:B,f:N}=A(v);D=I.add(N),x=_(T.beta,O,B,L,y)}else{const{p:L,f:b}=A(w);x=L,D=b}return S.normalizeZ([x,D])[0]}multiplyUnsafe(w){const{endo:T}=e,x=this;if(!n.isValid(w))throw new Error("invalid scalar: out of range");if(w===mn||x.is0())return S.ZERO;if(w===En)return x;if($.hasPrecomputes(this))return this.multiply(w);if(T){const{k1neg:D,k1:A,k2neg:L,k2:b}=T.splitScalar(w),{p1:y,p2:v}=Yv(S,x,A,b);return _(T.beta,y,v,D,L)}else return $.wNAFCachedUnsafe(x,w)}multiplyAndAddUnsafe(w,T,x){const D=this.multiplyUnsafe(T).add(w.multiplyUnsafe(x));return D.is0()?void 0:D}toAffine(w){return P(this,w)}isTorsionFree(){const{isTorsionFree:w}=e;return i===En?!0:w?w(S,this):$.wNAFCachedUnsafe(this,s).is0()}clearCofactor(){const{clearCofactor:w}=e;return i===En?this:w?w(S,this):this.multiplyUnsafe(i)}toBytes(w=!0){return vi("isCompressed",w),this.assertValidity(),l(S,this,w)}toRawBytes(w=!0){return this.toBytes(w)}toHex(w=!0){return gn(this.toBytes(w))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}S.BASE=new S(t.Gx,t.Gy,r.ONE),S.ZERO=new S(r.ZERO,r.ONE,r.ZERO),S.Fp=r,S.Fn=n;const U=n.BITS,$=Gv(S,e.endo?Math.ceil(U/2):U);return S}function Jf(t){return Uint8Array.of(t?2:3)}function f2(t,e,r={}){Si(e,{hash:"function"},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const n=e.randomBytes||Cr,i=e.hmac||((x,...D)=>mi(e.hash,x,ur(...D))),{Fp:s,Fn:o}=t,{ORDER:a,BITS:c}=o;function u(x){const D=a>>En;return x>D}function l(x){return u(x)?o.neg(x):x}function f(x,D){if(!o.isValidNot0(D))throw new Error(`invalid signature ${x}: out of range 1..CURVE.n`)}class h{constructor(D,A,L){f("r",D),f("s",A),this.r=D,this.s=A,L!=null&&(this.recovery=L),Object.freeze(this)}static fromCompact(D){const A=o.BYTES,L=Le("compactSignature",D,A*2);return new h(o.fromBytes(L.subarray(0,A)),o.fromBytes(L.subarray(A,A*2)))}static fromDER(D){const{r:A,s:L}=Ot.toSig(Le("DER",D));return new h(A,L)}assertValidity(){}addRecoveryBit(D){return new h(this.r,this.s,D)}recoverPublicKey(D){const A=s.ORDER,{r:L,s:b,recovery:y}=this;if(y==null||![0,1,2,3].includes(y))throw new Error("recovery id invalid");if(a*a2<A&&y>1)throw new Error("recovery id is ambiguous for h>1 curve");const v=y===2||y===3?L+a:L;if(!s.isValid(v))throw new Error("recovery id 2 or 3 invalid");const O=s.toBytes(v),I=t.fromHex(ur(Jf((y&1)===0),O)),B=o.inv(v),N=E(Le("msgHash",D)),F=o.create(-N*B),k=o.create(b*B),H=t.BASE.multiplyUnsafe(F).add(I.multiplyUnsafe(k));if(H.is0())throw new Error("point at infinify");return H.assertValidity(),H}hasHighS(){return u(this.s)}normalizeS(){return this.hasHighS()?new h(this.r,o.neg(this.s),this.recovery):this}toBytes(D){if(D==="compact")return ur(o.toBytes(this.r),o.toBytes(this.s));if(D==="der")return bo(Ot.hexFromSig(this));throw new Error("invalid format")}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return gn(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return gn(this.toBytes("compact"))}}const g=Xf(o,r.allowedPrivateKeyLengths,r.wrapPrivateKey),d={isValidPrivateKey(x){try{return g(x),!0}catch{return!1}},normPrivateKeyToScalar:g,randomPrivateKey:()=>{const x=a;return Vv(n(Mf(x)),x)},precompute(x=8,D=t.BASE){return D.precompute(x,!1)}};function p(x,D=!0){return t.fromPrivateKey(x).toBytes(D)}function m(x){if(typeof x=="bigint")return!1;if(x instanceof t)return!0;const D=Le("key",x).length,A=s.BYTES,L=A+1,b=2*A+1;if(!(r.allowedPrivateKeyLengths||o.BYTES===L))return D===L||D===b}function C(x,D,A=!0){if(m(x)===!0)throw new Error("first arg must be private key");if(m(D)===!1)throw new Error("second arg must be public key");return t.fromHex(D).multiply(g(x)).toBytes(A)}const P=e.bits2int||function(x){if(x.length>8192)throw new Error("input is too large");const D=xi(x),A=x.length*8-c;return A>0?D>>BigInt(A):D},E=e.bits2int_modN||function(x){return o.create(P(x))},_=Ii(c);function S(x){return Co("num < 2^"+c,x,mn,_),o.toBytes(x)}function U(x,D,A=$){if(["recovered","canonical"].some(H=>H in A))throw new Error("sign() legacy options not supported");const{hash:L}=e;let{lowS:b,prehash:y,extraEntropy:v}=A;b==null&&(b=!0),x=Le("msgHash",x),Zf(A),y&&(x=Le("prehashed msgHash",L(x)));const O=E(x),I=g(D),B=[S(I),S(O)];if(v!=null&&v!==!1){const H=v===!0?n(s.BYTES):v;B.push(Le("extraEntropy",H))}const N=ur(...B),F=O;function k(H){const M=P(H);if(!o.isValidNot0(M))return;const K=o.inv(M),Y=t.BASE.multiply(M).toAffine(),Q=o.create(Y.x);if(Q===mn)return;const W=o.create(K*o.create(F+Q*I));if(W===mn)return;let ie=(Y.x===Q?0:2)|Number(Y.y&En),me=W;return b&&u(W)&&(me=l(W),ie^=1),new h(Q,me,ie)}return{seed:N,k2sig:k}}const $={lowS:e.lowS,prehash:!1},R={lowS:e.lowS,prehash:!1};function w(x,D,A=$){const{seed:L,k2sig:b}=U(x,D,A);return $v(e.hash.outputLen,o.BYTES,i)(L,b)}t.BASE.precompute(8);function T(x,D,A,L=R){const b=x;D=Le("msgHash",D),A=Le("publicKey",A),Zf(L);const{lowS:y,prehash:v,format:O}=L;if("strict"in L)throw new Error("options.strict was renamed to lowS");if(O!==void 0&&!["compact","der","js"].includes(O))throw new Error('format must be "compact", "der" or "js"');const I=typeof b=="string"||ho(b),B=!I&&!O&&typeof b=="object"&&b!==null&&typeof b.r=="bigint"&&typeof b.s=="bigint";if(!I&&!B)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let N,F;try{if(B)if(O===void 0||O==="js")N=new h(b.r,b.s);else throw new Error("invalid format");if(I){try{O!=="compact"&&(N=h.fromDER(b))}catch(ie){if(!(ie instanceof Ot.Err))throw ie}!N&&O!=="der"&&(N=h.fromCompact(b))}F=t.fromHex(A)}catch{return!1}if(!N||y&&N.hasHighS())return!1;v&&(D=e.hash(D));const{r:k,s:H}=N,M=E(D),K=o.inv(H),Y=o.create(M*K),Q=o.create(k*K),W=t.BASE.multiplyUnsafe(Y).add(F.multiplyUnsafe(Q));return W.is0()?!1:o.create(W.x)===k}return Object.freeze({getPublicKey:p,getSharedSecret:C,sign:w,verify:T,utils:d,Point:t,Signature:h})}function h2(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp,n=Nr(e.n,t.nBitLength),i={Fp:r,Fn:n,allowedPrivateKeyLengths:t.allowedPrivateKeyLengths,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,wrapPrivateKey:t.wrapPrivateKey,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:i}}function d2(t){const{CURVE:e,curveOpts:r}=h2(t),n={hash:t.hash,hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:r,ecdsaOpts:n}}function g2(t,e){return Object.assign({},e,{ProjectivePoint:e.Point,CURVE:t})}function p2(t){const{CURVE:e,curveOpts:r,ecdsaOpts:n}=d2(t),i=l2(e,r),s=f2(i,n,r);return g2(t,s)}function Lo(t,e){const r=n=>p2(cn(Tr({},t),{hash:n}));return cn(Tr({},r(e)),{create:r})}const Qf={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},eh={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},th={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},y2=Nr(Qf.p),b2=Nr(eh.p),w2=Nr(th.p),m2=Lo(cn(Tr({},Qf),{Fp:y2,lowS:!1}),mf);Lo(cn(Tr({},eh),{Fp:b2,lowS:!1}),tv),Lo(cn(Tr({},th),{Fp:w2,lowS:!1,allowedPrivateKeyLengths:[130,131,132]}),ev);const E2=m2,rh="base10",Oe="base16",hr="base64pad",Uo="base64url",vn="utf8",nh=0,Lr=1,Ti=2,v2=0,ih=1,_n=12,Fo=32;function _2(){const t=$o.utils.randomPrivateKey(),e=$o.getPublicKey(t);return{privateKey:Pe(t,Oe),publicKey:Pe(e,Oe)}}function jo(){const t=Cr(Fo);return Pe(t,Oe)}function x2(t,e){const r=$o.getSharedSecret(ke(t,Oe),ke(e,Oe)),n=Rv(Ei,r,void 0,void 0,Fo);return Pe(n,Oe)}function D2(t){const e=Ei(ke(t,Oe));return Pe(e,Oe)}function Bi(t){const e=Ei(ke(t,vn));return Pe(e,Oe)}function sh(t){return ke(`${t}`,rh)}function dr(t){return Number(Pe(t,rh))}function oh(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function ah(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4;return e+"=".repeat(r)}function I2(t){const e=sh(typeof t.type<"u"?t.type:nh);if(dr(e)===Lr&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?ke(t.senderPublicKey,Oe):void 0,n=typeof t.iv<"u"?ke(t.iv,Oe):Cr(_n),i=ke(t.symKey,Oe),s=Tf(i,n).encrypt(ke(t.message,vn)),o=ch({type:e,sealed:s,iv:n,senderPublicKey:r});return t.encoding===Uo?oh(o):o}function S2(t){const e=ke(t.symKey,Oe),{sealed:r,iv:n}=xn({encoded:t.encoded,encoding:t.encoding}),i=Tf(e,n).decrypt(r);if(i===null)throw new Error("Failed to decrypt");return Pe(i,vn)}function O2(t,e){const r=sh(Ti),n=Cr(_n),i=ke(t,vn),s=ch({type:r,sealed:i,iv:n});return e===Uo?oh(s):s}function A2(t,e){const{sealed:r}=xn({encoded:t,encoding:e});return Pe(r,vn)}function ch(t){if(dr(t.type)===Ti)return Pe(an([t.type,t.sealed]),hr);if(dr(t.type)===Lr){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Pe(an([t.type,t.senderPublicKey,t.iv,t.sealed]),hr)}return Pe(an([t.type,t.iv,t.sealed]),hr)}function xn(t){const e=(t.encoding||hr)===Uo?ah(t.encoded):t.encoded,r=ke(e,hr),n=r.slice(v2,ih),i=ih;if(dr(n)===Lr){const c=i+Fo,u=c+_n,l=r.slice(i,c),f=r.slice(c,u),h=r.slice(u);return{type:n,sealed:h,iv:f,senderPublicKey:l}}if(dr(n)===Ti){const c=r.slice(i),u=Cr(_n);return{type:n,sealed:c,iv:u}}const s=i+_n,o=r.slice(i,s),a=r.slice(s);return{type:n,sealed:a,iv:o}}function T2(t,e){const r=xn({encoded:t,encoding:e?.encoding});return uh({type:dr(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?Pe(r.senderPublicKey,Oe):void 0,receiverPublicKey:e?.receiverPublicKey})}function uh(t){const e=t?.type||nh;if(e===Lr){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function lh(t){return t.type===Lr&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function fh(t){return t.type===Ti}function B2(t){const e=Buffer.from(t.x,"base64"),r=Buffer.from(t.y,"base64");return an([new Uint8Array([4]),e,r])}function C2(t,e){const[r,n,i]=t.split("."),s=Buffer.from(ah(i),"base64");if(s.length!==64)throw new Error("Invalid signature length");const o=s.slice(0,32),a=s.slice(32,64),c=`${r}.${n}`,u=Ei(c),l=B2(e);if(!E2.verify(an([o,a]),u,l))throw new Error("Invalid signature");return xs(t).payload}const R2="irn";function Ci(t){return t?.relay||{protocol:R2}}function Dn(t){const e=nE[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}function N2(t,e="-"){const r={},n="relay"+e;return Object.keys(t).forEach(i=>{if(i.startsWith(n)){const s=i.replace(n,""),o=t[i];r[s]=o}}),r}function hh(t){if(!t.includes("wc:")){const u=ef(t);u!=null&&u.includes("wc:")&&(t=u)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,n=t.substring(0,e),i=t.substring(e+1,r).split("@"),s=typeof r<"u"?t.substring(r):"",o=new URLSearchParams(s),a={};o.forEach((u,l)=>{a[l]=u});const c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:n,topic:P2(i[0]),version:parseInt(i[1],10),symKey:a.symKey,relay:N2(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function P2(t){return t.startsWith("//")?t.substring(2):t}function $2(t,e="-"){const r="relay",n={};return Object.keys(t).forEach(i=>{const s=i,o=r+e+s;t[s]&&(n[o]=t[s])}),n}function dh(t){const e=new URLSearchParams,r=$2(t.relay);Object.keys(r).sort().forEach(i=>{e.set(i,r[i])}),e.set("symKey",t.symKey),t.expiryTimestamp&&e.set("expiryTimestamp",t.expiryTimestamp.toString()),t.methods&&e.set("methods",t.methods.join(","));const n=e.toString();return`${t.protocol}:${t.topic}@${t.version}?${n}`}const L2={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},U2={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function J(t,e){const{message:r,code:n}=U2[t];return{message:e?`${r} ${e}`:r,code:n}}function In(t,e){const{message:r,code:n}=L2[t];return{message:e?`${r} ${e}`:r,code:n}}function Ri(t){return typeof t>"u"}function gh(t,e){return e&&Ri(t)?!0:typeof t=="string"&&!!t.trim().length}function F2(t){function e(r){try{return typeof new URL(r)<"u"}catch{return!1}}try{if(gh(t,!1)){if(e(t))return!0;const r=ef(t);return e(r)}}catch{}return!1}function j2(t){var e;return(e=t?.proposer)==null?void 0:e.publicKey}function z2(t){return t?.topic}function zo(t){return typeof t<"u"&&typeof t!==null}function ph(){const t=pi();return new Promise(e=>{switch(t){case nt.browser:e(k2());break;case nt.reactNative:e(M2());break;case nt.node:e(H2());break;default:e(!0)}})}function k2(){return un()&&navigator?.onLine}async function M2(){if(cr()&&typeof global<"u"&&global!=null&&global.NetInfo){const t=await(global==null?void 0:global.NetInfo.fetch());return t?.isConnected}return!0}function H2(){return!0}function V2(t){switch(pi()){case nt.browser:K2(t);break;case nt.reactNative:q2(t);break}}function K2(t){!cr()&&un()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function q2(t){cr()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(e=>t(e?.isConnected))}function W2(){var t;return un()&&Dr()?((t=Dr())==null?void 0:t.visibilityState)==="visible":!0}var G2=Object.defineProperty,Y2=(t,e,r)=>e in t?G2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,gt=(t,e,r)=>Y2(t,typeof e!="symbol"?e+"":e,r);class yh{constructor(e,r){this.core=e,this.logger=r,gt(this,"keychain",new Map),gt(this,"name",qa),gt(this,"version",Wa),gt(this,"initialized",!1),gt(this,"storagePrefix",tt),gt(this,"init",async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}}),gt(this,"has",n=>(this.isInitialized(),this.keychain.has(n))),gt(this,"set",async(n,i)=>{this.isInitialized(),this.keychain.set(n,i),await this.persist()}),gt(this,"get",n=>{this.isInitialized();const i=this.keychain.get(n);if(typeof i>"u"){const{message:s}=J("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(s)}return i}),gt(this,"del",async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()}),this.core=e,this.logger=Te(r,this.name)}get context(){return je(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,ao(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?co(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Z2=Object.defineProperty,X2=(t,e,r)=>e in t?Z2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,be=(t,e,r)=>X2(t,typeof e!="symbol"?e+"":e,r);class bh{constructor(e,r,n){this.core=e,this.logger=r,be(this,"name",Va),be(this,"keychain"),be(this,"randomSessionIdentifier",jo()),be(this,"initialized",!1),be(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),be(this,"hasKeys",i=>(this.isInitialized(),this.keychain.has(i))),be(this,"getClientId",async()=>{this.isInitialized();const i=await this.getClientSeed(),s=pu(i);return gu(s.publicKey)}),be(this,"generateKeyPair",()=>{this.isInitialized();const i=_2();return this.setPrivateKey(i.publicKey,i.privateKey)}),be(this,"signJWT",async i=>{this.isInitialized();const s=await this.getClientSeed(),o=pu(s),a=this.randomSessionIdentifier;return await mb(a,i,Ka,o)}),be(this,"generateSharedKey",(i,s,o)=>{this.isInitialized();const a=this.getPrivateKey(i),c=x2(a,s);return this.setSymKey(c,o)}),be(this,"setSymKey",async(i,s)=>{this.isInitialized();const o=s||D2(i);return await this.keychain.set(o,i),o}),be(this,"deleteKeyPair",async i=>{this.isInitialized(),await this.keychain.del(i)}),be(this,"deleteSymKey",async i=>{this.isInitialized(),await this.keychain.del(i)}),be(this,"encode",async(i,s,o)=>{this.isInitialized();const a=uh(o),c=tr(s);if(fh(a))return O2(c,o?.encoding);if(lh(a)){const h=a.senderPublicKey,g=a.receiverPublicKey;i=await this.generateSharedKey(h,g)}const u=this.getSymKey(i),{type:l,senderPublicKey:f}=a;return I2({type:l,symKey:u,message:c,senderPublicKey:f,encoding:o?.encoding})}),be(this,"decode",async(i,s,o)=>{this.isInitialized();const a=T2(s,o);if(fh(a)){const c=A2(s,o?.encoding);return yr(c)}if(lh(a)){const c=a.receiverPublicKey,u=a.senderPublicKey;i=await this.generateSharedKey(c,u)}try{const c=this.getSymKey(i),u=S2({symKey:c,encoded:s,encoding:o?.encoding});return yr(u)}catch(c){this.logger.error(`Failed to decode message from topic: '${i}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),be(this,"getPayloadType",(i,s=hr)=>{const o=xn({encoded:i,encoding:s});return dr(o.type)}),be(this,"getPayloadSenderPublicKey",(i,s=hr)=>{const o=xn({encoded:i,encoding:s});return o.senderPublicKey?Pe(o.senderPublicKey,Oe):void 0}),this.core=e,this.logger=Te(r,this.name),this.keychain=n||new yh(this.core,this.logger)}get context(){return je(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Qi)}catch{e=jo(),await this.keychain.set(Qi,e)}return ke(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}var J2=Object.defineProperty,Q2=Object.defineProperties,e_=Object.getOwnPropertyDescriptors,wh=Object.getOwnPropertySymbols,t_=Object.prototype.hasOwnProperty,r_=Object.prototype.propertyIsEnumerable,ko=(t,e,r)=>e in t?J2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,n_=(t,e)=>{for(var r in e||(e={}))t_.call(e,r)&&ko(t,r,e[r]);if(wh)for(var r of wh(e))r_.call(e,r)&&ko(t,r,e[r]);return t},i_=(t,e)=>Q2(t,e_(e)),Ke=(t,e,r)=>ko(t,typeof e!="symbol"?e+"":e,r);class mh extends lp{constructor(e,r){super(e,r),this.logger=e,this.core=r,Ke(this,"messages",new Map),Ke(this,"messagesWithoutClientAck",new Map),Ke(this,"name",Ga),Ke(this,"version",Ya),Ke(this,"initialized",!1),Ke(this,"storagePrefix",tt),Ke(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n);const i=await this.getRelayerMessagesWithoutClientAck();typeof i<"u"&&(this.messagesWithoutClientAck=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}}),Ke(this,"set",async(n,i,s)=>{this.isInitialized();const o=Bi(i);let a=this.messages.get(n);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=i,this.messages.set(n,a),s===qr.inbound){const c=this.messagesWithoutClientAck.get(n)||{};this.messagesWithoutClientAck.set(n,i_(n_({},c),{[o]:i}))}return await this.persist(),o}),Ke(this,"get",n=>{this.isInitialized();let i=this.messages.get(n);return typeof i>"u"&&(i={}),i}),Ke(this,"getWithoutAck",n=>{this.isInitialized();const i={};for(const s of n){const o=this.messagesWithoutClientAck.get(s)||{};i[s]=Object.values(o)}return i}),Ke(this,"has",(n,i)=>{this.isInitialized();const s=this.get(n),o=Bi(i);return typeof s[o]<"u"}),Ke(this,"ack",async(n,i)=>{this.isInitialized();const s=this.messagesWithoutClientAck.get(n);if(typeof s>"u")return;const o=Bi(i);delete s[o],Object.keys(s).length===0?this.messagesWithoutClientAck.delete(n):this.messagesWithoutClientAck.set(n,s),await this.persist()}),Ke(this,"del",async n=>{this.isInitialized(),this.messages.delete(n),this.messagesWithoutClientAck.delete(n),await this.persist()}),this.logger=Te(e,this.name),this.core=r}get context(){return je(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,ao(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,ao(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?co(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?co(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}const s_="PARSE_ERROR",o_="INVALID_REQUEST",a_="METHOD_NOT_FOUND",c_="INVALID_PARAMS",Eh="INTERNAL_ERROR",Mo="SERVER_ERROR",u_=[-32700,-32600,-32601,-32602,-32603],Sn={[s_]:{code:-32700,message:"Parse error"},[o_]:{code:-32600,message:"Invalid Request"},[a_]:{code:-32601,message:"Method not found"},[c_]:{code:-32602,message:"Invalid params"},[Eh]:{code:-32603,message:"Internal error"},[Mo]:{code:-32e3,message:"Server error"}},vh=Mo;function l_(t){return u_.includes(t)}function _h(t){return Object.keys(Sn).includes(t)?Sn[t]:Sn[vh]}function f_(t){const e=Object.values(Sn).find(r=>r.code===t);return e||Sn[vh]}function h_(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var xh={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var Ho=function(t,e){return Ho=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},Ho(t,e)};function d_(t,e){Ho(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Vo=function(){return Vo=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Vo.apply(this,arguments)};function g_(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r}function p_(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s}function y_(t,e){return function(r,n){e(r,n,t)}}function b_(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function w_(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(f){o(f)}}function c(l){try{u(n.throw(l))}catch(f){o(f)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(t,e||[])).next())})}function m_(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){r.label=u[1];break}if(u[0]===6&&r.label<s[1]){r.label=s[1],s=u;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(u);break}s[2]&&r.ops.pop(),r.trys.pop();continue}u=e.call(t,r)}catch(l){u=[6,l],i=0}finally{n=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function E_(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}function v_(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Ko(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Dh(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return s}function __(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Dh(arguments[e]));return t}function x_(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),i=0,e=0;e<r;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)n[i]=s[o];return n}function On(t){return this instanceof On?(this.v=t,this):new On(t)}function D_(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(h){n[h]&&(i[h]=function(g){return new Promise(function(d,p){s.push([h,g,d,p])>1||a(h,g)})})}function a(h,g){try{c(n[h](g))}catch(d){f(s[0][3],d)}}function c(h){h.value instanceof On?Promise.resolve(h.value.v).then(u,l):f(s[0][2],h)}function u(h){a("next",h)}function l(h){a("throw",h)}function f(h,g){h(g),s.shift(),s.length&&a(s[0][0],s[0][1])}}function I_(t){var e,r;return e={},n("next"),n("throw",function(i){throw i}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(i,s){e[i]=t[i]?function(o){return(r=!r)?{value:On(t[i](o)),done:i==="return"}:s?s(o):o}:s}}function S_(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Ko=="function"?Ko(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(s){r[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function O_(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function A_(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function T_(t){return t&&t.__esModule?t:{default:t}}function B_(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function C_(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var R_=Object.freeze({__proto__:null,__extends:d_,get __assign(){return Vo},__rest:g_,__decorate:p_,__param:y_,__metadata:b_,__awaiter:w_,__generator:m_,__createBinding:E_,__exportStar:v_,__values:Ko,__read:Dh,__spread:__,__spreadArrays:x_,__await:On,__asyncGenerator:D_,__asyncDelegator:I_,__asyncValues:S_,__makeTemplateObject:O_,__importStar:A_,__importDefault:T_,__classPrivateFieldGet:B_,__classPrivateFieldSet:C_}),N_=sa(R_),At={},Ih;function P_(){if(Ih)return At;Ih=1,Object.defineProperty(At,"__esModule",{value:!0}),At.isBrowserCryptoAvailable=At.getSubtleCrypto=At.getBrowerCrypto=void 0;function t(){return ct?.crypto||ct?.msCrypto||{}}At.getBrowerCrypto=t;function e(){const n=t();return n.subtle||n.webkitSubtle}At.getSubtleCrypto=e;function r(){return!!t()&&!!e()}return At.isBrowserCryptoAvailable=r,At}var Tt={},Sh;function $_(){if(Sh)return Tt;Sh=1,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.isBrowser=Tt.isNode=Tt.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}Tt.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}Tt.isNode=e;function r(){return!t()&&!e()}return Tt.isBrowser=r,Tt}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=N_;e.__exportStar(P_(),t),e.__exportStar($_(),t)})(xh);function Oh(t=3){const e=Date.now()*Math.pow(10,t),r=Math.floor(Math.random()*Math.pow(10,t));return e+r}function qo(t=6){return BigInt(Oh(t))}function Wo(t,e,r){return{id:r||Oh(),jsonrpc:"2.0",method:t,params:e}}function Ah(t,e){return{id:t,jsonrpc:"2.0",result:e}}function Th(t,e,r){return{id:t,jsonrpc:"2.0",error:L_(e,r)}}function L_(t,e){return typeof t>"u"?_h(Eh):(typeof t=="string"&&(t=Object.assign(Object.assign({},_h(Mo)),{message:t})),typeof e<"u"&&(t.data=e),l_(t.code)&&(t=f_(t.code)),t)}class U_{}class F_ extends U_{constructor(){super()}}class j_ extends F_{constructor(e){super()}}const z_="^wss?:";function k_(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function M_(t,e){const r=k_(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function Bh(t){return M_(t,z_)}function H_(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function Ch(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function Rh(t){return Ch(t)&&"method"in t}function Go(t){return Ch(t)&&(Nh(t)||Ni(t))}function Nh(t){return"result"in t}function Ni(t){return"error"in t}class V_ extends j_{constructor(e){super(e),this.events=new qe.exports.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(Wo(e.method,e.params||[],e.id||qo().toString()),r)}async requestStrict(e,r){return new Promise(async(n,i)=>{if(!this.connection.connected)try{await this.open()}catch(s){i(s)}this.events.on(`${e.id}`,s=>{Ni(s)?i(s.error):n(s.result)});try{await this.connection.send(e,r)}catch(s){i(s)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Go(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const K_=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),q_=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Ph=t=>t.split("?")[0],$h=10,W_=K_();class G_{constructor(e){if(this.url=e,this.events=new qe.exports.EventEmitter,this.registering=!1,!Bh(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(tr(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!Bh(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,i)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),i(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return i(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,n)=>{const i=xh.isReactNative()?void 0:{rejectUnauthorized:!H_(e)},s=new W_(e,[],i);q_()?s.onerror=o=>{const a=o;n(this.emitError(a.error))}:s.on("error",o=>{n(this.emitError(o))}),s.onopen=()=>{this.onOpen(s),r(s)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?yr(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const n=this.parseError(r),i=n.message||n.toString(),s=Th(e,i);this.events.emit("payload",s)}parseError(e,r=this.url){return h_(e,Ph(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>$h&&this.events.setMaxListeners($h)}emitError(e){const r=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${Ph(this.url)}`));return this.events.emit("register_error",r),r}}var Y_=Object.defineProperty,Z_=Object.defineProperties,X_=Object.getOwnPropertyDescriptors,Lh=Object.getOwnPropertySymbols,J_=Object.prototype.hasOwnProperty,Q_=Object.prototype.propertyIsEnumerable,Yo=(t,e,r)=>e in t?Y_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Pi=(t,e)=>{for(var r in e||(e={}))J_.call(e,r)&&Yo(t,r,e[r]);if(Lh)for(var r of Lh(e))Q_.call(e,r)&&Yo(t,r,e[r]);return t},Zo=(t,e)=>Z_(t,X_(e)),at=(t,e,r)=>Yo(t,typeof e!="symbol"?e+"":e,r);class e3 extends fp{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,at(this,"events",new qe.exports.EventEmitter),at(this,"name",Za),at(this,"queue",new Map),at(this,"publishTimeout",V.toMiliseconds(V.ONE_MINUTE)),at(this,"initialPublishTimeout",V.toMiliseconds(V.ONE_SECOND*15)),at(this,"needsTransportRestart",!1),at(this,"publish",async(n,i,s)=>{var o;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:i,opts:s}});const a=s?.ttl||es,c=Ci(s),u=s?.prompt||!1,l=s?.tag||0,f=s?.id||qo().toString(),h={topic:n,message:i,opts:{ttl:a,relay:c,prompt:u,tag:l,id:f,attestation:s?.attestation,tvf:s?.tvf}},g=`Failed to publish payload, please try again. id:${f} tag:${l}`;try{const d=new Promise(async p=>{const m=({id:P})=>{h.opts.id===P&&(this.removeRequestFromQueue(P),this.relayer.events.removeListener(de.publish,m),p(h))};this.relayer.events.on(de.publish,m);const C=Lt(new Promise((P,E)=>{this.rpcPublish({topic:n,message:i,ttl:a,prompt:u,tag:l,id:f,attestation:s?.attestation,tvf:s?.tvf}).then(P).catch(_=>{this.logger.warn(_,_?.message),E(_)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${f} tag:${l}`);try{await C,this.events.removeListener(de.publish,m)}catch(P){this.queue.set(f,Zo(Pi({},h),{attempt:1})),this.logger.warn(P,P?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:f,topic:n,message:i,opts:s}}),await Lt(d,this.publishTimeout,g)}catch(d){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(d),(o=s?.internal)!=null&&o.throwOnFailedPublish)throw d}finally{this.queue.delete(f)}}),at(this,"on",(n,i)=>{this.events.on(n,i)}),at(this,"once",(n,i)=>{this.events.once(n,i)}),at(this,"off",(n,i)=>{this.events.off(n,i)}),at(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),this.relayer=e,this.logger=Te(r,this.name),this.registerEventListeners()}get context(){return je(this.logger)}async rpcPublish(e){var r,n,i,s;const{topic:o,message:a,ttl:c=es,prompt:u,tag:l,id:f,attestation:h,tvf:g}=e,d={method:Dn(Ci().protocol).publish,params:Pi({topic:o,message:a,ttl:c,prompt:u,tag:l,attestation:h},g),id:f};Ri((r=d.params)==null?void 0:r.prompt)&&((n=d.params)==null||delete n.prompt),Ri((i=d.params)==null?void 0:i.tag)&&((s=d.params)==null||delete s.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:d});const p=await this.relayer.request(d);return this.relayer.events.emit(de.publish,e),this.logger.debug("Successfully Published Payload"),p}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,r)=>{const n=e.attempt+1;this.queue.set(r,Zo(Pi({},e),{attempt:n}));const{topic:i,message:s,opts:o,attestation:a}=e;this.logger.warn({},`Publisher: queue->publishing: ${e.opts.id}, tag: ${e.opts.tag}, attempt: ${n}`),await this.rpcPublish(Zo(Pi({},e),{topic:i,message:s,ttl:o.ttl,prompt:o.prompt,tag:o.tag,id:o.id,attestation:a,tvf:o.tvf})),this.logger.warn({},`Publisher: queue->published: ${e.opts.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(Qt.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(de.connection_stalled);return}this.checkQueue()}),this.relayer.on(de.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var t3=Object.defineProperty,r3=(t,e,r)=>e in t?t3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ur=(t,e,r)=>r3(t,typeof e!="symbol"?e+"":e,r);class n3{constructor(){Ur(this,"map",new Map),Ur(this,"set",(e,r)=>{const n=this.get(e);this.exists(e,r)||this.map.set(e,[...n,r])}),Ur(this,"get",e=>this.map.get(e)||[]),Ur(this,"exists",(e,r)=>this.get(e).includes(r)),Ur(this,"delete",(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const n=this.get(e);if(!this.exists(e,r))return;const i=n.filter(s=>s!==r);if(!i.length){this.map.delete(e);return}this.map.set(e,i)}),Ur(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var i3=Object.defineProperty,s3=Object.defineProperties,o3=Object.getOwnPropertyDescriptors,Uh=Object.getOwnPropertySymbols,a3=Object.prototype.hasOwnProperty,c3=Object.prototype.propertyIsEnumerable,Xo=(t,e,r)=>e in t?i3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,An=(t,e)=>{for(var r in e||(e={}))a3.call(e,r)&&Xo(t,r,e[r]);if(Uh)for(var r of Uh(e))c3.call(e,r)&&Xo(t,r,e[r]);return t},Jo=(t,e)=>s3(t,o3(e)),te=(t,e,r)=>Xo(t,typeof e!="symbol"?e+"":e,r);class Fh extends gp{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,te(this,"subscriptions",new Map),te(this,"topicMap",new n3),te(this,"events",new qe.exports.EventEmitter),te(this,"name",ic),te(this,"version",sc),te(this,"pending",new Map),te(this,"cached",[]),te(this,"initialized",!1),te(this,"storagePrefix",tt),te(this,"subscribeTimeout",V.toMiliseconds(V.ONE_MINUTE)),te(this,"initialSubscribeTimeout",V.toMiliseconds(V.ONE_SECOND*15)),te(this,"clientId"),te(this,"batchSubscribeTopicsLimit",500),te(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),te(this,"subscribe",async(n,i)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:i}});try{const s=Ci(i),o={topic:n,relay:s,transportType:i?.transportType};this.pending.set(n,o);const a=await this.rpcSubscribe(n,s,i);return typeof a=="string"&&(this.onSubscribe(a,o),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:i}})),a}catch(s){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(s),s}}),te(this,"unsubscribe",async(n,i)=>{this.isInitialized(),typeof i?.id<"u"?await this.unsubscribeById(n,i.id,i):await this.unsubscribeByTopic(n,i)}),te(this,"isSubscribed",n=>new Promise(i=>{i(this.topicMap.topics.includes(n))})),te(this,"isKnownTopic",n=>new Promise(i=>{i(this.topicMap.topics.includes(n)||this.pending.has(n)||this.cached.some(s=>s.topic===n))})),te(this,"on",(n,i)=>{this.events.on(n,i)}),te(this,"once",(n,i)=>{this.events.once(n,i)}),te(this,"off",(n,i)=>{this.events.off(n,i)}),te(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),te(this,"start",async()=>{await this.onConnect()}),te(this,"stop",async()=>{await this.onDisconnect()}),te(this,"restart",async()=>{await this.restore(),await this.onRestart()}),te(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const n=[];this.pending.forEach(i=>{n.push(i)}),await this.batchSubscribe(n)}),te(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Qt.pulse,async()=>{await this.checkPending()}),this.events.on(Be.created,async n=>{const i=Be.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:n}),await this.persist()}),this.events.on(Be.deleted,async n=>{const i=Be.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:n}),await this.persist()})}),this.relayer=e,this.logger=Te(r,this.name),this.clientId=""}get context(){return je(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,r){let n=!1;try{n=this.getSubscription(e).topic===r}catch{}return n}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const n=this.topicMap.get(e);await Promise.all(n.map(async i=>await this.unsubscribeById(e,i,r)))}async unsubscribeById(e,r,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:n}});try{const i=Ci(n);await this.restartToComplete({topic:e,id:r,relay:i}),await this.rpcUnsubscribe(e,r,i);const s=In("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:n}})}catch(i){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(i),i}}async rpcSubscribe(e,r,n){var i;(!n||n?.transportType===rr.relay)&&await this.restartToComplete({topic:e,id:e,relay:r});const s={method:Dn(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});const o=(i=n?.internal)==null?void 0:i.throwOnFailedPublish;try{const a=await this.getSubscriptionId(e);if(n?.transportType===rr.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(s).catch(l=>this.logger.warn(l))},V.toMiliseconds(V.ONE_SECOND)),a;const c=new Promise(async l=>{const f=h=>{h.topic===e&&(this.events.removeListener(Be.created,f),l(h.id))};this.events.on(Be.created,f);try{const h=await Lt(new Promise((g,d)=>{this.relayer.request(s).catch(p=>{this.logger.warn(p,p?.message),d(p)}).then(g)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(Be.created,f),l(h)}catch{}}),u=await Lt(c,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!u&&o)throw new Error(`Subscribing to ${e} failed, please try again`);return u?a:null}catch(a){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(de.connection_stalled),o)throw a}return null}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,n={method:Dn(r.protocol).batchSubscribe,params:{topics:e.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await Lt(new Promise(i=>{this.relayer.request(n).catch(s=>this.logger.warn(s)).then(i)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(de.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const r=e[0].relay,n={method:Dn(r.protocol).batchFetchMessages,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});let i;try{i=await await Lt(new Promise((s,o)=>{this.relayer.request(n).catch(a=>{this.logger.warn(a),o(a)}).then(s)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(de.connection_stalled)}return i}rpcUnsubscribe(e,r,n){const i={method:Dn(n.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),this.relayer.request(i)}onSubscribe(e,r){this.setSubscription(e,Jo(An({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,An({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,n){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,n),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r)}addSubscription(e,r){this.subscriptions.set(e,An({},r)),this.topicMap.set(r.topic,e),this.events.emit(Be.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:n}=J("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const n=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(n.topic,e),this.events.emit(Be.deleted,Jo(An({},n),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Be.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let n=0;n<r;n++){const i=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit(Be.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:r}=J("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async r=>Jo(An({},r),{id:await this.getSubscriptionId(r.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const r=await this.rpcBatchFetchMessages(e);r&&r.messages&&(await _E(V.toMiliseconds(V.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(r.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return Bi(e+await this.getClientId())}}var u3=Object.defineProperty,jh=Object.getOwnPropertySymbols,l3=Object.prototype.hasOwnProperty,f3=Object.prototype.propertyIsEnumerable,Qo=(t,e,r)=>e in t?u3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,zh=(t,e)=>{for(var r in e||(e={}))l3.call(e,r)&&Qo(t,r,e[r]);if(jh)for(var r of jh(e))f3.call(e,r)&&Qo(t,r,e[r]);return t},X=(t,e,r)=>Qo(t,typeof e!="symbol"?e+"":e,r);class kh extends hp{constructor(e){super(e),X(this,"protocol","wc"),X(this,"version",2),X(this,"core"),X(this,"logger"),X(this,"events",new qe.exports.EventEmitter),X(this,"provider"),X(this,"messages"),X(this,"subscriber"),X(this,"publisher"),X(this,"name",Qa),X(this,"transportExplicitlyClosed",!1),X(this,"initialized",!1),X(this,"connectionAttemptInProgress",!1),X(this,"relayUrl"),X(this,"projectId"),X(this,"packageName"),X(this,"bundleId"),X(this,"hasExperiencedNetworkDisruption",!1),X(this,"pingTimeout"),X(this,"heartBeatTimeout",V.toMiliseconds(V.THIRTY_SECONDS+V.FIVE_SECONDS)),X(this,"reconnectTimeout"),X(this,"connectPromise"),X(this,"reconnectInProgress",!1),X(this,"requestsInFlight",[]),X(this,"connectTimeout",V.toMiliseconds(V.ONE_SECOND*15)),X(this,"request",async r=>{var n,i;this.logger.debug("Publishing Request Payload");const s=r.id||qo().toString();await this.toEstablishConnection();try{this.logger.trace({id:s,method:r.method,topic:(n=r.params)==null?void 0:n.topic},"relayer.request - publishing...");const o=`${s}:${((i=r.params)==null?void 0:i.tag)||""}`;this.requestsInFlight.push(o);const a=await this.provider.request(r);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${s}`),o}}),X(this,"resetPingTimeout",()=>{gi()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var r,n,i,s;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(s=(i=(n=(r=this.provider)==null?void 0:r.connection)==null?void 0:n.socket)==null?void 0:i.terminate)==null||s.call(i)}catch(o){this.logger.warn(o,o?.message)}},this.heartBeatTimeout))}),X(this,"onPayloadHandler",r=>{this.onProviderPayload(r),this.resetPingTimeout()}),X(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected \u{1F6DC}"),this.startPingTimeout(),this.events.emit(de.connect)}),X(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected \u{1F6D1}"),this.requestsInFlight=[],this.onProviderDisconnect()}),X(this,"onProviderErrorHandler",r=>{this.logger.fatal(`Fatal socket error: ${r.message}`),this.events.emit(de.error,r),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),X(this,"registerProviderListeners",()=>{this.provider.on(ze.payload,this.onPayloadHandler),this.provider.on(ze.connect,this.onConnectHandler),this.provider.on(ze.disconnect,this.onDisconnectHandler),this.provider.on(ze.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Te(e.logger,this.name):Bt(za({level:e.logger||Ja})),this.messages=new mh(this.logger,e.core),this.subscriber=new Fh(this,this.logger),this.publisher=new e3(this,this.logger),this.relayUrl=e?.relayUrl||ts,this.projectId=e.projectId,fE()?this.packageName=Gl():hE()&&(this.bundleId=Gl()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e?.message))}get context(){return je(this.logger)}get connected(){var e,r,n;return((n=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:n.readyState)===1||!1}get connecting(){var e,r,n;return((n=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:n.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,r,n){this.isInitialized(),await this.publisher.publish(e,r,n),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now(),transportType:rr.relay},qr.outbound)}async subscribe(e,r){var n,i,s;this.isInitialized(),(!(r!=null&&r.transportType)||r?.transportType==="relay")&&await this.toEstablishConnection();const o=typeof((n=r?.internal)==null?void 0:n.throwOnFailedPublish)>"u"?!0:(i=r?.internal)==null?void 0:i.throwOnFailedPublish;let a=((s=this.subscriber.topicMap.get(e))==null?void 0:s[0])||"",c;const u=l=>{l.topic===e&&(this.subscriber.off(Be.created,u),c())};return await Promise.all([new Promise(l=>{c=l,this.subscriber.on(Be.created,u)}),new Promise(async(l,f)=>{a=await this.subscriber.subscribe(e,zh({internal:{throwOnFailedPublish:o}},r)).catch(h=>{o&&f(h)})||a,l()})]),a}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await Lt(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.warn("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(r,n)=>{await this.connect(e).then(r).catch(n).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await ph())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const r=e.sort((n,i)=>n.publishedAt-i.publishedAt);this.logger.debug(`Batch of ${r.length} message events sorted`);for(const n of r)try{await this.onMessageEvent(n)}catch(i){this.logger.warn(i,"Error while processing batch message event: "+i?.message)}this.logger.trace(`Batch of ${r.length} message events processed`)}async onLinkMessageEvent(e,r){const{topic:n}=e;if(!r.sessionExists){const i=ln(V.FIVE_MINUTES),s={topic:n,expiry:i,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(n,s)}this.events.emit(de.message,e),await this.recordMessageEvent(e,qr.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let r=1;for(;r<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${r}...`),await this.createProvider(),await new Promise(async(n,i)=>{const s=()=>{i(new Error("Connection interrupted while trying to connect"))};this.provider.once(ze.disconnect,s),await Lt(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{i(o)}).finally(()=>{this.provider.off(ze.disconnect,s),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{i(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(ze.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(ze.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,n()})}catch(n){await this.subscriber.stop();const i=n;this.logger.warn({},i.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${r}`);break}await new Promise(n=>setTimeout(n,V.toMiliseconds(r*1))),r++}}startPingTimeout(){var e,r,n,i,s;if(gi())try{(r=(e=this.provider)==null?void 0:e.connection)!=null&&r.socket&&((s=(i=(n=this.provider)==null?void 0:n.connection)==null?void 0:i.socket)==null||s.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new V_(new G_(bE({sdkVersion:Hn,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,r){const{topic:n,message:i}=e;await this.messages.set(n,i,r)}async shouldIgnoreMessageEvent(e){const{topic:r,message:n}=e;if(!n||n.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isKnownTopic(r))return this.logger.warn(`Ignoring message for unknown topic ${r}`),!0;const i=this.messages.has(r,n);return i&&this.logger.warn(`Ignoring duplicate message: ${n}`),i}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Rh(e)){if(!e.method.endsWith(ec))return;const r=e.params,{topic:n,message:i,publishedAt:s,attestation:o}=r.data,a={topic:n,message:i,publishedAt:s,transportType:rr.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(zh({type:"event",event:r.id},a)),this.events.emit(r.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else Go(e)&&this.events.emit(de.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,qr.inbound),this.events.emit(de.message,e))}async acknowledgePayload(e){const r=Ah(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(ze.payload,this.onPayloadHandler),this.provider.off(ze.connect,this.onConnectHandler),this.provider.off(ze.disconnect,this.onDisconnectHandler),this.provider.off(ze.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await ph();V2(async r=>{e!==r&&(e=r,r?await this.transportOpen().catch(n=>this.logger.error(n,n?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(Qt.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&W2())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(r){this.logger.warn(r,r?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(de.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},V.toMiliseconds(tc)))))}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function h3(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function Mh(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function Hh(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const d3="[object RegExp]",g3="[object String]",p3="[object Number]",y3="[object Boolean]",Vh="[object Arguments]",b3="[object Symbol]",w3="[object Date]",m3="[object Map]",E3="[object Set]",v3="[object Array]",_3="[object Function]",x3="[object ArrayBuffer]",ea="[object Object]",D3="[object Error]",I3="[object DataView]",S3="[object Uint8Array]",O3="[object Uint8ClampedArray]",A3="[object Uint16Array]",T3="[object Uint32Array]",B3="[object BigUint64Array]",C3="[object Int8Array]",R3="[object Int16Array]",N3="[object Int32Array]",P3="[object BigInt64Array]",$3="[object Float32Array]",L3="[object Float64Array]";function U3(){}function Kh(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function F3(t,e,r){return Tn(t,e,void 0,void 0,void 0,void 0,r)}function Tn(t,e,r,n,i,s,o){const a=o(t,e,r,n,i,s);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return Bn(t,e,s,o)}return Bn(t,e,s,o)}function Bn(t,e,r,n){if(Object.is(t,e))return!0;let i=Hh(t),s=Hh(e);if(i===Vh&&(i=ea),s===Vh&&(s=ea),i!==s)return!1;switch(i){case g3:return t.toString()===e.toString();case p3:{const c=t.valueOf(),u=e.valueOf();return h3(c,u)}case y3:case w3:case b3:return Object.is(t.valueOf(),e.valueOf());case d3:return t.source===e.source&&t.flags===e.flags;case _3:return t===e}r=r??new Map;const o=r.get(t),a=r.get(e);if(o!=null&&a!=null)return o===e;r.set(t,e),r.set(e,t);try{switch(i){case m3:{if(t.size!==e.size)return!1;for(const[c,u]of t.entries())if(!e.has(c)||!Tn(u,e.get(c),c,t,e,r,n))return!1;return!0}case E3:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),u=Array.from(e.values());for(let l=0;l<c.length;l++){const f=c[l],h=u.findIndex(g=>Tn(f,g,void 0,t,e,r,n));if(h===-1)return!1;u.splice(h,1)}return!0}case v3:case S3:case O3:case A3:case T3:case B3:case C3:case R3:case N3:case P3:case $3:case L3:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!Tn(t[c],e[c],c,t,e,r,n))return!1;return!0}case x3:return t.byteLength!==e.byteLength?!1:Bn(new Uint8Array(t),new Uint8Array(e),r,n);case I3:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:Bn(new Uint8Array(t),new Uint8Array(e),r,n);case D3:return t.name===e.name&&t.message===e.message;case ea:{if(!(Bn(t.constructor,e.constructor,r,n)||Kh(t)&&Kh(e)))return!1;const u=[...Object.keys(t),...Mh(t)],l=[...Object.keys(e),...Mh(e)];if(u.length!==l.length)return!1;for(let f=0;f<u.length;f++){const h=u[f],g=t[h];if(!Object.hasOwn(e,h))return!1;const d=e[h];if(!Tn(g,d,h,t,e,r,n))return!1}return!0}default:return!1}}finally{r.delete(t),r.delete(e)}}function j3(t,e){return F3(t,e,U3)}var z3=Object.defineProperty,qh=Object.getOwnPropertySymbols,k3=Object.prototype.hasOwnProperty,M3=Object.prototype.propertyIsEnumerable,ta=(t,e,r)=>e in t?z3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Wh=(t,e)=>{for(var r in e||(e={}))k3.call(e,r)&&ta(t,r,e[r]);if(qh)for(var r of qh(e))M3.call(e,r)&&ta(t,r,e[r]);return t},Fe=(t,e,r)=>ta(t,typeof e!="symbol"?e+"":e,r);class Gh extends dp{constructor(e,r,n,i=tt,s=void 0){super(e,r,n,i),this.core=e,this.logger=r,this.name=n,Fe(this,"map",new Map),Fe(this,"version",rc),Fe(this,"cached",[]),Fe(this,"initialized",!1),Fe(this,"getKey"),Fe(this,"storagePrefix",tt),Fe(this,"recentlyDeleted",[]),Fe(this,"recentlyDeletedLimit",200),Fe(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!Ri(o)?this.map.set(this.getKey(o),o):j2(o)?this.map.set(o.id,o):z2(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),Fe(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),Fe(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),Fe(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>j3(a[c],o[c]))):this.values)),Fe(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=Wh(Wh({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),Fe(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=Te(r,this.name),this.storagePrefix=i,this.getKey=s}get context(){return je(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){if(this.recentlyDeleted.includes(e)){const{message:i}=J("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}const{message:n}=J("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(n),new Error(n)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=J("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}var H3=Object.defineProperty,V3=(t,e,r)=>e in t?H3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,G=(t,e,r)=>V3(t,typeof e!="symbol"?e+"":e,r);class Yh{constructor(e,r){this.core=e,this.logger=r,G(this,"name",oc),G(this,"version",ac),G(this,"events",new qe.exports),G(this,"pairings"),G(this,"initialized",!1),G(this,"storagePrefix",tt),G(this,"ignoredPayloadTypes",[Lr]),G(this,"registeredMethods",[]),G(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),G(this,"register",({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]}),G(this,"create",async n=>{this.isInitialized();const i=jo(),s=await this.core.crypto.setSymKey(i),o=ln(V.FIVE_MINUTES),a={protocol:Xa},c={topic:s,expiry:o,relay:a,active:!1,methods:n?.methods},u=dh({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:i,relay:a,expiryTimestamp:o,methods:n?.methods});return this.events.emit(Er.create,c),this.core.expirer.set(s,o),await this.pairings.set(s,c),await this.core.relayer.subscribe(s,{transportType:n?.transportType}),{topic:s,uri:u}}),G(this,"pair",async n=>{this.isInitialized();const i=this.core.eventClient.createEvent({properties:{topic:n?.uri,trace:[lt.pairing_started]}});this.isValidPair(n,i);const{topic:s,symKey:o,relay:a,expiryTimestamp:c,methods:u}=hh(n.uri);i.props.properties.topic=s,i.addTrace(lt.pairing_uri_validation_success),i.addTrace(lt.pairing_uri_not_expired);let l;if(this.pairings.keys.includes(s)){if(l=this.pairings.get(s),i.addTrace(lt.existing_pairing),l.active)throw i.setError(bt.active_pairing_already_exists),new Error(`Pairing already exists: ${s}. Please try again with a new connection URI.`);i.addTrace(lt.pairing_not_expired)}const f=c||ln(V.FIVE_MINUTES),h={topic:s,relay:a,expiry:f,active:!1,methods:u};this.core.expirer.set(s,f),await this.pairings.set(s,h),i.addTrace(lt.store_new_pairing),n.activatePairing&&await this.activate({topic:s}),this.events.emit(Er.create,h),i.addTrace(lt.emit_inactive_pairing),this.core.crypto.keychain.has(s)||await this.core.crypto.setSymKey(o,s),i.addTrace(lt.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{i.setError(bt.no_internet_connection)}try{await this.core.relayer.subscribe(s,{relay:a})}catch(g){throw i.setError(bt.subscribe_pairing_topic_failure),g}return i.addTrace(lt.subscribe_pairing_topic_success),h}),G(this,"activate",async({topic:n})=>{this.isInitialized();const i=ln(V.FIVE_MINUTES);this.core.expirer.set(n,i),await this.pairings.update(n,{active:!0,expiry:i})}),G(this,"ping",async n=>{this.isInitialized(),await this.isValidPing(n),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:i}=n;if(this.pairings.keys.includes(i)){const s=await this.sendRequest(i,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=wE();this.events.once(uo("pairing_ping",s),({error:u})=>{u?c(u):a()}),await o()}}),G(this,"updateExpiry",async({topic:n,expiry:i})=>{this.isInitialized(),await this.pairings.update(n,{expiry:i})}),G(this,"updateMetadata",async({topic:n,metadata:i})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:i})}),G(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),G(this,"disconnect",async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:i}=n;this.pairings.keys.includes(i)&&(await this.sendRequest(i,"wc_pairingDelete",In("USER_DISCONNECTED")),await this.deletePairing(i))}),G(this,"formatUriFromPairing",n=>{this.isInitialized();const{topic:i,relay:s,expiry:o,methods:a}=n,c=this.core.crypto.keychain.get(i);return dh({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:c,relay:s,expiryTimestamp:o,methods:a})}),G(this,"sendRequest",async(n,i,s)=>{const o=Wo(i,s),a=await this.core.crypto.encode(n,o),c=mr[i].req;return this.core.history.set(n,o),this.core.relayer.publish(n,a,c),o.id}),G(this,"sendResult",async(n,i,s)=>{const o=Ah(n,s),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,n)).request.method,u=mr[c].res;await this.core.relayer.publish(i,a,u),await this.core.history.resolve(o)}),G(this,"sendError",async(n,i,s)=>{const o=Th(n,s),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,n)).request.method,u=mr[c]?mr[c].res:mr.unregistered_method.res;await this.core.relayer.publish(i,a,u),await this.core.history.resolve(o)}),G(this,"deletePairing",async(n,i)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,In("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),i?Promise.resolve():this.core.expirer.del(n)])}),G(this,"cleanup",async()=>{const n=this.pairings.getAll().filter(i=>Xl(i.expiry));await Promise.all(n.map(i=>this.deletePairing(i.topic)))}),G(this,"onRelayEventRequest",async n=>{const{topic:i,payload:s}=n;switch(s.method){case"wc_pairingPing":return await this.onPairingPingRequest(i,s);case"wc_pairingDelete":return await this.onPairingDeleteRequest(i,s);default:return await this.onUnknownRpcMethodRequest(i,s)}}),G(this,"onRelayEventResponse",async n=>{const{topic:i,payload:s}=n,o=(await this.core.history.get(i,s.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(i,s);default:return this.onUnknownRpcMethodResponse(o)}}),G(this,"onPairingPingRequest",async(n,i)=>{const{id:s}=i;try{this.isValidPing({topic:n}),await this.sendResult(s,n,!0),this.events.emit(Er.ping,{id:s,topic:n})}catch(o){await this.sendError(s,n,o),this.logger.error(o)}}),G(this,"onPairingPingResponse",(n,i)=>{const{id:s}=i;setTimeout(()=>{Nh(i)?this.events.emit(uo("pairing_ping",s),{}):Ni(i)&&this.events.emit(uo("pairing_ping",s),{error:i.error})},500)}),G(this,"onPairingDeleteRequest",async(n,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(Er.delete,{id:s,topic:n})}catch(o){await this.sendError(s,n,o),this.logger.error(o)}}),G(this,"onUnknownRpcMethodRequest",async(n,i)=>{const{id:s,method:o}=i;try{if(this.registeredMethods.includes(o))return;const a=In("WC_METHOD_UNSUPPORTED",o);await this.sendError(s,n,a),this.logger.error(a)}catch(a){await this.sendError(s,n,a),this.logger.error(a)}}),G(this,"onUnknownRpcMethodResponse",n=>{this.registeredMethods.includes(n)||this.logger.error(In("WC_METHOD_UNSUPPORTED",n))}),G(this,"isValidPair",(n,i)=>{var s;if(!zo(n)){const{message:a}=J("MISSING_OR_INVALID",`pair() params: ${n}`);throw i.setError(bt.malformed_pairing_uri),new Error(a)}if(!F2(n.uri)){const{message:a}=J("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw i.setError(bt.malformed_pairing_uri),new Error(a)}const o=hh(n?.uri);if(!((s=o?.relay)!=null&&s.protocol)){const{message:a}=J("MISSING_OR_INVALID","pair() uri#relay-protocol");throw i.setError(bt.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=J("MISSING_OR_INVALID","pair() uri#symKey");throw i.setError(bt.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&V.toMiliseconds(o?.expiryTimestamp)<Date.now()){i.setError(bt.pairing_expired);const{message:a}=J("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),G(this,"isValidPing",async n=>{if(!zo(n)){const{message:s}=J("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(s)}const{topic:i}=n;await this.isValidPairingTopic(i)}),G(this,"isValidDisconnect",async n=>{if(!zo(n)){const{message:s}=J("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(s)}const{topic:i}=n;await this.isValidPairingTopic(i)}),G(this,"isValidPairingTopic",async n=>{if(!gh(n,!1)){const{message:i}=J("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(i)}if(!this.pairings.keys.includes(n)){const{message:i}=J("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(i)}if(Xl(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:i}=J("EXPIRED",`pairing topic: ${n}`);throw new Error(i)}}),this.core=e,this.logger=Te(r,this.name),this.pairings=new Gh(this.core,this.logger,this.name,this.storagePrefix)}get context(){return je(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(de.message,async e=>{const{topic:r,message:n,transportType:i}=e;if(this.pairings.keys.includes(r)&&i!==rr.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))try{const s=await this.core.crypto.decode(r,n);Rh(s)?(this.core.history.set(r,s),await this.onRelayEventRequest({topic:r,payload:s})):Go(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:r,payload:s}),this.core.history.delete(r,s.id)),await this.core.relayer.messages.ack(r,n)}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(Ge.expired,async e=>{const{topic:r}=vE(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Er.expire,{topic:r}))})}}var K3=Object.defineProperty,q3=(t,e,r)=>e in t?K3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,we=(t,e,r)=>q3(t,typeof e!="symbol"?e+"":e,r);class Zh extends up{constructor(e,r){super(e,r),this.core=e,this.logger=r,we(this,"records",new Map),we(this,"events",new qe.exports.EventEmitter),we(this,"name",cc),we(this,"version",uc),we(this,"cached",[]),we(this,"initialized",!1),we(this,"storagePrefix",tt),we(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),we(this,"set",(n,i,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:i,chainId:s}),this.records.has(i.id))return;const o={id:i.id,topic:n,request:{method:i.method,params:i.params||null},chainId:s,expiry:ln(V.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(We.created,o)}),we(this,"resolve",async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const i=await this.getRecord(n.id);typeof i.response>"u"&&(i.response=Ni(n)?{error:n.error}:{result:n.result},this.records.set(i.id,i),this.persist(),this.events.emit(We.updated,i))}),we(this,"get",async(n,i)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:i}),await this.getRecord(i))),we(this,"delete",(n,i)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:i}),this.values.forEach(s=>{if(s.topic===n){if(typeof i<"u"&&s.id!==i)return;this.records.delete(s.id),this.events.emit(We.deleted,s)}}),this.persist()}),we(this,"exists",async(n,i)=>(this.isInitialized(),this.records.has(i)?(await this.getRecord(i)).topic===n:!1)),we(this,"on",(n,i)=>{this.events.on(n,i)}),we(this,"once",(n,i)=>{this.events.once(n,i)}),we(this,"off",(n,i)=>{this.events.off(n,i)}),we(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),this.logger=Te(r,this.name)}get context(){return je(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const n={topic:r.topic,request:Wo(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(n)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:n}=J("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(We.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=J("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(We.created,e=>{const r=We.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(We.updated,e=>{const r=We.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(We.deleted,e=>{const r=We.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.core.heartbeat.on(Qt.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(r=>{V.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.records.delete(r.id),this.events.emit(We.deleted,r,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}var W3=Object.defineProperty,G3=(t,e,r)=>e in t?W3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,xe=(t,e,r)=>G3(t,typeof e!="symbol"?e+"":e,r);class Xh extends pp{constructor(e,r){super(e,r),this.core=e,this.logger=r,xe(this,"expirations",new Map),xe(this,"events",new qe.exports.EventEmitter),xe(this,"name",lc),xe(this,"version",fc),xe(this,"cached",[]),xe(this,"initialized",!1),xe(this,"storagePrefix",tt),xe(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),xe(this,"has",n=>{try{const i=this.formatTarget(n);return typeof this.getExpiration(i)<"u"}catch{return!1}}),xe(this,"set",(n,i)=>{this.isInitialized();const s=this.formatTarget(n),o={target:s,expiry:i};this.expirations.set(s,o),this.checkExpiry(s,o),this.events.emit(Ge.created,{target:s,expiration:o})}),xe(this,"get",n=>{this.isInitialized();const i=this.formatTarget(n);return this.getExpiration(i)}),xe(this,"del",n=>{if(this.isInitialized(),this.has(n)){const i=this.formatTarget(n),s=this.getExpiration(i);this.expirations.delete(i),this.events.emit(Ge.deleted,{target:i,expiration:s})}}),xe(this,"on",(n,i)=>{this.events.on(n,i)}),xe(this,"once",(n,i)=>{this.events.once(n,i)}),xe(this,"off",(n,i)=>{this.events.off(n,i)}),xe(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),this.logger=Te(r,this.name)}get context(){return je(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return mE(e);if(typeof e=="number")return EE(e);const{message:r}=J("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Ge.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=J("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:n}=J("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(n),new Error(n)}return r}checkExpiry(e,r){const{expiry:n}=r;V.toMiliseconds(n)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(Ge.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(Qt.pulse,()=>this.checkExpirations()),this.events.on(Ge.created,e=>{const r=Ge.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(Ge.expired,e=>{const r=Ge.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(Ge.deleted,e=>{const r=Ge.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Y3=Object.defineProperty,Z3=(t,e,r)=>e in t?Y3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,oe=(t,e,r)=>Z3(t,typeof e!="symbol"?e+"":e,r);class Jh extends yp{constructor(e,r,n){super(e,r,n),this.core=e,this.logger=r,this.store=n,oe(this,"name",hc),oe(this,"abortController"),oe(this,"isDevEnv"),oe(this,"verifyUrlV3",gc),oe(this,"storagePrefix",tt),oe(this,"version",Ji),oe(this,"publicKey"),oe(this,"fetchPromise"),oe(this,"init",async()=>{var i;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&V.toMiliseconds((i=this.publicKey)==null?void 0:i.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),oe(this,"register",async i=>{if(!un()||this.isDevEnv)return;const s=window.location.origin,{id:o,decryptedId:a}=i,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${s}&id=${o}&decryptedId=${a}`;try{const u=Dr(),l=this.startAbortTimer(V.ONE_SECOND*5),f=await new Promise((h,g)=>{const d=()=>{window.removeEventListener("message",m),u.body.removeChild(p),g("attestation aborted")};this.abortController.signal.addEventListener("abort",d);const p=u.createElement("iframe");p.src=c,p.style.display="none",p.addEventListener("error",d,{signal:this.abortController.signal});const m=C=>{if(C.data&&typeof C.data=="string")try{const P=JSON.parse(C.data);if(P.type==="verify_attestation"){if(xs(P.attestation).payload.id!==o)return;clearInterval(l),u.body.removeChild(p),this.abortController.signal.removeEventListener("abort",d),window.removeEventListener("message",m),h(P.attestation===null?"":P.attestation)}}catch(P){this.logger.warn(P)}};u.body.appendChild(p),window.addEventListener("message",m,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",f),f}catch(u){this.logger.warn(u)}return""}),oe(this,"resolve",async i=>{if(this.isDevEnv)return"";const{attestationId:s,hash:o,encryptedId:a}=i;if(s===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(s){if(xs(s).payload.id!==a)return;const u=await this.isValidJwtAttestation(s);if(u){if(!u.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return u}}if(!o)return;const c=this.getVerifyUrl(i?.verifyUrl);return this.fetchAttestation(o,c)}),oe(this,"fetchAttestation",async(i,s)=>{this.logger.debug(`resolving attestation: ${i} from url: ${s}`);const o=this.startAbortTimer(V.ONE_SECOND*5),a=await fetch(`${s}/attestation/${i}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),oe(this,"getVerifyUrl",i=>{let s=i||Wr;return pc.includes(s)||(this.logger.info(`verify url: ${s}, not included in trusted list, assigning default: ${Wr}`),s=Wr),s}),oe(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const i=this.startAbortTimer(V.FIVE_SECONDS),s=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(i),await s.json()}catch(i){this.logger.warn(i)}}),oe(this,"persistPublicKey",async i=>{this.logger.debug("persisting public key to local storage",i),await this.store.setItem(this.storeKey,i),this.publicKey=i}),oe(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),oe(this,"isValidJwtAttestation",async i=>{const s=await this.getPublicKey();try{if(s)return this.validateAttestation(i,s)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(i,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),oe(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),oe(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async s=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),s(o))});const i=await this.fetchPromise;return this.fetchPromise=void 0,i}),oe(this,"validateAttestation",(i,s)=>{const o=C2(i,s.publicKey),a={hasExpired:V.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=Te(r,this.name),this.abortController=new AbortController,this.isDevEnv=Ql(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return je(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),V.toMiliseconds(e))}}var X3=Object.defineProperty,J3=(t,e,r)=>e in t?X3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Qh=(t,e,r)=>J3(t,typeof e!="symbol"?e+"":e,r);class ed extends bp{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,Qh(this,"context",yc),Qh(this,"registerDeviceToken",async n=>{const{clientId:i,token:s,notificationType:o,enableEncrypted:a=!1}=n,c=`${bc}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:i,type:o,token:s,always_raw:a})})}),this.logger=Te(r,this.context)}}var Q3=Object.defineProperty,td=Object.getOwnPropertySymbols,e8=Object.prototype.hasOwnProperty,t8=Object.prototype.propertyIsEnumerable,ra=(t,e,r)=>e in t?Q3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Cn=(t,e)=>{for(var r in e||(e={}))e8.call(e,r)&&ra(t,r,e[r]);if(td)for(var r of td(e))t8.call(e,r)&&ra(t,r,e[r]);return t},he=(t,e,r)=>ra(t,typeof e!="symbol"?e+"":e,r);class rd extends wp{constructor(e,r,n=!0){super(e,r,n),this.core=e,this.logger=r,he(this,"context",mc),he(this,"storagePrefix",tt),he(this,"storageVersion",wc),he(this,"events",new Map),he(this,"shouldPersist",!1),he(this,"init",async()=>{if(!Ql())try{const i={eventId:Jl(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:Yl(this.core.relayer.protocol,this.core.relayer.version,Hn)}}};await this.sendEvent([i])}catch(i){this.logger.warn(i)}}),he(this,"createEvent",i=>{const{event:s="ERROR",type:o="",properties:{topic:a,trace:c}}=i,u=Jl(),l=this.core.projectId||"",f=Date.now(),h=Cn({eventId:u,timestamp:f,props:{event:s,type:o,properties:{topic:a,trace:c}},bundleId:l,domain:this.getAppDomain()},this.setMethods(u));return this.telemetryEnabled&&(this.events.set(u,h),this.shouldPersist=!0),h}),he(this,"getEvent",i=>{const{eventId:s,topic:o}=i;if(s)return this.events.get(s);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return Cn(Cn({},a),this.setMethods(a.eventId))}),he(this,"deleteEvent",i=>{const{eventId:s}=i;this.events.delete(s),this.shouldPersist=!0}),he(this,"setEventListeners",()=>{this.core.heartbeat.on(Qt.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(i=>{V.fromMiliseconds(Date.now())-V.fromMiliseconds(i.timestamp)>Ec&&(this.events.delete(i.eventId),this.shouldPersist=!0)})})}),he(this,"setMethods",i=>({addTrace:s=>this.addTrace(i,s),setError:s=>this.setError(i,s)})),he(this,"addTrace",(i,s)=>{const o=this.events.get(i);o&&(o.props.properties.trace.push(s),this.events.set(i,o),this.shouldPersist=!0)}),he(this,"setError",(i,s)=>{const o=this.events.get(i);o&&(o.props.type=s,o.timestamp=Date.now(),this.events.set(i,o),this.shouldPersist=!0)}),he(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),he(this,"restore",async()=>{try{const i=await this.core.storage.getItem(this.storageKey)||[];if(!i.length)return;i.forEach(s=>{this.events.set(s.eventId,Cn(Cn({},s),this.setMethods(s.eventId)))})}catch(i){this.logger.warn(i)}}),he(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const i=[];for(const[s,o]of this.events)o.props.type&&i.push(o);if(i.length!==0)try{if((await this.sendEvent(i)).ok)for(const s of i)this.events.delete(s.eventId),this.shouldPersist=!0}catch(s){this.logger.warn(s)}}),he(this,"sendEvent",async i=>{const s=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${vc}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Hn}${s}`,{method:"POST",body:JSON.stringify(i)})}),he(this,"getAppDomain",()=>gE().url),this.logger=Te(r,this.context),this.telemetryEnabled=n,n?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var r8=Object.defineProperty,nd=Object.getOwnPropertySymbols,n8=Object.prototype.hasOwnProperty,i8=Object.prototype.propertyIsEnumerable,na=(t,e,r)=>e in t?r8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,id=(t,e)=>{for(var r in e||(e={}))n8.call(e,r)&&na(t,r,e[r]);if(nd)for(var r of nd(e))i8.call(e,r)&&na(t,r,e[r]);return t},ne=(t,e,r)=>na(t,typeof e!="symbol"?e+"":e,r);class $i extends sp{constructor(e){var r;super(e),ne(this,"protocol",Xi),ne(this,"version",Ji),ne(this,"name",Kr),ne(this,"relayUrl"),ne(this,"projectId"),ne(this,"customStoragePrefix"),ne(this,"events",new qe.exports.EventEmitter),ne(this,"logger"),ne(this,"heartbeat"),ne(this,"relayer"),ne(this,"crypto"),ne(this,"storage"),ne(this,"history"),ne(this,"expirer"),ne(this,"pairing"),ne(this,"verify"),ne(this,"echoClient"),ne(this,"linkModeSupportedApps"),ne(this,"eventClient"),ne(this,"initialized",!1),ne(this,"logChunkController"),ne(this,"on",(a,c)=>this.events.on(a,c)),ne(this,"once",(a,c)=>this.events.once(a,c)),ne(this,"off",(a,c)=>this.events.off(a,c)),ne(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),ne(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:u})=>{if(!a||!c)return;const l={topic:a,message:c,publishedAt:Date.now(),transportType:rr.link_mode};this.relayer.onLinkMessageEvent(l,{sessionExists:u})});const n=this.getGlobalCore(e?.customStoragePrefix);if(n)try{return this.customStoragePrefix=n.customStoragePrefix,this.logger=n.logger,this.heartbeat=n.heartbeat,this.crypto=n.crypto,this.history=n.history,this.expirer=n.expirer,this.storage=n.storage,this.relayer=n.relayer,this.pairing=n.pairing,this.verify=n.verify,this.echoClient=n.echoClient,this.linkModeSupportedApps=n.linkModeSupportedApps,this.eventClient=n.eventClient,this.initialized=n.initialized,this.logChunkController=n.logChunkController,n}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||ts,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const i=za({level:typeof e?.logger=="string"&&e.logger?e.logger:Ma.logger,name:Kr}),{logger:s,chunkLoggerController:o}=rp({opts:i,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=o,(r=this.logChunkController)!=null&&r.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=Te(s,this.name),this.heartbeat=new Vi,this.crypto=new bh(this,this.logger,e?.keychain),this.history=new Zh(this,this.logger),this.expirer=new Xh(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Ag(id(id({},Ha),e?.storageOptions)),this.relayer=new kh({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Yh(this,this.logger),this.verify=new Jh(this,this.logger,this.storage),this.echoClient=new ed(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new rd(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const r=new $i(e);await r.initialize();const n=await r.crypto.getClientId();return await r.storage.setItem(nc,n),r}get context(){return je(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(rs,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(rs)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${e}`,n=`${r}_count`;return globalThis[n]=(globalThis[n]||0)+1,globalThis[n]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[n]} times.`),globalThis[r]}catch(r){console.warn("Failed to get global WalletConnect core",r);return}}setGlobalCore(e){var r;try{if(this.isGlobalCoreDisabled())return;const n=`_walletConnectCore_${((r=e.opts)==null?void 0:r.customStoragePrefix)||""}`;globalThis[n]=e}catch(n){console.warn("Failed to set global WalletConnect core",n)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&process.env.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}}const s8=$i;j.CORE_CONTEXT=Kr,j.CORE_DEFAULT=Ma,j.CORE_PROTOCOL=Xi,j.CORE_STORAGE_OPTIONS=Ha,j.CORE_STORAGE_PREFIX=tt,j.CORE_VERSION=Ji,j.CRYPTO_CLIENT_SEED=Qi,j.CRYPTO_CONTEXT=Va,j.CRYPTO_JWT_TTL=Ka,j.Core=s8,j.Crypto=bh,j.ECHO_CONTEXT=yc,j.ECHO_URL=bc,j.EVENTS_CLIENT_API_URL=vc,j.EVENTS_STORAGE_CLEANUP_INTERVAL=Ec,j.EVENTS_STORAGE_CONTEXT=mc,j.EVENTS_STORAGE_VERSION=wc,j.EVENT_CLIENT_AUTHENTICATE_ERRORS=Bp,j.EVENT_CLIENT_AUTHENTICATE_TRACES=Tp,j.EVENT_CLIENT_CONTEXT=Sp,j.EVENT_CLIENT_PAIRING_ERRORS=bt,j.EVENT_CLIENT_PAIRING_TRACES=lt,j.EVENT_CLIENT_SESSION_ERRORS=Ap,j.EVENT_CLIENT_SESSION_TRACES=Op,j.EXPIRER_CONTEXT=lc,j.EXPIRER_DEFAULT_TTL=Dp,j.EXPIRER_EVENTS=Ge,j.EXPIRER_STORAGE_VERSION=fc,j.EchoClient=ed,j.EventClient=rd,j.Expirer=Xh,j.HISTORY_CONTEXT=cc,j.HISTORY_EVENTS=We,j.HISTORY_STORAGE_VERSION=uc,j.JsonRpcHistory=Zh,j.KEYCHAIN_CONTEXT=qa,j.KEYCHAIN_STORAGE_VERSION=Wa,j.KeyChain=yh,j.MESSAGES_CONTEXT=Ga,j.MESSAGES_STORAGE_VERSION=Ya,j.MESSAGE_DIRECTION=qr,j.MessageTracker=mh,j.PAIRING_CONTEXT=oc,j.PAIRING_DEFAULT_TTL=xp,j.PAIRING_EVENTS=Er,j.PAIRING_RPC_OPTS=mr,j.PAIRING_STORAGE_VERSION=ac,j.PENDING_SUB_RESOLUTION_TIMEOUT=_p,j.PUBLISHER_CONTEXT=Za,j.PUBLISHER_DEFAULT_TTL=es,j.Pairing=Yh,j.RELAYER_CONTEXT=Qa,j.RELAYER_DEFAULT_LOGGER=Ja,j.RELAYER_DEFAULT_PROTOCOL=Xa,j.RELAYER_DEFAULT_RELAY_URL=ts,j.RELAYER_EVENTS=de,j.RELAYER_PROVIDER_EVENTS=ze,j.RELAYER_RECONNECT_TIMEOUT=tc,j.RELAYER_SDK_VERSION=Hn,j.RELAYER_STORAGE_OPTIONS=mp,j.RELAYER_SUBSCRIBER_SUFFIX=ec,j.RELAYER_TRANSPORT_CUTOFF=Ep,j.Relayer=kh,j.STORE_STORAGE_VERSION=rc,j.SUBSCRIBER_CONTEXT=ic,j.SUBSCRIBER_DEFAULT_TTL=vp,j.SUBSCRIBER_EVENTS=Be,j.SUBSCRIBER_STORAGE_VERSION=sc,j.Store=Gh,j.Subscriber=Fh,j.TRANSPORT_TYPES=rr,j.TRUSTED_VERIFY_URLS=pc,j.VERIFY_CONTEXT=hc,j.VERIFY_SERVER=Wr,j.VERIFY_SERVER_V3=gc,j.Verify=Jh,j.WALLETCONNECT_CLIENT_ID=nc,j.WALLETCONNECT_LINK_MODE_APPS=rs,j.default=$i,Object.defineProperty(j,"__esModule",{value:!0})});
//# sourceMappingURL=index.umd.js.map
