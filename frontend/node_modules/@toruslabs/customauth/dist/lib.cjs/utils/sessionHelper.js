'use strict';

var sessionManager = require('@toruslabs/session-manager');
var log = require('loglevel');

async function fetchDataFromBroadcastServer(identifier, storageServerUrl) {
  try {
    const configManager = new sessionManager.SessionManager({
      sessionId: identifier,
      sessionServerBaseUrl: storageServerUrl,
      allowedOrigin: true
    });
    const data = await configManager.authorizeSession();
    return data;
  } catch (error) {
    log.error("fetch data from storage server error", error);
    throw new Error("Unable to retrieve data from storage server, invalid key or key expired.");
  }
}

exports.fetchDataFromBroadcastServer = fetchDataFromBroadcastServer;
